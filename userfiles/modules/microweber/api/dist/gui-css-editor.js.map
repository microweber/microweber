{"version":3,"file":"gui-css-editor.js","sources":["webpack://microweber-webpack/./userfiles/modules/microweber/api/gui-css-editor/domtree.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/gui-css-editor/stylesheet.editor.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/system-tools/base64.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/system-tools/image-tools.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/system-tools/modules-dialogs.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/widgets/colorpicker.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/widgets/dialog.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/widgets/elementedit.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/widgets/gallery.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/widgets/iframe-tools.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/widgets/responsive.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/widgets/select.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/widgets/spinner.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/widgets/storage.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/tools/widgets/uiaccordion.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/widgets/autocomplete.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/widgets/block-edit.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/widgets/control_box.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/widgets/form-controls.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/widgets/link-editor.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/widgets/tags.js","webpack://microweber-webpack/./userfiles/modules/microweber/api/widgets/tree.js"],"sourcesContent":["mw.DomTree = function (options) {\r\n    var scope = this;\r\n    this.prepare = function () {\r\n        var defaults = {\r\n            selector: '.edit',\r\n            document: document,\r\n            targetDocument: document,\r\n            componentMatch: [\r\n                {\r\n                    label:  function (node) {\r\n                        return 'Edit';\r\n                    },\r\n                    test: function (node) {\r\n                        return mw.tools.hasClass(node, 'edit');\r\n                    }\r\n                },\r\n                {\r\n                    label: function (node) {\r\n                        var icon = mw.top().live_edit.getModuleIcon(node.getAttribute('data-type'));\r\n                        return icon + ' ' + node.getAttribute('data-mw-title') || node.getAttribute('data-type');\r\n                    },\r\n                    test: function (node) {\r\n                        return mw.tools.hasClass(node, 'module');\r\n                    }\r\n                },\r\n                {\r\n                    label: 'Image',\r\n                    test: function (node) {\r\n                        return node.nodeName === 'IMG';\r\n                    }\r\n                },\r\n                {\r\n                    label:  function (node) {\r\n                        var id = node.id ? '#' + node.id : '';\r\n                        return node.nodeName.toLowerCase() ;\r\n                    },\r\n                    test: function (node) { return true; }\r\n                }\r\n            ],\r\n            componentTypes: [\r\n                {\r\n                    label: 'SafeMode',\r\n                    test: function (node) {\r\n                        return mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(node, [ 'safe-mode', 'regular-mode' ]);\r\n                    }\r\n                }\r\n            ]\r\n        };\r\n        options = options || {};\r\n\r\n        this.settings = $.extend({}, defaults, options);\r\n\r\n        this.$holder = $(this.settings.element);\r\n\r\n        this.document = this.settings.document;\r\n        this.targetDocument = this.settings.targetDocument;\r\n\r\n        this._selectedDomNode = null;\r\n    };\r\n    this.prepare();\r\n\r\n    this.createList = function () {\r\n        return this.document.createElement('ul');\r\n    };\r\n\r\n    this.createRoot = function () {\r\n        this.root = this.createList();\r\n        this.root.className = 'mw-defaults mw-domtree';\r\n    };\r\n\r\n\r\n    this._get = function (nodeOrTreeNode) {\r\n        return nodeOrTreeNode._value ? nodeOrTreeNode : this.findElementInTree(nodeOrTreeNode);\r\n    };\r\n\r\n    this.select = function (node) {\r\n        var el = this.getByNode(node);\r\n        if (el) {\r\n            this.selected(el);\r\n            this.openParents(el);\r\n            this._scrollTo(el);\r\n        }\r\n    };\r\n\r\n    this.toggle = function (nodeOrTreeNode) {\r\n        var li = this._get(nodeOrTreeNode);\r\n        this[ li._opened ? 'close' : 'open'](li);\r\n    };\r\n\r\n    this._opened = [];\r\n\r\n    this.open = function (nodeOrTreeNode) {\r\n        var li = this._get(nodeOrTreeNode);\r\n        li._opened = true;\r\n        li.classList.add('expand');\r\n        if(this._opened.indexOf(li._value) === -1) {\r\n            this._opened.push(li._value);\r\n        }\r\n    };\r\n    this.close = function (nodeOrTreeNode) {\r\n        var li = this._get(nodeOrTreeNode);\r\n        li._opened = false;\r\n        li.classList.remove('expand');\r\n        var ind = this._opened.indexOf(li._value);\r\n        if( ind !== -1 ) {\r\n            this._opened.splice(ind, ind)\r\n        }\r\n    };\r\n\r\n    this._scrollTo = function (el) {\r\n        setTimeout(function () {\r\n            scope.$holder.stop().animate({\r\n                scrollTop: (scope.$holder.scrollTop() + ($(el).offset().top - scope.$holder.offset().top)) - (scope.$holder.height()/2 - 10)\r\n            });\r\n        }, 55);\r\n    };\r\n\r\n    this.openParents = function (node) {\r\n        node = this._get(node);\r\n        while(node && node !== this.root) {\r\n            if(node.nodeName === 'LI'){\r\n                this.open(node);\r\n            }\r\n            node = node.parentNode;\r\n        }\r\n    };\r\n    this.selected = function (node) {\r\n        if (typeof node === 'undefined') {\r\n            return this._selectedDomNode;\r\n        }\r\n        mw.$('.selected', this.root).removeClass('selected');\r\n        node.classList.add('selected');\r\n        this._selectedDomNode = node;\r\n    };\r\n\r\n    this.getByNode = function (el) {\r\n        var all = this.root.querySelectorAll('li');\r\n        var l = all.length, i = 0;\r\n        for ( ; i < l; i++) {\r\n            if (all[i]._value === el) {\r\n                return all[i];\r\n            }\r\n        }\r\n    };\r\n\r\n    this.getByTreeNode = function (treeNode) {\r\n        return treeNode._value;\r\n    };\r\n\r\n    this.allDomNodes = function () {\r\n        return Array.from(this.map().keys());\r\n    };\r\n\r\n    this.allTreeNodes = function () {\r\n        return Array.from(this.map().values());\r\n    };\r\n\r\n    this.emptyTreeNode = function (node) {\r\n        var li = this.getByNode(node);\r\n        $(li).empty();\r\n        return li;\r\n    };\r\n\r\n    this.refresh = function (node) {\r\n        var item = this.emptyTreeNode(node);\r\n        this.createChildren(node, item);\r\n    };\r\n\r\n    this._currentTarget = null;\r\n    this.createItemEvents = function () {\r\n        $(this.root)\r\n            .on('mousemove', function (e) {\r\n                var target = e.target;\r\n                if(target.nodeName !== 'LI') {\r\n                    target = target.parentNode;\r\n                }\r\n                if(scope._currentTarget !== target) {\r\n                    scope._currentTarget = target;\r\n                    mw.$('li.hover', scope.root).removeClass('hover');\r\n                    target.classList.add('hover');\r\n                    if(scope.settings.onHover) {\r\n                        scope.settings.onHover.call(scope, e, target, target._value);\r\n                    }\r\n                }\r\n            })\r\n            .on('mouseleave', function (e) {\r\n                mw.$('li', scope.root).removeClass('hover');\r\n            })\r\n            .on('click', function (e) {\r\n                var target = e.target;\r\n\r\n                if(target.nodeName !== 'LI') {\r\n                    target = mw.tools.firstParentWithTag(target, 'li');\r\n                    scope.toggle(target);\r\n                }\r\n                scope.selected(target);\r\n                if(target.nodeName === 'LI' && scope.settings.onSelect) {\r\n                    scope.settings.onSelect.call(scope, e, target, target._value);\r\n                }\r\n            });\r\n    };\r\n\r\n    this.map = function (node, treeNode) {\r\n        if (!this._map) {\r\n            this._map = new Map();\r\n        }\r\n        if(!node) {\r\n            return this._map;\r\n        }\r\n        if (!treeNode) {\r\n            return this._map.get(node);\r\n        }\r\n        if (!this._map.has(node)) {\r\n            this._map.set(node, treeNode);\r\n        }\r\n    };\r\n\r\n    this.createItem = function (item) {\r\n        if(!this.validateNode(item)) {\r\n            return;\r\n        }\r\n        var li = this.document.createElement('li');\r\n        li._value = item;\r\n        li.className = 'mw-domtree-item' + (this._selectedDomNode === item ? ' active' : '');\r\n        var dio = item.children.length ? '<i class=\"mw-domtree-item-opener\"></i>' : '';\r\n        li.innerHTML = dio + '<span class=\"mw-domtree-item-label\">' + this.getComponentLabel(item) + '</span>';\r\n        return li;\r\n    };\r\n\r\n    this.getComponentLabel = function (node) {\r\n        var all = this.settings.componentMatch, i = 0;\r\n        for (  ; i < all.length; i++ ) {\r\n            if( all[i].test(node)) {\r\n                return typeof all[i].label === 'string' ? all[i].label : all[i].label.call(this, node);\r\n            }\r\n        }\r\n    };\r\n    this.isComponent = function (node) {\r\n        var all = this.settings.componentMatch, i = 0;\r\n        for (  ; i < all.length; i++ ) {\r\n            if( all[i].test(node)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n\r\n    this.validateNode = function (node) {\r\n        if(node.nodeType !== 1){\r\n            return false;\r\n        }\r\n        var tag = node.nodeName;\r\n        if(tag === 'SCRIPT' || tag === 'STYLE' || tag === 'LINK' || tag === 'BR') {\r\n            return false;\r\n        }\r\n        return this.isComponent(node);\r\n    };\r\n\r\n    this.create = function () {\r\n        var all = this.targetDocument.querySelectorAll(this.settings.selector);\r\n        var i = 0;\r\n        for (  ; i < all.length; i++ ) {\r\n            var item = this.createItem(all[i]);\r\n            if(item) {\r\n                this.root.appendChild(item);\r\n                this.createChildren(all[i], item);\r\n            }\r\n        }\r\n        this.createItemEvents();\r\n        $(this.settings.element).empty().append(this.root).resizable({\r\n            handles: \"s\",\r\n            start: function( event, ui ) {\r\n                ui.element.css('maxHeight', 'none');\r\n            }\r\n        });\r\n    };\r\n\r\n    this.createChildren = function (node, parent) {\r\n        if(!parent) return;\r\n        var list = this.createList();\r\n        var curr = node.children[0];\r\n        while (curr) {\r\n            var item = this.createItem(curr);\r\n            if (item) {\r\n                list.appendChild(item);\r\n                if (curr.children.length) {\r\n                    this.createChildren(curr, item);\r\n                }\r\n            }\r\n            curr = curr.nextElementSibling;\r\n        }\r\n        parent.appendChild(list);\r\n    };\r\n\r\n    this.init = function () {\r\n        this.createRoot();\r\n        this.create();\r\n    };\r\n\r\n    this.init();\r\n\r\n};\r\n","mw.require('libs/cssjson/cssjson.js');\r\n\r\n\r\nmw.liveeditCSSEditor = function (config) {\r\n    var scope = this;\r\n    config = config || {};\r\n    config.document = config.document || document;\r\n    var node = document.querySelector('link[href*=\"live_edit\"]');\r\n    var defaults = {\r\n        cssUrl: node ? node.href : null,\r\n        saveUrl: mw.settings.api_url + \"current_template_save_custom_css\"\r\n    };\r\n    this.settings = $.extend({}, defaults, config);\r\n\r\n    this.json = null;\r\n\r\n    this.getByUrl = function (url, callback) {\r\n        return $.get(url, function (css) {\r\n            callback.call(this, css)\r\n        });\r\n    };\r\n\r\n    this.getLiveeditCSS = function () {\r\n        if( this.settings.cssUrl ) {\r\n            this.getByUrl( this.settings.cssUrl, function (css) {\r\n                if(/<\\/?[a-z][\\s\\S]*>/i.test(css)) {\r\n                    scope.json = {};\r\n                    scope._css = '';\r\n                } else {\r\n                    scope.json = CSSJSON.toJSON(css);\r\n                    scope._css = css;\r\n                }\r\n                $(scope).trigger('ready');\r\n            });\r\n        }\r\n        else {\r\n            scope.json = {};\r\n            scope._css = '';\r\n            $(scope).trigger('ready');\r\n        }\r\n    };\r\n\r\n\r\n    this._cssTemp = function (json) {\r\n        var css = CSSJSON.toCSS(json);\r\n        if(!mw.liveedit._cssTemp) {\r\n            mw.liveedit._cssTemp = mw.tools.createStyle('#mw-liveedit-dynamic-temp-style', css, document.body);\r\n            mw.liveedit._cssTemp.id = 'mw-liveedit-dynamic-temp-style';\r\n        } else {\r\n            mw.liveedit._cssTemp.innerHTML = css;\r\n        }\r\n    };\r\n\r\n    this.changed = false;\r\n    this._temp = {children: {}, attributes: {}};\r\n    this.temp = function (node, prop, val) {\r\n        this.changed = true;\r\n        if(node.length) {\r\n            node = node[0];\r\n        }\r\n        var sel = mw.tools.generateSelectorForNode(node);\r\n        if(!this._temp.children[sel]) {\r\n            this._temp.children[sel] = {};\r\n        }\r\n        if (!this._temp.children[sel].attributes ) {\r\n            this._temp.children[sel].attributes = {};\r\n        }\r\n        this._temp.children[sel].attributes[prop] = val;\r\n        this._cssTemp(this._temp);\r\n    };\r\n\r\n    this.timeOut = null;\r\n\r\n    this.save = function () {\r\n        this.json = $.extend(true, {}, this.json, this._temp);\r\n        this._css = CSSJSON.toCSS(this.json).replace(/\\.\\./g, '.').replace(/\\.\\./g, '.');\r\n    };\r\n\r\n    this.publish = function (callback) {\r\n        var css = {\r\n            css_file_content: this.getValue()\r\n        };\r\n        $.post(this.settings.saveUrl, css, function (res) {\r\n            scope.changed = false;\r\n            if(callback) {\r\n                callback.call(this, res);\r\n            }\r\n        });\r\n    };\r\n\r\n    this.publishIfChanged = function (callback) {\r\n        if(this.changed) {\r\n            this.publish(callback);\r\n        }\r\n    };\r\n\r\n    this.getValue = function () {\r\n        this.save();\r\n        return this._css;\r\n    };\r\n\r\n    this.init = function () {\r\n        this.getLiveeditCSS();\r\n    };\r\n\r\n    this.init();\r\n\r\n};\r\n\r\n","mw.tools.base64 = {\r\n// private property\r\n    _keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\r\n// public method for encoding\r\n    encode: function (input) {\r\n        var output = \"\";\r\n        var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\r\n        var i = 0;\r\n        input = mw.tools.base64._utf8_encode(input);\r\n        while (i < input.length) {\r\n            chr1 = input.charCodeAt(i++);\r\n            chr2 = input.charCodeAt(i++);\r\n            chr3 = input.charCodeAt(i++);\r\n            enc1 = chr1 >> 2;\r\n            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n            enc4 = chr3 & 63;\r\n            if (isNaN(chr2)) {\r\n                enc3 = enc4 = 64;\r\n            } else if (isNaN(chr3)) {\r\n                enc4 = 64;\r\n            }\r\n            output = output +\r\n                this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +\r\n                this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);\r\n        }\r\n        return output;\r\n    },\r\n// public method for decoding\r\n    decode: function (input) {\r\n        if (typeof input == 'undefined') {\r\n            return;\r\n        }\r\n        var output = \"\";\r\n        var chr1, chr2, chr3;\r\n        var enc1, enc2, enc3, enc4;\r\n        var i = 0;\r\n        input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\r\n        while (i < input.length) {\r\n            enc1 = this._keyStr.indexOf(input.charAt(i++));\r\n            enc2 = this._keyStr.indexOf(input.charAt(i++));\r\n            enc3 = this._keyStr.indexOf(input.charAt(i++));\r\n            enc4 = this._keyStr.indexOf(input.charAt(i++));\r\n            chr1 = (enc1 << 2) | (enc2 >> 4);\r\n            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\r\n            chr3 = ((enc3 & 3) << 6) | enc4;\r\n            output = output + String.fromCharCode(chr1);\r\n            if (enc3 != 64) {\r\n                output = output + String.fromCharCode(chr2);\r\n            }\r\n            if (enc4 != 64) {\r\n                output = output + String.fromCharCode(chr3);\r\n            }\r\n        }\r\n        output = mw.tools.base64._utf8_decode(output);\r\n        return output;\r\n    },\r\n// private method for UTF-8 encoding\r\n    _utf8_encode: function (string) {\r\n        string = string.replace(/\\r\\n/g, \"\\n\");\r\n        var utftext = \"\";\r\n        for (var n = 0; n < string.length; n++) {\r\n            var c = string.charCodeAt(n);\r\n            if (c < 128) {\r\n                utftext += String.fromCharCode(c);\r\n            }\r\n            else if ((c > 127) && (c < 2048)) {\r\n                utftext += String.fromCharCode((c >> 6) | 192);\r\n                utftext += String.fromCharCode((c & 63) | 128);\r\n            }\r\n            else {\r\n                utftext += String.fromCharCode((c >> 12) | 224);\r\n                utftext += String.fromCharCode(((c >> 6) & 63) | 128);\r\n                utftext += String.fromCharCode((c & 63) | 128);\r\n            }\r\n        }\r\n        return utftext;\r\n    },\r\n// private method for UTF-8 decoding\r\n    _utf8_decode: function (utftext) {\r\n        var string = \"\";\r\n        var i = 0;\r\n        var c = c1 = c2 = 0;\r\n        while (i < utftext.length) {\r\n            c = utftext.charCodeAt(i);\r\n            if (c < 128) {\r\n                string += String.fromCharCode(c);\r\n                i++;\r\n            }\r\n            else if ((c > 191) && (c < 224)) {\r\n                c2 = utftext.charCodeAt(i + 1);\r\n                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\r\n                i += 2;\r\n            }\r\n            else {\r\n                c2 = utftext.charCodeAt(i + 1);\r\n                c3 = utftext.charCodeAt(i + 2);\r\n                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n                i += 3;\r\n            }\r\n        }\r\n        return string;\r\n    }\r\n}","mw.image.description =  {\r\n    add: function (text) {\r\n        var img = document.querySelector(\"img.element-current\");\r\n        img.title = text;\r\n    },\r\n    get: function () {\r\n        return document.querySelector(\"img.element-current\").title;\r\n    },\r\n    init: function (id) {\r\n        var area = mw.$(id);\r\n        area.hover(function () {\r\n            area.addClass(\"desc_area_hover\");\r\n        }, function () {\r\n            area.removeClass(\"desc_area_hover\");\r\n        });\r\n        var curr = mw.image.description.get();\r\n        if (!area.hasClass(\"inited\")) {\r\n            area.addClass(\"inited\");\r\n            area.bind(\"keyup change paste\", function () {\r\n                var val = mw.$(this).val();\r\n                mw.image.description.add(val);\r\n            });\r\n        }\r\n        area.val(curr);\r\n        area.show();\r\n    }\r\n};\r\n\r\nmw.image.settings = function () {\r\n    return mw.dialogIframe({\r\n        url: 'imageeditor',\r\n        template: \"mw_modal_basic\",\r\n        overlay: true,\r\n        width: '600',\r\n        height: \"auto\",\r\n        autoHeight: true,\r\n        name: 'mw-image-settings-modal'\r\n    });\r\n};\r\n\r\n\r\n(function (){\r\n    var image = {\r\n        isResizing: false,\r\n        currentResizing: null,\r\n        resize: {\r\n            create_resizer: function () {\r\n                if (!mw.image_resizer) {\r\n                    var resizer = document.createElement('div');\r\n                    resizer.className = 'mw-defaults mw_image_resizer';\r\n                    resizer.innerHTML = '<div id=\"image-edit-nav\"><span onclick=\"mw.wysiwyg.media(\\'#editimage\\');\" class=\"mw-ui-btn mw-ui-btn-medium mw-ui-btn-invert mw-ui-btn-icon image_change tip\" data-tip=\"' + mw.msg.change + '\"><span class=\"mdi mdi-image mdi-18px\"></span></span><span class=\"mw-ui-btn mw-ui-btn-medium mw-ui-btn-invert mw-ui-btn-icon tip image_change\" id=\"image-settings-button\" data-tip=\"' + mw.msg.edit + '\" onclick=\"mw.image.settings();\"><span class=\"mdi mdi-pencil mdi-18px\"></span></span></div>';\r\n                    document.body.appendChild(resizer);\r\n                    mw.image_resizer = resizer;\r\n                    mw.image_resizer_time = null;\r\n                    mw.image_resizer._show = function () {\r\n                        clearTimeout(mw.image_resizer_time);\r\n                        mw.$(mw.image_resizer).addClass('active');\r\n                    };\r\n                    mw.image_resizer._hide = function () {\r\n                        clearTimeout(mw.image_resizer_time);\r\n                        mw.image_resizer_time = setTimeout(function () {\r\n                            mw.$(mw.image_resizer).removeClass('active');\r\n                        }, 3000)\r\n                    };\r\n\r\n                    mw.$(resizer).on(\"click\", function (e) {\r\n                        if (mw.image.currentResizing[0].nodeName === 'IMG') {\r\n                            mw.wysiwyg.select_element(mw.image.currentResizing[0]);\r\n                        }\r\n                    });\r\n                    mw.$(resizer).on(\"dblclick\", function (e) {\r\n                        mw.wysiwyg.media('#editimage');\r\n                    });\r\n                }\r\n            },\r\n            prepare: function () {\r\n                mw.image.resize.create_resizer();\r\n                mw.$(mw.image_resizer).resizable({\r\n                    handles: \"all\",\r\n                    minWidth: 60,\r\n                    minHeight: 60,\r\n                    start: function () {\r\n                        mw.image.isResizing = true;\r\n                        mw.$(mw.image_resizer).resizable(\"option\", \"maxWidth\", mw.image.currentResizing.parent().width());\r\n                        mw.$(mw.tools.firstParentWithClass(mw.image.currentResizing[0], 'edit')).addClass(\"changed\");\r\n                    },\r\n                    stop: function () {\r\n                        mw.image.isResizing = false;\r\n                        mw.drag.fix_placeholders();\r\n                    },\r\n                    resize: function () {\r\n                        var offset = mw.image.currentResizing.offset();\r\n                        mw.$(this).css(offset);\r\n                    },\r\n                    aspectRatio: 16 / 9\r\n                });\r\n                mw.image_resizer.mwImageResizerComponent = true;\r\n                var all = mw.image_resizer.querySelectorAll('*'), l = all.length, i = 0;\r\n                for (; i < l; i++) all[i].mwImageResizerComponent = true\r\n            },\r\n            resizerSet: function (el, selectImage) {\r\n                var selectImage = typeof selectImage === 'undefined' ? true : selectImage;\r\n                /*  var order = mw.tools.parentsOrder(el, ['edit', 'module']);\r\n                 if(!(order.module > -1 && order.edit > order.module) && order.edit>-1){   */\r\n\r\n\r\n                mw.$('.ui-resizable-handle', mw.image_resizer)[el.nodeName == 'IMG' ? 'show' : 'hide']()\r\n\r\n                var el = mw.$(el);\r\n                var offset = el.offset();\r\n                var parent = el.parent();\r\n                var parentOffset = parent.offset();\r\n                if(parent[0].nodeName !== 'A'){\r\n                    offset.top = offset.top < parentOffset.top ? parentOffset.top : offset.top;\r\n                    offset.left = offset.left < parentOffset.left ? parentOffset.left : offset.left;\r\n                }\r\n                var r = mw.$(mw.image_resizer);\r\n                var width = el.outerWidth();\r\n                var height = el.outerHeight();\r\n                r.css({\r\n                    left: offset.left,\r\n                    top: offset.top,\r\n                    width: width,\r\n                    height: mw.tools.hasParentsWithClass(el[0], 'mw-image-holder') ? 1 : height\r\n                });\r\n                r.addClass(\"active\");\r\n                mw.$(mw.image_resizer).resizable(\"option\", \"alsoResize\", el);\r\n                mw.$(mw.image_resizer).resizable(\"option\", \"aspectRatio\", width / height);\r\n                mw.image.currentResizing = el;\r\n                if (!el[0].contentEditable) {\r\n                    mw.wysiwyg.contentEditable(el[0], true);\r\n                }\r\n\r\n                if (selectImage) {\r\n                    if (el[0].parentNode.tagName !== 'A') {\r\n                        mw.wysiwyg.select_element(el[0]);\r\n                    }\r\n                    else {\r\n                        mw.wysiwyg.select_element(el[0].parentNode);\r\n                    }\r\n                }\r\n                if (document.getElementById('image-settings-button') !== null) {\r\n                    if (!!el[0].src && el[0].src.contains('userfiles/media/pixum/')) {\r\n                        document.getElementById('image-settings-button').style.display = 'none';\r\n                    }\r\n                    else {\r\n                        document.getElementById('image-settings-button').style.display = '';\r\n                    }\r\n                }\r\n                /* } */\r\n            },\r\n            init: function (selector) {\r\n                mw.image_resizer == undefined ? mw.image.resize.prepare() : '';\r\n\r\n                mw.on(\"ImageClick\", function (e, el) {\r\n                    if (!mw.image.isResizing && !mw.isDrag && !mw.settings.resize_started && el.tagName === 'IMG') {\r\n                        mw.image.resize.resizerSet(el);\r\n                    }\r\n                })\r\n            }\r\n        },\r\n\r\n        _isrotating: false,\r\n        rotate: function (img_object, angle) {\r\n            if (!mw.image.Rotator) {\r\n                mw.image.Rotator = document.createElement('canvas');\r\n                mw.image.Rotator.style.top = '-9999px';\r\n                mw.image.Rotator.style.left = '-9999px';\r\n                mw.image.Rotator.style.position = 'absolute';\r\n                mw.image.RotatorContext = mw.image.Rotator.getContext('2d');\r\n                document.body.appendChild(mw.image.Rotator);\r\n            }\r\n            if (!mw.image._isrotating) {\r\n                mw.image._isrotating = true;\r\n                img_object = img_object || document.querySelector(\"img.element-current\");\r\n                if (img_object === null) {\r\n                    return false;\r\n                }\r\n                mw.image.preload(img_object.src, function () {\r\n                    if (!img_object.src.contains(\"base64\")) {\r\n                        var currDomain = mw.url.getDomain(window.location.href);\r\n                        var srcDomain = mw.url.getDomain(img_object.src);\r\n                        if (currDomain !== srcDomain) {\r\n                            mw.tools.alert(\"This action is allowed for images on the same domain.\");\r\n                            return false;\r\n                        }\r\n                    }\r\n                    var angle = angle || 90;\r\n                    var image = mw.$(this);\r\n                    var w = this.naturalWidth;\r\n                    var h = this.naturalHeight;\r\n                    var contextWidth = w;\r\n                    var contextHeight = h;\r\n                    var x = 0;\r\n                    var y = 0;\r\n                    switch (angle) {\r\n                        case 90:\r\n                            contextWidth = h;\r\n                            contextHeight = w;\r\n                            y = -h;\r\n                            break;\r\n                        case 180:\r\n                            x = -w;\r\n                            y = -h;\r\n                            break;\r\n                        case 270:\r\n                            contextWidth = h;\r\n                            contextHeight = w;\r\n                            x = -w;\r\n                            break;\r\n                        default:\r\n                            contextWidth = h;\r\n                            contextHeight = w;\r\n                            y = -h;\r\n                    }\r\n                    mw.image.Rotator.setAttribute('width', contextWidth);\r\n                    mw.image.Rotator.setAttribute('height', contextHeight);\r\n                    mw.image.RotatorContext.rotate(angle * Math.PI / 180);\r\n                    mw.image.RotatorContext.drawImage(img_object, x, y);\r\n                    var data = mw.image.Rotator.toDataURL(\"image/png\");\r\n                    img_object.src = data;\r\n                    mw.image._isrotating = false;\r\n                    if (!!mw.wysiwyg) mw.wysiwyg.normalizeBase64Image(img_object);\r\n                });\r\n            }\r\n        },\r\n        grayscale: function (node) {\r\n            var node = node || document.querySelector(\"img.element-current\");\r\n            if (node === null) {\r\n                return false;\r\n            }\r\n            mw.image.preload(node.src, function () {\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                canvas.width = this.naturalWidth;\r\n                canvas.height = this.naturalHeight;\r\n                ctx.drawImage(node, 0, 0);\r\n                var imgPixels = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n                for (var y = 0; y < imgPixels.height; y++) {\r\n                    for (var x = 0; x < imgPixels.width; x++) {\r\n                        var i = (y * 4) * imgPixels.width + x * 4; //Why is this multiplied by 4?\r\n                        var avg = (imgPixels.data[i] + imgPixels.data[i + 1] + imgPixels.data[i + 2]) / 3;\r\n                        imgPixels.data[i] = avg;\r\n                        imgPixels.data[i + 1] = avg;\r\n                        imgPixels.data[i + 2] = avg;\r\n                    }\r\n                }\r\n                ctx.putImageData(imgPixels, 0, 0, 0, 0, imgPixels.width, imgPixels.height);\r\n                node.src = canvas.toDataURL();\r\n                if (!!mw.wysiwyg) mw.wysiwyg.normalizeBase64Image(node);\r\n            })\r\n        },\r\n        vr: [0, 0, 0, 1, 1, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 7, 7, 7, 7, 8, 8, 8, 9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 12, 12, 12, 12, 13, 13, 13, 14, 14, 15, 15, 16, 16, 17, 17, 17, 18, 19, 19, 20, 21, 22, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 39, 40, 41, 42, 44, 45, 47, 48, 49, 52, 54, 55, 57, 59, 60, 62, 65, 67, 69, 70, 72, 74, 77, 79, 81, 83, 86, 88, 90, 92, 94, 97, 99, 101, 103, 107, 109, 111, 112, 116, 118, 120, 124, 126, 127, 129, 133, 135, 136, 140, 142, 143, 145, 149, 150, 152, 155, 157, 159, 162, 163, 165, 167, 170, 171, 173, 176, 177, 178, 180, 183, 184, 185, 188, 189, 190, 192, 194, 195, 196, 198, 200, 201, 202, 203, 204, 206, 207, 208, 209, 211, 212, 213, 214, 215, 216, 218, 219, 219, 220, 221, 222, 223, 224, 225, 226, 227, 227, 228, 229, 229, 230, 231, 232, 232, 233, 234, 234, 235, 236, 236, 237, 238, 238, 239, 239, 240, 241, 241, 242, 242, 243, 244, 244, 245, 245, 245, 246, 247, 247, 248, 248, 249, 249, 249, 250, 251, 251, 252, 252, 252, 253, 254, 254, 254, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255],\r\n        vg: [0, 0, 1, 2, 2, 3, 5, 5, 6, 7, 8, 8, 10, 11, 11, 12, 13, 15, 15, 16, 17, 18, 18, 19, 21, 22, 22, 23, 24, 26, 26, 27, 28, 29, 31, 31, 32, 33, 34, 35, 35, 37, 38, 39, 40, 41, 43, 44, 44, 45, 46, 47, 48, 50, 51, 52, 53, 54, 56, 57, 58, 59, 60, 61, 63, 64, 65, 66, 67, 68, 69, 71, 72, 73, 74, 75, 76, 77, 79, 80, 81, 83, 84, 85, 86, 88, 89, 90, 92, 93, 94, 95, 96, 97, 100, 101, 102, 103, 105, 106, 107, 108, 109, 111, 113, 114, 115, 117, 118, 119, 120, 122, 123, 124, 126, 127, 128, 129, 131, 132, 133, 135, 136, 137, 138, 140, 141, 142, 144, 145, 146, 148, 149, 150, 151, 153, 154, 155, 157, 158, 159, 160, 162, 163, 164, 166, 167, 168, 169, 171, 172, 173, 174, 175, 176, 177, 178, 179, 181, 182, 183, 184, 186, 186, 187, 188, 189, 190, 192, 193, 194, 195, 195, 196, 197, 199, 200, 201, 202, 202, 203, 204, 205, 206, 207, 208, 208, 209, 210, 211, 212, 213, 214, 214, 215, 216, 217, 218, 219, 219, 220, 221, 222, 223, 223, 224, 225, 226, 226, 227, 228, 228, 229, 230, 231, 232, 232, 232, 233, 234, 235, 235, 236, 236, 237, 238, 238, 239, 239, 240, 240, 241, 242, 242, 242, 243, 244, 245, 245, 246, 246, 247, 247, 248, 249, 249, 249, 250, 251, 251, 252, 252, 252, 253, 254, 255],\r\n        vb: [53, 53, 53, 54, 54, 54, 55, 55, 55, 56, 57, 57, 57, 58, 58, 58, 59, 59, 59, 60, 61, 61, 61, 62, 62, 63, 63, 63, 64, 65, 65, 65, 66, 66, 67, 67, 67, 68, 69, 69, 69, 70, 70, 71, 71, 72, 73, 73, 73, 74, 74, 75, 75, 76, 77, 77, 78, 78, 79, 79, 80, 81, 81, 82, 82, 83, 83, 84, 85, 85, 86, 86, 87, 87, 88, 89, 89, 90, 90, 91, 91, 93, 93, 94, 94, 95, 95, 96, 97, 98, 98, 99, 99, 100, 101, 102, 102, 103, 104, 105, 105, 106, 106, 107, 108, 109, 109, 110, 111, 111, 112, 113, 114, 114, 115, 116, 117, 117, 118, 119, 119, 121, 121, 122, 122, 123, 124, 125, 126, 126, 127, 128, 129, 129, 130, 131, 132, 132, 133, 134, 134, 135, 136, 137, 137, 138, 139, 140, 140, 141, 142, 142, 143, 144, 145, 145, 146, 146, 148, 148, 149, 149, 150, 151, 152, 152, 153, 153, 154, 155, 156, 156, 157, 157, 158, 159, 160, 160, 161, 161, 162, 162, 163, 164, 164, 165, 165, 166, 166, 167, 168, 168, 169, 169, 170, 170, 171, 172, 172, 173, 173, 174, 174, 175, 176, 176, 177, 177, 177, 178, 178, 179, 180, 180, 181, 181, 181, 182, 182, 183, 184, 184, 184, 185, 185, 186, 186, 186, 187, 188, 188, 188, 189, 189, 189, 190, 190, 191, 191, 192, 192, 193, 193, 193, 194, 194, 194, 195, 196, 196, 196, 197, 197, 197, 198, 199],\r\n        vintage: function (node) {\r\n            var node = node || document.querySelector(\"img.element-current\");\r\n            if (node === null) {\r\n                return false;\r\n            }\r\n            var canvas = document.createElement('canvas');\r\n            var ctx = canvas.getContext('2d');\r\n            mw.image.preload(node.src, function (w, h) {\r\n                canvas.width = w;\r\n                canvas.height = h;\r\n                ctx.drawImage(node, 0, 0);\r\n                var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height), l = imageData.data.length, i = 0;\r\n                for (; i < l; i += 4) {\r\n                    imageData.data[i] = mw.image.vr[imageData.data[i]];\r\n                    imageData.data[i + 1] = mw.image.vg[imageData.data[i + 1]];\r\n                    imageData.data[i + 2] = mw.image.vb[imageData.data[i + 2]];\r\n                    if (noise > 0) {\r\n                        var noise = Math.round(noise - Math.random() * noise), j = 0;\r\n                        for (; j < 3; j++) {\r\n                            var iPN = noise + imageData.data[i + j];\r\n                            imageData.data[i + j] = (iPN > 255) ? 255 : iPN;\r\n                        }\r\n                    }\r\n                }\r\n                ctx.putImageData(imageData, 0, 0);\r\n                node.src = canvas.toDataURL();\r\n                if (!!mw.wysiwyg) mw.wysiwyg.normalizeBase64Image(node);\r\n                mw.$(canvas).remove()\r\n            });\r\n        },\r\n        _dragActivated: false,\r\n        _dragcurrent: null,\r\n        _dragparent: null,\r\n        _dragcursorAt: {x: 0, y: 0},\r\n        _dragTxt: function (e) {\r\n            if (mw.image._dragcurrent !== null) {\r\n                mw.image._dragcursorAt.x = e.pageX - mw.image._dragcurrent.offsetLeft;\r\n                mw.image._dragcursorAt.y = e.pageY - mw.image._dragcurrent.offsetTop;\r\n                var x = e.pageX - mw.image._dragparent.offsetLeft - mw.image._dragcurrent.startedX - mw.image._dragcursorAt.x;\r\n                var y = e.pageY - mw.image._dragparent.offsetTop - mw.image._dragcurrent.startedY - mw.image._dragcursorAt.y;\r\n                mw.image._dragcurrent.style.top = y + 'px';\r\n                mw.image._dragcurrent.style.left = x + 'px';\r\n            }\r\n        }\r\n    };\r\n\r\n    for (var i in image) {\r\n        mw.image[i] = image[i];\r\n    }\r\n})();\r\n","(function(){\r\n    var systemDialogs = {\r\n        moduleFrame: function(type, params, autoHeight){\r\n            if(typeof autoHeight === 'undefined') {\r\n                autoHeight = true;\r\n            }\r\n            params = params || {};\r\n            if(!type) return;\r\n\r\n            var frame = document.createElement('iframe');\r\n            frame.className = 'mw-editor-frame';\r\n            frame.allow = 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture';\r\n            frame.allowFullscreen = true;\r\n            frame.scrolling = \"auto\";\r\n            frame.width = \"100%\";\r\n            frame.frameBorder = \"0\";\r\n            frame.src = mw.external_tool('module') + '?type=' + type + '&params=' + $.param(params).split('&').join(',');\r\n            if(autoHeight) {\r\n                mw.tools.iframeAutoHeight(frame)\r\n            }\r\n            return frame;\r\n        },\r\n          confirm_reset_module_by_id: function (module_id, cb) {\r\n            var result = confirm(\"Are you sure you want to reset this module?\");\r\n            if (result) {\r\n            var is_a_preset = mw.$('#'+module_id).attr('data-module-original-id');\r\n            var is_a_preset_attrs = mw.$('#'+module_id).attr('data-module-original-attrs');\r\n            if(is_a_preset){\r\n                var orig_attrs_decoded = JSON.parse(window.atob(is_a_preset_attrs));\r\n                if (orig_attrs_decoded) {\r\n                    mw.$('#'+module_id).removeAttr('data-module-original-id');\r\n                    mw.$('#'+module_id).removeAttr('data-module-original-attrs');\r\n                    mw.$('#'+module_id).attr(orig_attrs_decoded).reload_module();\r\n\r\n                    if(  mw.top().win.module_settings_modal_reference_preset_editor_thismodal ){\r\n                        mw.top().win.module_settings_modal_reference_preset_editor_thismodal.remove();\r\n                    }\r\n                 }\r\n                 return;\r\n            }\r\n\r\n            var data = {};\r\n            data.modules_ids = [module_id];\r\n\r\n            var childs_arr = [];\r\n            mw.$('#'+module_id).andSelf().find('.edit').each(function (i) {\r\n                var some_child = {};\r\n                mw.tools.removeClass(this, 'changed')\r\n                some_child.rel = mw.$(this).attr('rel');\r\n                some_child.field = mw.$(this).attr('field');\r\n                childs_arr.push(some_child);\r\n            });\r\n\r\n\r\n          mw.$('#'+module_id).andSelf().find('.module').each(function (i) {\r\n\r\n              var some_child = mw.$(this).attr('id');\r\n\r\n              data.modules_ids.push(some_child);\r\n\r\n          });\r\n\r\n            window.mw.on.DOMChangePause = true;\r\n            var done = 0, alldone = 1;\r\n\r\n            if (childs_arr.length) {\r\n                alldone++;\r\n                $.ajax({\r\n                    type: \"POST\",\r\n                   // dataType: \"json\",\r\n                    //processData: false,\r\n                    url: mw.settings.api_url + \"content/reset_edit\",\r\n                    data: {reset:childs_arr}\r\n                  //  success: success,\r\n                  //  dataType: dataType\r\n                }).always(function (){\r\n                    done++;\r\n                    if(done === alldone) {\r\n                        if(cb){\r\n                            cb.call()\r\n                        }\r\n                    }\r\n                });\r\n           }\r\n\r\n\r\n           //data-module-original-attrs\r\n\r\n            $.ajax({\r\n                type: \"POST\",\r\n                // dataType: \"json\",\r\n                //processData: false,\r\n                url: mw.settings.api_url + \"content/reset_modules_settings\",\r\n                data: data,\r\n                success: function(){\r\n\r\n                    setTimeout(function () {\r\n\r\n\r\n                        mw.$('#'+module_id).removeAttr('data-module-original-id');\r\n                        mw.reload_module('#'+module_id);\r\n                        window.mw.on.DOMChangePause = false;\r\n\r\n                    }, 1000);\r\n                    done++;\r\n                    if(done === alldone) {\r\n                        if(cb){\r\n                            cb.call()\r\n                        }\r\n                    }\r\n\r\n                 },\r\n            });\r\n        }\r\n              return result;\r\n    },\r\n    open_reset_content_editor: function (root_element_id) {\r\n\r\n        var src = mw.settings.site_url + 'api/module?id=mw_global_reset_content_editor&live_edit=true&module_settings=true&type=editor/reset_content&autosize=true';\r\n\r\n        if(typeof(root_element_id) != 'undefined') {\r\n            var src = src + '&root_element_id='+root_element_id;\r\n        }\r\n\r\n        // mw.dialogIframe({\r\n        var modal = mw.dialogIframe({\r\n            url: src,\r\n            // width: 500,\r\n            // height: mw.$(window).height() - (2.5 * mw.tools.TemplateSettingsModalDefaults.top),\r\n            name: 'mw-reset-content-editor-front',\r\n            title: 'Reset content',\r\n            template: 'default',\r\n            center: false,\r\n            resize: true,\r\n            autosize: true,\r\n            autoHeight: true,\r\n            draggable: true\r\n        });\r\n    },\r\n    open_global_module_settings_modal: function (module_type, module_id, modalOptions, additional_params) {\r\n\r\n\r\n        var params = {};\r\n        params.id = module_id;\r\n        params.live_edit = true;\r\n        params.module_settings = true;\r\n        params.type = module_type;\r\n        params.autosize = false;\r\n\r\n        var params_url = $.extend({}, params, additional_params);\r\n\r\n        var src = mw.settings.site_url + \"api/module?\" + json2url(params_url);\r\n\r\n\r\n        modalOptions = modalOptions || {};\r\n\r\n        var defaultOpts = {\r\n            url: src,\r\n            // width: 500,\r\n            height: 'auto',\r\n            autoHeight: true,\r\n            name: 'mw-module-settings-editor-front',\r\n            title: 'Settings',\r\n            template: 'default',\r\n            center: false,\r\n            resize: true,\r\n            draggable: true\r\n        };\r\n\r\n        var settings = $.extend({}, defaultOpts, modalOptions);\r\n\r\n        // return mw.dialogIframe(settings);\r\n        return mw.top().dialogIframe(settings);\r\n    },\r\n    open_module_modal: function (module_type, params, modalOptions) {\r\n\r\n        var id = mw.id('module-modal-');\r\n        var id_content = id + '-content';\r\n        modalOptions = modalOptions || {};\r\n\r\n        var settings = $.extend({}, {\r\n            content: '<div class=\"module-modal-content\" id=\"' + id_content + '\"></div>',\r\n            id: id\r\n        }, modalOptions, {skin: 'default'});\r\n\r\n        var xhr = false;\r\n        var openiframe = false;\r\n        if (typeof (settings.iframe) != 'undefined' && settings.iframe) {\r\n            openiframe = true;\r\n        }\r\n        if (openiframe) {\r\n\r\n            var additional_params = {};\r\n            additional_params.type = module_type;\r\n            var params_url = $.extend({}, params, additional_params);\r\n            var src = mw.settings.site_url + \"api/module?\" + json2url(params_url);\r\n\r\n\r\n            var settings = {\r\n                url: src,\r\n                name: 'mw-module-settings-editor-front',\r\n                title: 'Settings',\r\n                center: false,\r\n                resize: true,\r\n                draggable: true,\r\n                height:'auto',\r\n                autoHeight: true\r\n            };\r\n            return mw.top().dialogIframe(settings);\r\n\r\n        } else {\r\n            delete settings.skin;\r\n            delete settings.template;\r\n            settings.height = 'auto';\r\n            settings.autoHeight = true;\r\n            settings.encapsulate = false;\r\n            var modal = mw.dialog(settings);\r\n            xhr = mw.load_module(module_type, '#' + id_content, function(){\r\n                setTimeout(function(){\r\n                    modal.center();\r\n                },333)\r\n            }, params);\r\n        }\r\n\r\n\r\n        return {\r\n            xhr: xhr,\r\n            modal: modal,\r\n        }\r\n    }\r\n    };\r\n\r\n    for (var i in systemDialogs) {\r\n        mw.tools[i] = systemDialogs[i];\r\n    }\r\n})()\r\n","mw._colorPickerDefaults = {\r\n    skin: 'mw-tooltip-default',\r\n    position: 'bottom-center',\r\n    onchange: false\r\n};\r\n\r\nmw._colorPicker = function (options) {\r\n    mw.lib.require('colorpicker');\r\n    if (!mw.tools.colorPickerColors) {\r\n        mw.tools.colorPickerColors = [];\r\n\r\n         var colorpicker_els = mw.top().$(\".btn,h1,h2,h3,h4,h5\");\r\n         if(colorpicker_els.length > 0){\r\n             colorpicker_els.each(function () {\r\n                 var css = parent.getComputedStyle(this, null);\r\n                 if (css !== null) {\r\n                     if (mw.tools.colorPickerColors.indexOf(css.color) === -1) {\r\n                         mw.tools.colorPickerColors.push(mw.color.rgbToHex(css.color));\r\n                     }\r\n                     if (mw.tools.colorPickerColors.indexOf(css.backgroundColor) === -1) {\r\n                         mw.tools.colorPickerColors.push(mw.color.rgbToHex(css.backgroundColor));\r\n                     }\r\n                 }\r\n             });\r\n         }\r\n\r\n    }\r\n    var proto = this;\r\n    if (!options) {\r\n        return false;\r\n    }\r\n\r\n    var settings = $.extend({}, mw._colorPickerDefaults, options);\r\n\r\n    if (settings.element === undefined || settings.element === null) {\r\n        return false;\r\n    }\r\n\r\n\r\n\r\n    var $el = mw.$(settings.element);\r\n    if ($el[0] === undefined) {\r\n        return false;\r\n    }\r\n    if($el[0].mwcolorPicker) {\r\n        return $el[0].mwcolorPicker;\r\n    }\r\n\r\n\r\n    $el[0].mwcolorPicker = this;\r\n    this.element = $el[0];\r\n    if ($el[0].mwToolTipBinded !== undefined) {\r\n        return false;\r\n    }\r\n    if (!settings.method) {\r\n        if (this.element.nodeName === 'DIV') {\r\n            settings.method = 'inline';\r\n        }\r\n    }\r\n    this.settings = settings;\r\n\r\n    $el[0].mwToolTipBinded = true;\r\n    var sett = {\r\n        showAlpha: true,\r\n        showHSL: false,\r\n        showRGB: false,\r\n        showHEX: true,\r\n        palette: mw.tools.colorPickerColors\r\n    };\r\n\r\n    if(settings.value) {\r\n        sett.color = settings.value\r\n    }\r\n    if(typeof settings.showRGB !== 'undefined') {\r\n        sett.showRGB = settings.showRGB\r\n    }\r\n    if(typeof settings.showHEX !== 'undefined') {\r\n        sett.showHEX = settings.showHEX\r\n    }\r\n\r\n    if(typeof settings.showHSL !== 'undefined') {\r\n        sett.showHSL = settings.showHSL\r\n    }\r\n    var frame;\r\n    if (settings.method === 'inline') {\r\n\r\n        sett.attachTo = $el[0];\r\n\r\n        frame = AColorPicker.createPicker(sett);\r\n        frame.onchange = function (data) {\r\n\r\n            if (proto.settings.onchange) {\r\n                proto.settings.onchange(data.color);\r\n            }\r\n\r\n            if ($el[0].nodeName === 'INPUT') {\r\n                var val = val === 'transparent' ? val : '#' + val;\r\n                $el.val(val);\r\n            }\r\n        }\r\n\r\n    }\r\n    else {\r\n        var tip = mw.tooltip(settings), $tip = mw.$(tip).hide();\r\n        this.tip = tip;\r\n\r\n        mw.$('.mw-tooltip-content', tip).empty().css({\r\n            padding: 0\r\n        });\r\n        sett.attachTo = mw.$('.mw-tooltip-content', tip)[0]\r\n\r\n        frame = AColorPicker.createPicker(sett);\r\n\r\n        frame.onchange = function (data) {\r\n\r\n            if(frame.pause) {\r\n                return;\r\n            }\r\n\r\n            if (proto.settings.onchange) {\r\n                proto.settings.onchange(data.color);\r\n            }\r\n\r\n            if ($el[0].nodeName === 'INPUT') {\r\n                $el.val(data.color);\r\n            }\r\n        };\r\n        if ($el[0].nodeName === 'INPUT') {\r\n            $el.on('focus', function (e) {\r\n                if(this.value.trim()){\r\n                    frame.pause = true;\r\n                    frame.color = this.value;\r\n                    setTimeout(function () {\r\n                        frame.pause = false;\r\n                    });\r\n                }\r\n                mw.$(tip).show();\r\n                mw.tools.tooltip.setPosition(tip, $el[0], settings.position)\r\n            });\r\n        }\r\n        else {\r\n            $el.on('click', function (e) {\r\n                mw.$(tip).toggle();\r\n                mw.tools.tooltip.setPosition(tip, $el[0], settings.position)\r\n            });\r\n        }\r\n        var documents = [document];\r\n        if (self !== mw.top().win){\r\n            documents.push(mw.top().win.document);\r\n        }\r\n        mw.$(documents).on('click', function (e) {\r\n            if (!mw.tools.hasParentsWithClass(e.target, 'mw-tooltip') && e.target !== $el[0]) {\r\n                mw.$(tip).hide();\r\n            }\r\n        });\r\n        if ($el[0].nodeName === 'INPUT') {\r\n            $el.bind('blur', function () {\r\n                //$(tip).hide();\r\n            });\r\n        }\r\n    }\r\n    if (this.tip) {\r\n        this.show = function () {\r\n            mw.$(this.tip).show();\r\n            mw.tools.tooltip.setPosition(this.tip, this.settings.element, this.settings.position)\r\n        };\r\n        this.hide = function () {\r\n            mw.$(this.tip).hide()\r\n        };\r\n        this.toggle = function () {\r\n            var tip = mw.$(this.tip);\r\n            if (tip.is(':visible')) {\r\n                this.hide()\r\n            }\r\n            else {\r\n                $el.focus();\r\n                this.show()\r\n            }\r\n        }\r\n    }\r\n\r\n};\r\nmw.colorPicker = function (o) {\r\n\r\n    return new mw._colorPicker(o);\r\n};\r\n","(function (mw) {\r\n\r\n\r\n\r\n    mw.dialog = function (options) {\r\n        return new mw.Dialog(options);\r\n    };\r\n\r\n\r\n    mw.dialogIframe = function (options, cres) {\r\n        options.pauseInit = true;\r\n        var attr = 'frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen';\r\n        if (options.autoHeight) {\r\n            // attr += ' scrolling=\"no\"';\r\n            options.height = 'auto';\r\n        }\r\n        options.content = '<iframe src=\"' + mw.external_tool(options.url.trim()) + '\" ' + attr + '><iframe>';\r\n        options.className = ('mw-dialog-iframe mw-dialog-iframe-loading ' + (options.className || '')).trim();\r\n        options.className += (options.autoHeight ? ' mw-dialog-iframe-autoheight' : '');\r\n        var dialog = new mw.Dialog(options, cres);\r\n        dialog.iframe = dialog.dialogContainer.querySelector('iframe');\r\n        mw.tools.loading(dialog.dialogContainer, 90);\r\n\r\n\r\n\r\n        setTimeout(function () {\r\n            var frame = dialog.dialogContainer.querySelector('iframe');\r\n            frame.style.minHeight = 0; // reset in case of conflicts\r\n            if (options.autoHeight) {\r\n                mw.tools.iframeAutoHeight(frame, {dialog: dialog, maxHeightWindowScroll: '75vh'});\r\n            } else{\r\n                $(frame).height(options.height - 60);\r\n                frame.style.position = 'relative';\r\n            }\r\n            mw.$(frame).on('load', function () {\r\n                mw.tools.loading(dialog.dialogContainer, false);\r\n                setTimeout(function () {\r\n                    dialog.center();\r\n                    mw.$(frame).on('bodyResize', function () {\r\n                        dialog.center();\r\n                    });\r\n                    dialog.dialogMain.classList.remove('mw-dialog-iframe-loading');\r\n                    frame.contentWindow.thismodal = dialog;\r\n                    if (options.autoHeight) {\r\n                        mw.tools.iframeAutoHeight(frame, {dialog: dialog, maxHeightWindowScroll: '75vh'});\r\n                    }\r\n                }, 78);\r\n                if (mw.tools.canAccessIFrame(frame)) {\r\n                    mw.$(frame.contentWindow.document).on('keydown', function (e) {\r\n                        if (mw.event.is.escape(e) && !mw.event.targetIsField(e)) {\r\n                            if(mw.top().__dialogs && mw.top().__dialogs.length){\r\n                                var dlg = mw.top().__dialogs;\r\n                                dlg[dlg.length - 1]._doCloseButton();\r\n                                $(dlg[dlg.length - 1]).trigger('closedByUser');\r\n                            }\r\n                            else {\r\n                                if (dialog.options.closeOnEscape) {\r\n                                    dialog._doCloseButton();\r\n                                    $(dialog).trigger('closedByUser');\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                if(typeof options.onload === 'function') {\r\n                    options.onload.call(dialog);\r\n                }\r\n            });\r\n        }, 12);\r\n        return dialog;\r\n    };\r\n\r\n    /** @deprecated */\r\n    mw.modal = mw.dialog;\r\n    mw.modalFrame = mw.dialogIframe;\r\n\r\n    mw.dialog.remove = function (selector) {\r\n        var dlg = mw.dialog.get(selector);\r\n        if(dlg) {\r\n            dlg.remove()\r\n        }\r\n    };\r\n\r\n    mw.dialog.get = function (selector) {\r\n        selector = selector || '.mw-dialog';\r\n        var $el = mw.$(selector);\r\n        var el = $el[0];\r\n\r\n        if(!el) return false;\r\n\r\n        if(el._dialog) {\r\n            return el._dialog;\r\n        }\r\n        var child_cont = el.querySelector('.mw-dialog-holder');\r\n        var parent_cont = $el.parents(\".mw-dialog-holder:first\");\r\n        if (child_cont) {\r\n            return child_cont._dialog;\r\n        }\r\n        else if (parent_cont.length !== 0) {\r\n            return parent_cont[0]._dialog;\r\n        }\r\n        else if (window.thismodal) {\r\n            return thismodal;\r\n        }\r\n        else {\r\n             // deprecated\r\n            child_cont = el.querySelector('.mw_modal');\r\n            parent_cont = $el.parents(\".mw_modal:first\");\r\n            if(child_cont) {\r\n                return child_cont.modal;\r\n            } else if (parent_cont.length !== 0) {\r\n                return parent_cont[0].modal;\r\n            }\r\n            return false;\r\n        }\r\n    };\r\n\r\n\r\n    mw.Dialog = function (options, cres) {\r\n\r\n        var scope = this;\r\n\r\n\r\n        options = options || {};\r\n        options.content = options.content || options.html || '';\r\n\r\n        if(!options.height && typeof options.autoHeight === 'undefined') {\r\n            options.height = 'auto';\r\n            options.autoHeight = true;\r\n        }\r\n\r\n        var defaults = {\r\n            skin: 'default',\r\n            overlay: true,\r\n            overlayClose: false,\r\n            autoCenter: true,\r\n            root: document,\r\n            id: options.name || options.id || mw.id('mw-dialog-'),\r\n            content: '',\r\n            closeOnEscape: true,\r\n            closeButton: true,\r\n            closeButtonAppendTo: '.mw-dialog-header',\r\n            closeButtonAction: 'remove', // 'remove' | 'hide'\r\n            draggable: true,\r\n            scrollMode: 'inside', // 'inside' | 'window',\r\n            centerMode: 'intuitive', // 'intuitive' | 'center'\r\n            containment: 'window',\r\n            overflowMode: 'auto', // 'auto' | 'hidden' | 'visible'\r\n            disableTextSelection: false,\r\n\r\n        };\r\n\r\n        this.options = Object.assign({}, defaults, options );\r\n\r\n        this.id = this.options.id;\r\n\r\n        const _e = {};\r\n        this.on = (e, f) => { _e[e] ? _e[e].push(f) : (_e[e] = [f]) };\r\n        this.dispatch = (e, f) => { _e[e] ? _e[e].forEach( (c) => { c.call(this, f); }) : ''; };\r\n\r\n        this.document = this.options.root.nodeType === 9 ? this.options.root : this.options.ownerDocument;\r\n\r\n\r\n        var exist =this.options.root.getElementById(this.id);\r\n        if (exist) {\r\n            return exist._dialog;\r\n        }\r\n\r\n        this.hasBeenCreated = function () {\r\n            return this.options.root.getElementById(this.id) !== null;\r\n        };\r\n\r\n        if (this.hasBeenCreated()) {\r\n            return this.options.root.getElementById(this.id)._dialog;\r\n        }\r\n\r\n        if(!mw.top().__dialogs ) {\r\n            mw.top().__dialogs = [];\r\n        }\r\n        if (!mw.top().__dialogsData) {\r\n            mw.top().__dialogsData = {};\r\n        }\r\n\r\n\r\n        if (!mw.top().__dialogsData._esc) {\r\n            mw.top().__dialogsData._esc = true;\r\n            mw.element(this.document.body).on('keydown', function (e) {\r\n                if (mw.event.is.escape(e)) {\r\n                    var dlg = mw.top().__dialogs[mw.top().__dialogs.length - 1];\r\n                    if (dlg && dlg.options && dlg.options.closeOnEscape) {\r\n                        dlg._doCloseButton();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        mw.top().__dialogs.push(this);\r\n\r\n        this.draggable = function () {\r\n            if (this.options.draggable && $.fn.draggable) {\r\n                var $holder = mw.$(this.dialogHolder);\r\n                $holder.draggable({\r\n                    handle: this.options.draggableHandle || '.mw-dialog-header',\r\n                    start: function () {\r\n                        $holder.addClass('mw-dialog-drag-start');\r\n                        scope._dragged = true;\r\n                    },\r\n                    stop: function () {\r\n                        $holder.removeClass('mw-dialog-drag-start');\r\n                    },\r\n                    containment: scope.options.containment,\r\n                    iframeFix: true\r\n                });\r\n            }\r\n        };\r\n\r\n        this.header = function () {\r\n            this.dialogHeader = this.options.root.createElement('div');\r\n            this.dialogHeader.className = 'mw-dialog-header';\r\n            if (this.options.title || this.options.header) {\r\n                this.dialogHeader.innerHTML = '<div class=\"mw-dialog-title\">' + (this.options.title || this.options.header) + '</div>';\r\n            }\r\n        };\r\n\r\n        this.footer = function (content) {\r\n            this.dialogFooter = this.options.root.createElement('div');\r\n            this.dialogFooter.className = 'mw-dialog-footer';\r\n            if (this.options.footer) {\r\n                $(this.dialogFooter).append(this.options.footer);\r\n            }\r\n        };\r\n\r\n        this.title = function (title) {\r\n            var root = mw.element('.mw-dialog-title', this.dialogHeader);\r\n            if (typeof title === 'undefined') {\r\n                return root.html();\r\n            } else {\r\n                if (root[0]) {\r\n                    root.html(title);\r\n                }\r\n                else {\r\n                    mw.$(this.dialogHeader).prepend('<div class=\"mw-dialog-title\">' + title + '</div>');\r\n                }\r\n            }\r\n        };\r\n\r\n\r\n        this.build = function () {\r\n            this.dialogMain = this.options.root.createElement('div');\r\n            if (this.options.disableTextSelection){\r\n                this.dialogMain.style.userSelect = 'none';\r\n            }\r\n            this.dialogMain.id = this.id;\r\n            var cls = 'mw-dialog mw-dialog-scroll-mode-' + this.options.scrollMode\r\n                + ' mw-dialog-skin-' + this.options.skin\r\n                + ' mw-dialog-overflowMode-' + this.options.overflowMode;\r\n            cls += (!this.options.className ? '' : (' ' + this.options.className));\r\n            this.dialogMain.className = cls;\r\n            this.dialogMain._dialog = this;\r\n\r\n            this.dialogHolder = this.options.root.createElement('div');\r\n            this.dialogHolder.id = 'mw-dialog-holder-' + this.id;\r\n\r\n\r\n            this.dialogHolder._dialog = this;\r\n\r\n            this.header();\r\n            this.footer();\r\n            this.draggable();\r\n\r\n\r\n\r\n            this.dialogContainer = this.options.root.createElement('div');\r\n            this.dialogContainer._dialog = this;\r\n\r\n            // TODO: obsolate\r\n            this.container = this.dialogContainer;\r\n\r\n\r\n            this.dialogContainer.className = 'mw-dialog-container';\r\n            this.dialogHolder.className = 'mw-dialog-holder';\r\n\r\n            var cont = this.options.content;\r\n            if(this.options.shadow) {\r\n                this.shadow = this.dialogContainer.attachShadow({\r\n                    mode: 'open'\r\n                });\r\n                if(typeof cont === 'string') {\r\n                    this.shadow.innerHTML = (cont);\r\n                } else {\r\n                    this.shadow.appendChild(cont);\r\n                }\r\n            } else {\r\n                mw.$(this.dialogContainer).append(cont);\r\n            }\r\n\r\n\r\n            if (this.options.encapsulate) {\r\n                this.iframe = cont;\r\n                this.iframe.style.display = '';\r\n            }\r\n\r\n            this.dialogHolder.appendChild(this.dialogHeader);\r\n            this.dialogHolder.appendChild(this.dialogContainer);\r\n            this.dialogHolder.appendChild(this.dialogFooter);\r\n\r\n            this.closeButton = this.options.root.createElement('div');\r\n            this.closeButton.className = 'mw-dialog-close';\r\n\r\n            this.closeButton.$scope = this;\r\n\r\n            this.closeButton.onclick = function () {\r\n                this.$scope[this.$scope.options.closeButtonAction]();\r\n                $(this.$scope).trigger('closedByUser');\r\n            };\r\n            this.main = mw.$(this.dialogContainer); // obsolete\r\n            this.main.width = this.width;\r\n\r\n            this.width(this.options.width || 600);\r\n            this.height(this.options.height || 320);\r\n\r\n            this.options.root.body.appendChild(this.dialogMain);\r\n            this.dialogMain.appendChild(this.dialogHolder);\r\n            if (this.options.closeButtonAppendTo) {\r\n                mw.$(this.options.closeButtonAppendTo, this.dialogMain).append(this.closeButton)\r\n            }\r\n            else {\r\n                this.dialogHolder.appendChild(this.closeButton);\r\n\r\n            }\r\n            this.dialogOverlay();\r\n            return this;\r\n        };\r\n\r\n        this._doCloseButton = function() {\r\n            this[this.options.closeButtonAction]();\r\n        };\r\n\r\n        this.containmentManage = function () {\r\n            if (scope.options.containment === 'window') {\r\n                if (scope.options.scrollMode === 'inside') {\r\n                    var rect = this.dialogHolder.getBoundingClientRect();\r\n                    var sctop = $win.scrollTop();\r\n                    var height = $win.height();\r\n                    if (rect.top < sctop || (sctop + height) > (rect.top + rect.height)) {\r\n                        this.center();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        this.dialogOverlay = function () {\r\n            this.overlay = this.options.root.createElement('div');\r\n            this.overlay.className = 'mw-dialog-overlay';\r\n            this.overlay.$scope = this;\r\n            if (this.options.overlay === true) {\r\n                this.dialogMain.appendChild(this.overlay);\r\n            }\r\n            mw.$(this.overlay).on('click', function () {\r\n                if (this.$scope.options.overlayClose === true) {\r\n                    this.$scope._doCloseButton();\r\n                    $(this.$scope).trigger('closedByUser');\r\n                }\r\n            });\r\n            return this;\r\n        };\r\n\r\n        this._afterSize = function() {\r\n            if(mw._iframeDetector) {\r\n                mw._iframeDetector.pause = true;\r\n                var frame = window.frameElement;\r\n                if(frame && parent !== top){\r\n                    var height = this.dialogContainer.scrollHeight + this.dialogHeader.scrollHeight;\r\n                    if($(frame).height() < height) {\r\n                        frame.style.height = ((height + 100) - this.dialogHeader.offsetHeight - this.dialogFooter.offsetHeight) + 'px';\r\n                        if(window.thismodal){\r\n                            thismodal.height(height + 100);\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        this.show = function () {\r\n            mw.$(this.dialogMain).find('iframe').each(function(){\r\n                this._intPause = false;\r\n            });\r\n            mw.$(this.dialogMain).addClass('active');\r\n            this.center();\r\n            this._afterSize();\r\n            mw.$(this).trigger('Show');\r\n            mw.trigger('mwDialogShow', this);\r\n            return this;\r\n        };\r\n\r\n        this._hideStart = false;\r\n        this.hide = function () {\r\n            if (!this._hideStart) {\r\n                this._hideStart = true;\r\n                mw.$(this.dialogMain).find('iframe').each(function(){\r\n                    this._intPause = true;\r\n                });\r\n                setTimeout(function () {\r\n                    scope._hideStart = false;\r\n                }, 300);\r\n                mw.$(this.dialogMain).removeClass('active');\r\n                if(mw._iframeDetector) {\r\n                    mw._iframeDetector.pause = false;\r\n                }\r\n                mw.$(this).trigger('Hide');\r\n                mw.trigger('mwDialogHide', this);\r\n            }\r\n            return this;\r\n        };\r\n\r\n        this.remove = function () {\r\n            this.hide();\r\n            mw.removeInterval('iframe-' + this.id);\r\n            mw.$(this).trigger('BeforeRemove');\r\n            if (typeof this.options.beforeRemove === 'function') {\r\n                this.options.beforeRemove.call(this, this)\r\n            }\r\n            mw.$(this.dialogMain).remove();\r\n            if(this.options.onremove) {\r\n                this.options.onremove()\r\n            }\r\n            mw.$(this).trigger('Remove');\r\n            for (var i = 0; i < mw.top().__dialogs.length; i++) {\r\n                if (mw.top().__dialogs[i] === this) {\r\n                    mw.top().__dialogs.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            clearInterval(this._observe.interval);\r\n            return this;\r\n        };\r\n\r\n        this.destroy = this.remove;\r\n\r\n        this._prevHeight = -1;\r\n        this._dragged = false;\r\n\r\n        this.center = function (width, height) {\r\n            var $holder = mw.$(this.dialogHolder), $window = mw.$(window);\r\n            var holderHeight = height || $holder.outerHeight();\r\n            var holderWidth = width || $holder.outerWidth();\r\n            var dtop, css = {};\r\n\r\n            if (this.options.centerMode === 'intuitive' && this._prevHeight < holderHeight) {\r\n                dtop = innerHeight / 2 - holderHeight / 2;\r\n            } else if (this.options.centerMode === 'center') {\r\n                dtop = innerHeight / 2 - holderHeight / 2;\r\n            }\r\n\r\n            if (!scope._dragged) {\r\n                css.left = $window.outerWidth() / 2 - holderWidth / 2;\r\n            } else {\r\n                css.left = parseFloat($holder.css('left'));\r\n            }\r\n\r\n            if(css.left + holderWidth > $window.width()){\r\n                css.left = css.left - ((css.left + holderWidth) - $window.width());\r\n            }\r\n\r\n            if (dtop) {\r\n                css.top = dtop > 0 ? dtop : 0;\r\n            }\r\n\r\n            /*if(window !== mw.top().win &&this.options.root.body.scrollHeight > mw.top().win.innerHeight){\r\n                $win = $(mw.top());\r\n\r\n                css.top = $(document).scrollTop() + 50;\r\n                var off = $(window.frameElement).offset();\r\n                if(off.top < 0) {\r\n                    css.top += Math.abs(off.top);\r\n                }\r\n                if(window.thismodal) {\r\n                    css.top += thismodal.dialogContainer.scrollTop;\r\n                }\r\n\r\n            }*/\r\n\r\n\r\n            $holder.css(css);\r\n            this._prevHeight = holderHeight;\r\n\r\n\r\n            this._afterSize();\r\n            mw.$(this).trigger('dialogCenter');\r\n\r\n            return this;\r\n        };\r\n\r\n        this.width = function (width) {\r\n            if(!width) {\r\n                return mw.$(this.dialogHolder).outerWidth();\r\n            }\r\n            mw.$(this.dialogHolder).width(width);\r\n            this._afterSize();\r\n        };\r\n        this.height = function (height) {\r\n            if(!height) {\r\n                return mw.$(this.dialogHolder).outerHeight();\r\n            }\r\n            mw.$(this.dialogHolder).height(height);\r\n            this._afterSize();\r\n        };\r\n        this.resize = function (width, height) {\r\n            if (typeof width !== 'undefined') {\r\n                this.width(width);\r\n            }\r\n            if (typeof height !== 'undefined') {\r\n                this.height(height);\r\n            }\r\n            this.center(width, height);\r\n        };\r\n        this.content = function (content) {\r\n            this.options.content = content || '';\r\n            $(this.dialogContainer).empty().append(this.options.content);\r\n            return this;\r\n        };\r\n\r\n        this.result = function(result, doClose) {\r\n            this.value = result;\r\n            if(this.options.onResult){\r\n                this.options.onResult.call( this, result );\r\n            }\r\n            if (cres) {\r\n                cres.call( this, result );\r\n            }\r\n            $(this).trigger('Result', [result]);\r\n            if(doClose){\r\n                this._doCloseButton();\r\n            }\r\n        };\r\n\r\n\r\n        this.contentMaxHeight = function () {\r\n            var scope = this;\r\n            if (this.options.scrollMode === 'inside') {\r\n                mw.interval('iframe-' + this.id, function () {\r\n                    var max = mw.$(window).height() - scope.dialogHeader.clientHeight - scope.dialogFooter.clientHeight - 40;\r\n                    scope.dialogContainer.style.maxHeight = max + 'px';\r\n                    scope.containmentManage();\r\n                });\r\n            }\r\n        };\r\n\r\n        this._observe = {};\r\n        this.observeDimensions = function(cb) {\r\n            if (!this._observe.interval) {\r\n                var changed = function () {\r\n                  var css = getComputedStyle(scope.dialogMain);\r\n                  if (!scope._observe.data) {\r\n                      scope._observe.data = {\r\n                          width: css.width,\r\n                          height: css.height\r\n                      };\r\n                      return {\r\n                          width: css.width,\r\n                          height: css.height\r\n                      };\r\n                  } else  {\r\n                      var curr = scope._observe.data;\r\n                      if(curr.width !== css.width || curr.height !== css.height) {\r\n                          scope._observe.data = {\r\n                              width: css.width,\r\n                              height: css.height\r\n                          };\r\n                          return {\r\n                              width: css.width,\r\n                              height: css.height\r\n                          };\r\n                      }\r\n                  }\r\n                };\r\n                this._observe.interval = setInterval(function (){\r\n                    var chg = changed();\r\n                    if (chg) {\r\n                        cb.call(scope, chg);\r\n                    }\r\n\r\n                }, 333);\r\n            }\r\n        };\r\n\r\n        this.init = function () {\r\n            this.build();\r\n            this.contentMaxHeight();\r\n            this.center();\r\n            this.show();\r\n            if (this.options.autoCenter) {\r\n                (function (scope) {\r\n                    mw.$(window).on('resize orientationchange load', function () {\r\n                        scope.contentMaxHeight();\r\n                        scope.center();\r\n                    });\r\n                })(this);\r\n            }\r\n            if (!this.options.pauseInit) {\r\n                mw.$(this).trigger('Init');\r\n            }\r\n            this.observeDimensions(function (){\r\n                scope.center();\r\n            });\r\n            return this;\r\n        };\r\n        this.init();\r\n    };\r\n\r\n    mw.Dialog.elementIsInDialog = function (node) {\r\n        return mw.tools.firstParentWithClass(node, 'mw-dialog');\r\n    };\r\n\r\n})(window.mw);\r\n\r\n\r\n(function () {\r\n    function scoped() {\r\n        var all = document.querySelectorAll('style[scoped]'), i = 0;\r\n\r\n        try {\r\n            for( ; i < all.length; i++ ) {\r\n                var parent = all[i].parentNode;\r\n                parent.id = parent.id || mw.id('scoped-id-');\r\n                var prefix = '#' + parent.id + ' ';\r\n                var rules = all[i].sheet.rules;\r\n                var r = 0;\r\n                for ( ; r < rules.length; r++) {\r\n                    var newRule = prefix + rules[r].cssText;\r\n                    all[i].sheet.deleteRule(r);\r\n                    all[i].sheet.insertRule(newRule, r);\r\n                }\r\n                all[i].removeAttribute('scoped');\r\n            }\r\n        }\r\n        catch(error) {\r\n\r\n        }\r\n\r\n\r\n    }\r\n    scoped();\r\n    $(window).on('load', function () {\r\n        scoped();\r\n    });\r\n})();\r\n\r\n\r\n","mw.tools.elementEdit = function (el, textonly, callback, fieldClass) {\r\n    if (!el || el.querySelector('.mw-live-edit-input') !== null) {\r\n        return;\r\n    }\r\n    textonly = (typeof textonly === 'undefined') ? true : textonly;\r\n    var input = document.createElement('span');\r\n    input.className = (fieldClass || \"\") + ' mw-live-edit-input mw-liveedit-field';\r\n    input.contentEditable = true;\r\n    var $input = $(input);\r\n    if (textonly === true) {\r\n        input.innerHTML = el.textContent;\r\n        input.onblur = function () {\r\n            var val = $input.text();\r\n            var ischanged = true;\r\n            setTimeout(function () {\r\n                mw.$(el).text(val);\r\n                if (typeof callback === 'function' && ischanged) {\r\n                    callback.call(val, el);\r\n                }\r\n            }, 3);\r\n        };\r\n        input.onkeydown = function (e) {\r\n            if (e.keyCode === 13) {\r\n                e.preventDefault();\r\n                mw.$(el).text($input.text());\r\n                if (typeof callback === 'function') {\r\n                    callback.call($input.text(), el);\r\n                }\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        input.innerHTML = el.innerHTML;\r\n        input.onblur = function () {\r\n            var val = this.innerHTML;\r\n            var ischanged = this.changed === true;\r\n            setTimeout(function () {\r\n                el.innerHTML = val;\r\n                if (typeof callback === 'function' && ischanged) {\r\n                    callback.call(val, el);\r\n                }\r\n            }, 3)\r\n        }\r\n        input.onkeydown = function (e) {\r\n            if (e.keyCode === 13) {\r\n                e.preventDefault();\r\n                var val = this.innerHTML;\r\n                el.innerHTML = val;\r\n                if (typeof callback === 'function') {\r\n                    callback.call(val, el);\r\n                }\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    mw.$(el).empty().append(input);\r\n    $input.focus();\r\n    input.changed = false;\r\n    $input.change(function () {\r\n        this.changed = true;\r\n    });\r\n    return input;\r\n}\r\n","(function(){\r\n\r\n\r\n    var Gallery = function (array, startFrom) {\r\n        startFrom = startFrom || 0;\r\n\r\n        this.currentIndex = startFrom;\r\n\r\n        this.data = array;\r\n        var scope = this;\r\n\r\n        this._template = function () {\r\n            var el = document.createElement('div');\r\n            el.className = 'mw-gallery';\r\n            el.innerHTML = '' +\r\n            '<div class=\"\">' +\r\n                '<div class=\"mw-gallery-overlay\"></div>' +\r\n                '<div class=\"mw-gallery-content\"></div>' +\r\n                '<div class=\"mw-gallery-prev\"></div>' +\r\n                '<div class=\"mw-gallery-next\"></div>' +\r\n                '<div class=\"mw-gallery-controls\">' +\r\n                    '<span class=\"mw-gallery-control-play\"></span>' +\r\n                    /*'<span class=\"mw-gallery-control-fullscreen\"></span>' +*/\r\n                    '<span class=\"mw-gallery-control-close\"></span>' +\r\n                '</div>' +\r\n            '</div>';\r\n            return el;\r\n        };\r\n\r\n        this.createSingle = function (item, i) {\r\n            var el = document.createElement('div');\r\n            el.className = 'mw-gallery-fullscreen-item mw-gallery-item-' + i + (startFrom === i ? ' active' : '');\r\n            var desc = !item.description ? '' : '<div class=\"mw-gallery-item-description\">'+item.description+'</div>';\r\n            el.innerHTML = '<div class=\"mw-gallery-item-image\"><img src=\"'+(item.image || item.url || item.src || item.filename)+'\"></div>' + desc;\r\n            this.container.appendChild(el);\r\n            return el;\r\n        };\r\n\r\n        this.next = function () {\r\n            this.currentIndex++;\r\n            if(!this._items[this.currentIndex]) {\r\n                this.currentIndex = 0;\r\n            }\r\n            this.goto(this.currentIndex);\r\n        };\r\n\r\n        this.prev = function () {\r\n            this.currentIndex--;\r\n            if(!this._items[this.currentIndex]) {\r\n                this.currentIndex = this._items.length - 1;\r\n            }\r\n            this.goto(this.currentIndex);\r\n        };\r\n\r\n        this.goto = function (i) {\r\n            if(i > -1 && i < this._items.length) {\r\n                this.currentIndex = i;\r\n                this._items.forEach(function (item, i){\r\n                    item.classList.remove('active');\r\n                    if(i === scope.currentIndex) {\r\n                        item.classList.add('active');\r\n                    }\r\n                });\r\n            }\r\n        };\r\n\r\n        this.paused = true;\r\n\r\n        this.pause = function () {\r\n            this.paused = true;\r\n            clearTimeout(this.playInterval);\r\n            mw.tools.loading(this.template, false, );\r\n        };\r\n\r\n        this.playInterval = null;\r\n        this._play = function () {\r\n            if(this.paused) return;\r\n            mw.tools.loading(this.template, 100, 'slow');\r\n            this.playInterval = setTimeout(function (){\r\n                mw.tools.loading(scope.template, 'hide');\r\n                scope.next();\r\n                scope._play();\r\n            },5000);\r\n        };\r\n\r\n        this.play = function () {\r\n            this.next();\r\n            this.paused = false;\r\n            this._play();\r\n        };\r\n\r\n        this._items = [];\r\n\r\n        this.createHandles = function () {\r\n            this.template.querySelector('.mw-gallery-prev').onclick = function (){ scope.pause(); scope.prev(); };\r\n            this.template.querySelector('.mw-gallery-next').onclick = function (){ scope.pause(); scope.next(); };\r\n            this.template.querySelector('.mw-gallery-control-close').onclick = function (){ scope.remove(); };\r\n            this.template.querySelector('.mw-gallery-control-play').onclick = function (){\r\n                scope[scope.paused ? 'play' : 'pause']();\r\n                this.classList[scope.paused ? 'remove' : 'add']('pause');\r\n            };\r\n        };\r\n\r\n        this.createItems = function () {\r\n            this.data.forEach(function (item, i ){\r\n                scope._items.push(scope.createSingle(item, i));\r\n            });\r\n        };\r\n\r\n        this.init = function () {\r\n            this.template = this._template();\r\n            document.body.appendChild(this.template);\r\n            this.container = this.template.querySelector('.mw-gallery-content');\r\n            this.createItems();\r\n            this.createHandles();\r\n        };\r\n\r\n        this.remove = function () {\r\n            this.template.remove();\r\n        };\r\n\r\n        this.init();\r\n    };\r\n\r\n    mw.gallery = function (array, startFrom){\r\n        return new Gallery(array, startFrom);\r\n    };\r\n\r\n    // obsolate:\r\n    mw.tools.gallery = {\r\n        init: mw.gallery\r\n    };\r\n})();\r\n","mw.tools.createAutoHeight = function() {\r\n    if(window.thismodal && thismodal.iframe) {\r\n        mw.tools.iframeAutoHeight(thismodal.iframe);\r\n    }\r\n    else if(mw.top().win.frameElement && mw.top().win.frameElement.contentWindow === window) {\r\n        mw.tools.iframeAutoHeight(mw.top().win.frameElement);\r\n    } else if(window.top !== window) {\r\n        mw.top().$('iframe').each(function(){\r\n            try{\r\n                if(this.contentWindow === window) {\r\n                    mw.tools.iframeAutoHeight(this);\r\n                }\r\n            } catch(e){}\r\n        })\r\n    }\r\n};\r\n\r\nmw.tools.moduleFrame = function(type, template){\r\n    return mw.dialogIframe({\r\n        url: mw.external_tool('module_dialog') + '?module=' + type + (template ? ('&template=' + template) : ''),\r\n        width: 532,\r\n        height: 'auto',\r\n        autoHeight:true,\r\n        title: type,\r\n        className: 'mw-dialog-module-settings',\r\n        closeButtonAction: 'remove'\r\n    });\r\n};\r\n\r\n\r\nmw.tools.iframeAutoHeight = function(frame, opt){\r\n\r\n    opt = opt || {};\r\n    opt.maxHeightWindowScroll = opt.maxHeightWindowScroll || null;\r\n\r\n    frame = mw.$(frame)[0];\r\n    if(!frame) return;\r\n\r\n    var _detector = document.createElement('div');\r\n    _detector.className = 'mw-iframe-auto-height-detector';\r\n    _detector.id = mw.id();\r\n\r\n    var insertDetector = function() {\r\n        if(frame.contentWindow && frame.contentWindow.document && frame.contentWindow.document.body){\r\n            var det = frame.contentWindow.document.querySelector('.mw-iframe-auto-height-detector');\r\n            if(!det){\r\n                frame.contentWindow.document.body.appendChild(_detector);\r\n            } else if(det !== frame.contentWindow.document.body.lastChild){\r\n                frame.contentWindow.document.body.appendChild(det);\r\n            }\r\n            if(frame.contentWindow.mw) {\r\n                frame.contentWindow.mw._iframeDetector = _detector;\r\n            }\r\n\r\n        }\r\n    };\r\n\r\n\r\n\r\n    setTimeout(function(){\r\n        insertDetector();\r\n    }, 100);\r\n    frame.style.minHeight = 0 + 'px';\r\n    if (opt.maxHeightWindowScroll) {\r\n        frame.style.maxHeight = opt.maxHeightWindowScroll;\r\n        frame.style.overflow = 'auto';\r\n        frame.scrolling=\"auto\"\r\n    } else {\r\n        frame.scrolling=\"auto\";\r\n        frame.style.overflow = 'hidden';\r\n    }\r\n    mw.$(frame).on('load resize', function(){\r\n\r\n        if(!mw.tools.canAccessIFrame(frame)) {\r\n            console.log('Iframe can not be accessed.', frame);\r\n            return;\r\n        }\r\n        if(!frame.contentWindow.document.body){\r\n            return;\r\n        }\r\n        if(!!frame.contentWindow.document.querySelector('.mw-iframe-auto-height-detector')){\r\n            return;\r\n        }\r\n        insertDetector();\r\n        if (opt.maxHeightWindowScroll) {\r\n            frame.style.maxHeight = opt.maxHeightWindowScroll;\r\n            frame.style.overflow = 'auto';\r\n            frame.scrolling=\"auto\";\r\n        } else {\r\n            frame.scrolling=\"auto\";\r\n            frame.style.overflow = 'hidden';\r\n        }\r\n    });\r\n    var offset = function () {\r\n        return _detector.getBoundingClientRect().top;\r\n    };\r\n    frame._intPause = false;\r\n    frame._int = setInterval(function(){\r\n        if(!frame._intPause && frame.parentNode && frame.contentWindow && frame.contentWindow.document.body){\r\n            var calc = offset() + _detector.offsetHeight;\r\n            frame._currHeight = frame._currHeight || 0;\r\n            if(calc && calc !== frame._currHeight ){\r\n                frame._currHeight = calc;\r\n                frame.style.height = Math.max(calc) + 'px';\r\n                var scroll = Math.max(frame.contentWindow.document.documentElement.scrollHeight, frame.contentWindow.document.body.scrollHeight);\r\n                if(scroll > frame._currHeight) {\r\n                    frame._currHeight = scroll;\r\n                    frame.style.height = scroll + 'px';\r\n                }\r\n                mw.$(frame).trigger('bodyResize');\r\n            }\r\n        } else if(!frame.parentElement){\r\n            clearInterval(frame._int);\r\n        }\r\n        else {\r\n            //clearInterval(frame._int);\r\n        }\r\n    }, 77);\r\n\r\n};\r\n","mw.responsive = {\r\n    table: function (selector, options) {\r\n        options = options || {};\r\n        mw.$(selector).each(function () {\r\n            var cls = 'responsive-table-' + mw.random();\r\n            mw.tools.addClass(this, cls);\r\n            var el = mw.$(this);\r\n            el.wrap('<div class=\"mw-responsive-table-wrapper\"></div>');\r\n            if (options.minWidth) {\r\n                el.css('minWidth', options.minWidth)\r\n            }\r\n            if (!el.hasClass('mw-mobile-table')) {\r\n                el.addClass('mw-mobile-table');\r\n            }\r\n        });\r\n    }\r\n};\r\n","/*\r\n    options.data = [\r\n        {\r\n            title: string,\r\n            value: any,\r\n            icon?: string,\r\n            selected?: boolean\r\n        }\r\n    ]\r\n\r\n */\r\n\r\n\r\nmw.Select = function(options) {\r\n    var defaults = {\r\n        data: [],\r\n        skin: 'default',\r\n        multiple: false,\r\n        autocomplete: false,\r\n        mobileAutocomplete: false,\r\n        showSelected: false,\r\n        document: document,\r\n        size: 'normal',\r\n        color: 'default',\r\n        dropMode: 'over', // 'over' | 'push'\r\n        placeholder: mw.lang('Select'),\r\n        tags: false, // only if multiple is set to true,\r\n        ajaxMode: {\r\n            paginationParam: 'page',\r\n            searchParam: 'keyword',\r\n            endpoint: null,\r\n            method: 'get'\r\n        }\r\n    };\r\n    options  = options || {};\r\n    this.settings = $.extend({}, defaults, options);\r\n\r\n\r\n\r\n    if(this.settings.ajaxMode && !this.settings.ajaxMode.endpoint){\r\n        this.settings.ajaxMode = false;\r\n    }\r\n\r\n    this.$element = $(this.settings.element).eq(0);\r\n    this.element = this.$element[0];\r\n    if(!this.element) {\r\n        return;\r\n    }\r\n\r\n    this._rootInputMode = this.element.nodeName === 'INPUT';\r\n\r\n    if(this.element._mwSelect) {\r\n        return this.element._mwSelect;\r\n    }\r\n\r\n    var scope = this;\r\n    this.document = this.settings.document;\r\n\r\n    this._value = null;\r\n\r\n\r\n    this.getLabel = function(item) {\r\n        return item.title || item.name || item.label || item.value;\r\n    };\r\n\r\n    this._loading = false;\r\n\r\n    this._page = 1;\r\n\r\n    this.nextPage = function () {\r\n        this._page++;\r\n    };\r\n\r\n    this.page = function (state) {\r\n        if (typeof state === 'undefined') {\r\n            return this._page;\r\n        }\r\n        this._page = state;\r\n    };\r\n\r\n    this.loading = function (state) {\r\n        if (typeof state === 'undefined') {\r\n            return this._state;\r\n        }\r\n        this._state = state;\r\n        mw.tools.classNamespaceDelete(this.root, 'mw-select-loading-');\r\n        mw.tools.addClass(this.root, 'mw-select-loading-' + state);\r\n    };\r\n\r\n    this.xhr = null;\r\n\r\n    this.ajaxFilter = function (val, callback) {\r\n        if (this.xhr) {\r\n            this.xhr.abort();\r\n        }\r\n        val = (val || '').trim().toLowerCase();\r\n        var params = { };\r\n        params[this.settings.ajaxMode.searchParam] = val;\r\n        params = (this.settings.ajaxMode.endpoint.indexOf('?') === -1 ? '?' : '&' ) + $.param(params);\r\n        this.xhr = $[this.settings.ajaxMode.method](this.settings.ajaxMode.endpoint + params, function (data) {\r\n            callback.call(this, data);\r\n            scope.xhr = null;\r\n        });\r\n    };\r\n\r\n    this.filter = function (val) {\r\n        val = (val || '').trim().toLowerCase();\r\n        if (this.settings.ajaxMode) {\r\n            this.loading(true);\r\n            this.ajaxFilter(val, function (data) {\r\n                scope.setData(data.data);\r\n                if(data.data && data.data.length){\r\n                    scope.open();\r\n                } else {\r\n                    scope.close();\r\n                }\r\n                scope.loading(false);\r\n            });\r\n        } else {\r\n            var all = this.root.querySelectorAll('.mw-select-option'), i = 0;\r\n            if (!val) {\r\n                for( ; i< all.length; i++) {\r\n                    all[i].style.display = '';\r\n                }\r\n            } else {\r\n                for( ; i< all.length; i++) {\r\n                    all[i].style.display = this.getLabel(all[i].$value).toLowerCase().indexOf(val) !== -1 ? '' : 'none';\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    this.setPlaceholder = function (plval) {\r\n        /*plval = plval || this.settings.placeholder;\r\n        if(scope.settings.autocomplete){\r\n            $('.mw-ui-invisible-field', this.root).attr('placeholder', plval);\r\n        } else {\r\n            $('.mw-ui-btn-content', this.root).html(plval);\r\n        }*/\r\n        return this.displayValue(plval)\r\n    };\r\n    this.displayValue = function(plval){\r\n        if(!plval && !this.settings.multiple && this.value()) {\r\n            plval = scope.getLabel(this.value());\r\n        }\r\n        plval = plval || this.settings.placeholder;\r\n        if(!scope._displayValue) {\r\n            scope._displayValue = scope.document.createElement('span');\r\n            scope._displayValue.className = 'mw-select-display-value mw-ui-size-' + this.settings.size;\r\n            $('.mw-select-value', this.root).append(scope._displayValue)\r\n        }\r\n        if(this._rootInputMode){\r\n            scope._displayValue.innerHTML = '&nbsp';\r\n            $('input.mw-ui-invisible-field', this.root).val(plval);\r\n\r\n        } else {\r\n            scope._displayValue.innerHTML = plval + this.__indicateNumber();\r\n\r\n        }\r\n    };\r\n\r\n    this.__indicateNumber = function () {\r\n        if(this.settings.multiple && this.value() && this.value().length){\r\n            return \"<span class='mw-select-indicate-number'>\" + this.value().length + \"</span>\";\r\n        } else {\r\n            return \"<span class='mw-select-indicate-number mw-select-indicate-number-empty'>\" + 0 + \"</span>\";\r\n        }\r\n    };\r\n\r\n    this.rend = {\r\n\r\n        option: function(item){\r\n            var oh = scope.document.createElement('label');\r\n            oh.$value = item;\r\n            oh.className = 'mw-select-option';\r\n            if (scope.settings.multiple) {\r\n                oh.className = 'mw-ui-check mw-select-option';\r\n                oh.innerHTML =  '<input type=\"checkbox\"><span></span><span>'+scope.getLabel(item)+'</span>';\r\n\r\n                $('input', oh).on('change', function () {\r\n                    this.checked ? scope.valueAdd(oh.$value) : scope.valueRemove(oh.$value)\r\n                });\r\n            } else {\r\n                oh.innerHTML = scope.getLabel(item);\r\n                oh.onclick = function () {\r\n                    scope.value(oh.$value)\r\n                };\r\n            }\r\n\r\n            return oh;\r\n        },\r\n        value: function() {\r\n            var tag = 'span', cls = 'mw-ui-btn';\r\n            if(scope.settings.autocomplete){\r\n                tag = 'span';\r\n                cls = 'mw-ui-field'\r\n            }\r\n            var oh = scope.document.createElement(tag);\r\n            oh.className = cls + ' mw-ui-size-' + scope.settings.size + ' mw-ui-bg-' + scope.settings.color + ' mw-select-value';\r\n\r\n            if(scope.settings.autocomplete){\r\n                oh.innerHTML = '<input type=\"text\" class=\"mw-ui-invisible-field mw-ui-field-' + scope.settings.size + '\">';\r\n            } else {\r\n                oh.innerHTML = '<span class=\"mw-ui-btn-content\"></span>';\r\n            }\r\n\r\n            if(scope.settings.autocomplete){\r\n                $('input', oh)\r\n                    .on('input focus', function (e) {\r\n                        scope.filter(this.value);\r\n                        if(scope._rootInputMode) {\r\n                            scope.element.value = this.value;\r\n\r\n                        }\r\n                    })\r\n                    .on('keydown', function (e) {\r\n                        if(mw.event.is.enter(e) || mw.event.is.comma(e)) {\r\n                            e.preventDefault();\r\n                            $(scope).trigger('enterOrComma', [this, e]);\r\n                            $(this).val('adsadasd')\r\n                        }\r\n                    })\r\n                    .on('focus', function () {\r\n                        if(scope.settings.data && scope.settings.data.length) {\r\n                            scope.open();\r\n                        }\r\n                    }).on('focus blur input', function () {\r\n                    var hasVal = !!this.value.trim();\r\n                    mw.tools[hasVal ? 'addClass' : 'removeClass'](scope.root, 'mw-select-has-value')\r\n                });\r\n            } else {\r\n                oh.onclick = function () {\r\n                    scope.toggle();\r\n                };\r\n            }\r\n            return oh;\r\n        },\r\n        options: function(){\r\n            scope.optionsHolder = scope.document.createElement('div');\r\n            scope.holder = scope.document.createElement('div');\r\n            scope.optionsHolder.className = 'mw-select-options';\r\n            $.each(scope.settings.data, function(){\r\n                scope.holder.appendChild(scope.rend.option(this))\r\n            });\r\n            scope.optionsHolder.appendChild(scope.holder);\r\n            return scope.optionsHolder;\r\n        },\r\n        root: function () {\r\n            scope.root = scope.document.createElement('div');\r\n            scope.root.className = 'mw-select mw-select-dropmode-' + scope.settings.dropMode + ' mw-select-multiple-' + scope.settings.multiple;\r\n\r\n            return scope.root;\r\n        }\r\n    };\r\n\r\n    this.state = 'closed';\r\n\r\n    this.open = function () {\r\n        this.state = 'opened';\r\n        mw.tools.addClass(scope.root, 'active');\r\n        mw.Select._register.forEach(function (item) {\r\n            if(item !== scope) {\r\n                item.close()\r\n            }\r\n        });\r\n    };\r\n\r\n    this.close = function () {\r\n        this.state = 'closed';\r\n        mw.tools.removeClass(scope.root, 'active');\r\n    };\r\n\r\n    this.tags = function () {\r\n        if(!this._tags) {\r\n            if(this.settings.multiple && this.settings.tags) {\r\n                var holder = scope.document.createElement('div');\r\n                holder.className = 'mw-select-tags';\r\n                this._tags = new mw.tags({element:holder, data:scope._value || [], color: this.settings.tagsColor, size: this.settings.tagsSize || 'small'})\r\n                $(this.optionsHolder).prepend(holder);\r\n                mw.$(this._tags).on('tagRemoved', function (e, tag) {\r\n                    scope.valueRemove(tag)\r\n                })\r\n            }\r\n        } else {\r\n            this._tags.setData(scope._value)\r\n        }\r\n        this.displayValue()\r\n    };\r\n\r\n\r\n    this.toggle = function () {\r\n        if (this.state === 'closed') {\r\n            this.open();\r\n        } else {\r\n            this.close();\r\n        }\r\n    };\r\n\r\n\r\n    this._valueGet = function (val) {\r\n        if(typeof val === 'number') {\r\n            val = this.settings.data.find(function (item) {\r\n                return item.id === val;\r\n            })\r\n        }\r\n        return val;\r\n    };\r\n\r\n\r\n\r\n    this.valueAdd = function(val){\r\n        if (!val) return;\r\n        val = this._valueGet(val);\r\n        if (!val) return;\r\n        if (!this._value) {\r\n            this._value = []\r\n        }\r\n        var exists = this._value.find(function (item) {\r\n            return item.id === val.id;\r\n        });\r\n        if (!exists) {\r\n            this._value.push(val);\r\n            $(this.root.querySelectorAll('.mw-select-option')).each(function () {\r\n                if(this.$value === val) {\r\n                    this.querySelector('input').checked = true;\r\n                }\r\n            });\r\n        }\r\n\r\n        this.afterChange();\r\n    };\r\n\r\n    this.afterChange = function () {\r\n        this.tags();\r\n        this.displayValue();\r\n        if($.isArray(this._value)) {\r\n            $.each(this._value, function () {\r\n\r\n            });\r\n            $(this.root.querySelectorAll('.mw-select-option')).each(function () {\r\n                if(scope._value.indexOf(this.$value) !== -1) {\r\n                    mw.tools.addClass(this, 'active')\r\n                }\r\n                else {\r\n                    mw.tools.removeClass(this, 'active')\r\n                }\r\n            });\r\n        }\r\n        $(this).trigger('change', [this._value]);\r\n    };\r\n\r\n    this.valueRemove = function(val) {\r\n        if (!val) return;\r\n        val = this._valueGet(val);\r\n        if (!val) return;\r\n        if (!this._value) {\r\n            this._value = [];\r\n        }\r\n        var exists = this._value.find(function (item) {\r\n            return item.id === val.id;\r\n        });\r\n        if (exists) {\r\n            this._value.splice(this._value.indexOf(exists), 1);\r\n        }\r\n        $(this.root.querySelectorAll('.mw-select-option')).each(function () {\r\n            if(this.$value === val) {\r\n                this.querySelector('input').checked = false;\r\n            }\r\n        });\r\n        this.afterChange()\r\n    };\r\n\r\n    this._valueToggle = function(val){\r\n        if (!val) return;\r\n        if (!this._value) {\r\n            this._value = [];\r\n        }\r\n        var exists = this._value.find(function (item) {\r\n            return item.id === val.id;\r\n        });\r\n        if (exists) {\r\n            this._value.splice(this._value.indexOf(exists), 1);\r\n        } else {\r\n            this._value.push(val);\r\n        }\r\n        this.afterChange();\r\n    };\r\n\r\n    this.value = function(val){\r\n        if(!val) return this._value;\r\n        val = this._valueGet(val);\r\n        if (!val) return;\r\n        if(this.settings.multiple){\r\n            this._valueToggle(val)\r\n        }\r\n        else {\r\n            this._value = val;\r\n            $('.mw-ui-invisible-field', this.root).val(this.getLabel(val))\r\n            this.close();\r\n        }\r\n\r\n        this.afterChange()\r\n    };\r\n\r\n    this.setData = function (data) {\r\n        $(scope.holder).empty();\r\n        scope.settings.data = data;\r\n        $.each(scope.settings.data, function(){\r\n            scope.holder.appendChild(scope.rend.option(this))\r\n        });\r\n        return scope.holder;\r\n    };\r\n\r\n    this.addData = function (data) {\r\n        $.each(data, function(){\r\n            scope.settings.data.push(this);\r\n            scope.holder.appendChild(scope.rend.option(this));\r\n        });\r\n        return scope.holder;\r\n    };\r\n\r\n    this.build = function () {\r\n        this.rend.root();\r\n        this.root.appendChild(this.rend.value());\r\n        this.root.appendChild(this.rend.options());\r\n        if (this._rootInputMode) {\r\n            this.element.type = 'hidden';\r\n            this.$element.before(this.root);\r\n        } else {\r\n            this.$element.html(this.root);\r\n        }\r\n        this.setPlaceholder();\r\n        mw.Select._register.push(this);\r\n    };\r\n\r\n    this.init = function () {\r\n        this.build();\r\n        this.element._mwSelect = this;\r\n    };\r\n\r\n\r\n\r\n    this.init();\r\n\r\n\r\n};\r\n\r\nmw.Select._register = [];\r\n\r\n\r\n$(document).ready(function () {\r\n    $(document).on('mousedown touchstart', function (e) {\r\n        if(!mw.tools.firstParentOrCurrentWithClass(e.target, 'mw-select')){\r\n            mw.Select._register.forEach(function (item) {\r\n                item.close();\r\n            });\r\n        }\r\n    });\r\n});\r\n\r\n\r\nmw.select = function(options) {\r\n    return new mw.Select(options);\r\n};\r\n","mw.Spinner = function(options){\r\n    if(!options || !options.element){\r\n        return;\r\n    }\r\n    this.$element = mw.element(options.element);\r\n    if(!this.$element.length) return;\r\n    this.element = this.$element[0];\r\n    if(this.element._mwSpinner){\r\n        return this.element._mwSpinner;\r\n    }\r\n    this.element._mwSpinner = this;\r\n    this.options = options;\r\n\r\n    this.options.size = this.options.size || 20;\r\n    this.options.color = this.options.color || '#4592ff';\r\n    this.options.insertMode = this.options.insertMode || 'append';\r\n\r\n    this.color = function(val){\r\n        if(!val) {\r\n            return this.options.color;\r\n        }\r\n        this.options.color = val;\r\n        this.$spinner.find('circle').css({\r\n            stroke: this.options.color\r\n        });\r\n    };\r\n\r\n    this.size = function(val){\r\n        if(!val) {\r\n            return this.options.size;\r\n        }\r\n        this.options.size = parseFloat(val);\r\n        this.$spinner.css({\r\n            width: this.options.size,\r\n            height: this.options.size\r\n        });\r\n    };\r\n\r\n    this.setState = function(state) {\r\n        mw.tools.classNamespaceDelete(this.$spinner[0], 'mw-spinner-state-');\r\n        mw.tools.addClass(this.$spinner[0], 'mw-spinner-state-' + state);\r\n    }\r\n\r\n    this.create = function(){\r\n        this.$spinner = $('<div class=\"mw-spinner mw-spinner-mode-' + this.options.insertMode + '\" style=\"display: none;\"><svg viewBox=\"0 0 50 50\"><circle cx=\"25\" cy=\"25\" r=\"20\" fill=\"none\" stroke-width=\"5\"></circle><path class=\"mw-spinner-checkmark-check\" fill=\"none\" d=\"M14.1 27.2l7.1 7.2 16.7-16.8\"/></svg></div>');\r\n        this.size(this.options.size);\r\n        this.color(this.options.color);\r\n        this.$element[this.options.insertMode](this.$spinner);\r\n        this.show();\r\n        return this;\r\n    };\r\n\r\n    this.show = function(){\r\n        this.$spinner.show();\r\n        this.$element.addClass('has-mw-spinner');\r\n        if(this.options.decorate) {\r\n            this.$element.addClass('mw-spinner-decorate');\r\n        }\r\n        return this;\r\n    };\r\n\r\n    this.hide = function(){\r\n        this.$spinner.hide();\r\n        this.$element.removeClass('has-mw-spinner');\r\n        if(this.options.decorate) {\r\n            this.$element.removeClass('mw-spinner-decorate');\r\n        }\r\n        return this;\r\n    };\r\n\r\n    this.remove = function(){\r\n        this.hide();\r\n        this.$spinner.remove();\r\n        delete this.element._mwSpinner;\r\n    };\r\n\r\n    this.create().show();\r\n\r\n};\r\n\r\nmw.spinner = function(options){\r\n    return new mw.Spinner(options);\r\n};\r\n","mw.storage = {\r\n    init: function () {\r\n\r\n        try {\r\n            if (window.location.href.indexOf('data:') === 0 || !('localStorage' in mww) || /* IE Security configurations */ typeof mww['localStorage'] === 'undefined') return false;\r\n            var lsmw = localStorage.getItem(\"mw\");\r\n            if (typeof lsmw === 'undefined' || lsmw === null) {\r\n                lsmw = localStorage.setItem(\"mw\", \"{}\");\r\n            }\r\n            this.change(\"INIT\");\r\n            return lsmw;\r\n\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n\r\n\r\n    },\r\n    set: function (key, val) {\r\n        try {\r\n            if (!('localStorage' in mww)) return false;\r\n            var curr = JSON.parse(localStorage.getItem(\"mw\"));\r\n            curr[key] = val;\r\n            var a = localStorage.setItem(\"mw\", JSON.stringify(curr));\r\n            mw.storage.change(\"CALL\", key, val);\r\n            return a;\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n\r\n    },\r\n    get: function (key) {\r\n        try {\r\n            if (!('localStorage' in mww)) return false;\r\n            var curr = JSON.parse(localStorage.getItem(\"mw\"));\r\n            return curr[key];\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n    },\r\n    _keys: {},\r\n    change: function (key, callback, other) {\r\n        if (!('localStorage' in mww)) return false;\r\n        if (key === 'INIT' && 'addEventListener' in document) {\r\n            addEventListener('storage', function (e) {\r\n                if (e.key === 'mw') {\r\n                    if (e.newValue === null) {\r\n                        return;\r\n                    }\r\n\r\n                    if (e.oldValue === null) {\r\n                        return;\r\n                    }\r\n\r\n                    var _new = JSON.parse(e.newValue || {});\r\n                    var _old = JSON.parse(e.oldValue || {});\r\n                    var diff = mw.tools.getDiff(_new, _old);\r\n                    for (var t in diff) {\r\n                        if (t in mw.storage._keys) {\r\n                            var i = 0, l = mw.storage._keys[t].length;\r\n                            for (; i < l; i++) {\r\n                                mw.storage._keys[t][i].call(diff[t]);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }, false);\r\n        }\r\n        else if (key === 'CALL') {\r\n            if (!document.isHidden() && typeof mw.storage._keys[callback] !== 'undefined') {\r\n                var i = 0, l = mw.storage._keys[callback].length;\r\n                for (; i < l; i++) {\r\n                    mw.storage._keys[callback][i].call(other);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (key in mw.storage._keys) {\r\n                mw.storage._keys[key].push(callback);\r\n            }\r\n            else {\r\n                mw.storage._keys[key] = [callback];\r\n            }\r\n        }\r\n    }\r\n};\r\nmw.storage.init();\r\n","mw.uiAccordion = function (options) {\r\n    if (!options) return;\r\n    options.element = options.element || '.mw-accordion';\r\n\r\n    var scope = this;\r\n\r\n\r\n\r\n    this.getContents = function () {\r\n        this.contents = this.root.children(this.options.contentSelector);\r\n        if (!this.contents.length) {\r\n            this.contents = mw.$();\r\n            this.root.children(this.options.itemSelector).each(function () {\r\n                var title = mw.$(this).children(scope.options.contentSelector)[0];\r\n                if (title) {\r\n                    scope.contents.push(title)\r\n                }\r\n            });\r\n        }\r\n    }\r\n    this.getTitles = function () {\r\n        this.titles = this.root.children(this.options.titleSelector);\r\n        if (!this.titles.length) {\r\n            this.titles = mw.$();\r\n            this.root.children(this.options.itemSelector).each(function () {\r\n                var title = mw.$(this).children(scope.options.titleSelector)[0];\r\n                if (title) {\r\n                    scope.titles.push(title)\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    this.prepare = function (options) {\r\n        var defaults = {\r\n            multiple: false,\r\n            itemSelector: \".mw-accordion-item,mw-accordion-item\",\r\n            titleSelector: \".mw-accordion-title,mw-accordion-title\",\r\n            contentSelector: \".mw-accordion-content,mw-accordion-content\",\r\n            openFirst: true,\r\n            toggle: true\r\n        };\r\n        this.options = $.extend({}, defaults, options);\r\n\r\n        this.root = mw.$(this.options.element).not('.mw-accordion-ready').eq(0);\r\n        if (!this.root.length) return;\r\n        this.root.addClass('mw-accordion-ready');\r\n        this.root[0].uiAccordion = this;\r\n        this.getTitles();\r\n        this.getContents();\r\n\r\n    };\r\n\r\n    this.getItem = function (q) {\r\n        var item;\r\n        if (typeof q === 'number') {\r\n            item = this.contents.eq(q)\r\n        }\r\n        else {\r\n            item = mw.$(q);\r\n        }\r\n        return item;\r\n    };\r\n\r\n    this.set = function (index) {\r\n        var item = this.getItem(index);\r\n        if (!this.options.multiple) {\r\n            this.contents.not(item)\r\n                .slideUp()\r\n                .removeClass('active')\r\n                .prev()\r\n                .removeClass('active')\r\n                .parents('.mw-accordion-item').eq(0)\r\n                .removeClass('active');\r\n        }\r\n        item.stop()\r\n            .slideDown()\r\n            .addClass('active')\r\n            .prev()\r\n            .addClass('active')\r\n            .parents('.mw-accordion-item').eq(0)\r\n            .addClass('active');\r\n        mw.$(this).trigger('accordionSet', [item]);\r\n    };\r\n\r\n    this.unset = function (index) {\r\n        if (typeof index === 'undefined') return;\r\n        var item = this.getItem(index);\r\n        item.stop()\r\n            .slideUp()\r\n            .removeClass('active')\r\n            .prev()\r\n            .removeClass('active')\r\n            .parents('.mw-accordion-item').eq(0)\r\n            .removeClass('active');\r\n\r\n        mw.$(this).trigger('accordionUnset', [item]);\r\n    }\r\n\r\n    this.toggle = function (index) {\r\n        var item = this.getItem(index);\r\n        if (item.hasClass('active')) {\r\n            if (this.options.toggle) {\r\n                this.unset(item)\r\n            }\r\n        }\r\n        else {\r\n            this.set(item)\r\n        }\r\n    }\r\n\r\n    this.init = function (options) {\r\n        this.prepare(options);\r\n        if(typeof(this.contents) !== 'undefined'){\r\n            this.contents.hide()\r\n        }\r\n\r\n        if (this.options.openFirst) {\r\n            if(typeof(this.contents) !== 'undefined'){\r\n                this.contents.eq(0).show().addClass('active')\r\n            }\r\n            if(typeof(this.titles) !== 'undefined'){\r\n                this.titles.eq(0).addClass('active').parent('.mw-accordion-item').addClass('active');\r\n            }\r\n        }\r\n        if(typeof(this.titles) !== 'undefined') {\r\n            this.titles.on('click', function () {\r\n                scope.toggle(scope.titles.index(this));\r\n            });\r\n        }\r\n    }\r\n\r\n    this.init(options);\r\n\r\n};\r\n\r\n\r\nmw.tabAccordion = function (options, accordion) {\r\n    if (!options) return;\r\n    var scope = this;\r\n    this.options = options;\r\n\r\n    this.options.breakPoint = this.options.breakPoint || 800;\r\n    this.options.activeClass = this.options.activeClass || 'active-info';\r\n\r\n\r\n    this.buildAccordion = function () {\r\n        this.accordion = accordion || new mw.uiAccordion(this.options);\r\n    }\r\n\r\n    this.breakPoint = function () {\r\n        if (matchMedia(\"(max-width: \" + this.options.breakPoint + \"px)\").matches) {\r\n            mw.$(this.nav).hide();\r\n            mw.$(this.accordion.titles).show();\r\n        }\r\n        else {\r\n            mw.$(this.nav).show();\r\n            mw.$(this.accordion.titles).hide();\r\n        }\r\n    }\r\n\r\n    this.createTabButton = function (content, index) {\r\n        this.buttons = this.buttons || mw.$();\r\n        var btn = document.createElement('span');\r\n        this.buttons.push(btn)\r\n        var size = (this.options.tabsSize ? ' mw-ui-btn-' + this.options.tabsSize : '');\r\n        var color = (this.options.tabsColor ? ' mw-ui-btn-' + this.options.tabsColor : '');\r\n        var active = (index === 0 ? (' ' + this.options.activeClass) : '');\r\n        btn.className = 'mw-ui-btn' + size + color + active;\r\n        btn.innerHTML = content;\r\n        btn.onclick = function () {\r\n            scope.buttons.removeClass(scope.options.activeClass).eq(index).addClass(scope.options.activeClass);\r\n            scope.accordion.set(index);\r\n        }\r\n        return btn;\r\n    }\r\n\r\n    this.createTabs = function () {\r\n        this.nav = document.createElement('div');\r\n        this.nav.className = 'mw-ui-btn-nav mw-ui-btn-nav-tabs';\r\n        mw.$(this.accordion.titles)\r\n            .each(function (i) {\r\n                scope.nav.appendChild(scope.createTabButton($(this).html(), i))\r\n            })\r\n            .hide();\r\n        mw.$(this.accordion.root).before(this.nav)\r\n    }\r\n\r\n    this.init = function () {\r\n        this.buildAccordion();\r\n        this.createTabs();\r\n        this.breakPoint();\r\n        mw.$(window).on('load resize orientationchange', function () {\r\n            scope.breakPoint();\r\n        });\r\n    };\r\n\r\n    this.init();\r\n};\r\n","mw.autoComplete = function(options){\r\n    var scope = this;\r\n    this.prepare = function(options){\r\n        options = options || {};\r\n        if(!options.data && !options.ajaxConfig) return;\r\n        var defaults = {\r\n            size:'normal',\r\n            multiple:false,\r\n            map: { title:'title', value:'id' },\r\n            titleDecorator: function (title, data) {\r\n                return title;\r\n            }\r\n        };\r\n        this.options = $.extend({}, defaults, options);\r\n        this.options.element = mw.$(this.options.element)[0];\r\n        if(!this.options.element){\r\n            return;\r\n        }\r\n        this.element = this.options.element;\r\n        this.data = this.options.data;\r\n        this.searchTime = null;\r\n        this.searchTimeout = this.options.data ? 0 : 500;\r\n        this.results = [];\r\n        this.map = this.options.map;\r\n        this.selected = this.options.selected || [];\r\n    };\r\n\r\n    this.createValueHolder = function(){\r\n        this.valueHolder = document.createElement('div');\r\n        this.valueHolder.className = 'mw-autocomplete-value';\r\n        return this.valueHolder;\r\n    };\r\n    this.createListHolder = function(){\r\n        this.listHolder = document.createElement('ul');\r\n        this.listHolder.className = 'mw-ui-box mw-ui-navigation mw-autocomplete-list';\r\n        this.listHolder.style.display = 'none';\r\n        return this.listHolder;\r\n    };\r\n\r\n    this.createWrapper = function(){\r\n        this.wrapper = document.createElement('div');\r\n        this.wrapper.className = 'mw-ui-field w100 mw-autocomplete mw-autocomplete-multiple-' + this.options.multiple;\r\n        return this.wrapper;\r\n    };\r\n\r\n    this.createField = function(){\r\n        this.inputField = document.createElement('input');\r\n        this.inputField.className = 'mw-ui-invisible-field mw-autocomplete-field mw-ui-field-' + this.options.size;\r\n        if(this.options.placeholder){\r\n            this.inputField.placeholder = this.options.placeholder;\r\n        }\r\n        mw.$(this.inputField).on('input focus', function(e){\r\n            var val = e.type === 'focus' ? '' : this.value;\r\n            scope.search(val);\r\n        });\r\n        return this.inputField;\r\n    };\r\n\r\n    this.buildUI = function(){\r\n        this.createWrapper();\r\n        this.wrapper.appendChild(this.createValueHolder());\r\n        this.wrapper.appendChild(this.createField());\r\n        this.wrapper.appendChild(this.createListHolder());\r\n        this.element.appendChild(this.wrapper);\r\n    };\r\n\r\n    this.createListItem = function(data){\r\n        var li = document.createElement('li');\r\n        li.value = this.dataValue(data);\r\n        var img = this.dataImage(data);\r\n\r\n        mw.$(li)\r\n        .append( '<a href=\"javascript:;\">'+this.dataTitle(data)+'</a>' )\r\n        .on('click', function(){\r\n            scope.select(data);\r\n        });\r\n        if(img){\r\n            mw.$('a',li).prepend(img);\r\n        }\r\n        return li;\r\n    };\r\n\r\n    this.uniqueValue = function(){\r\n        var uniqueIds = [], final = [];\r\n        this.selected.forEach(function(item){\r\n            var val = scope.dataValue(item);\r\n            if(uniqueIds.indexOf(val) === -1){\r\n                uniqueIds.push(val);\r\n                final.push(item);\r\n            }\r\n        });\r\n        this.selected = final;\r\n    };\r\n\r\n    this.select = function(item){\r\n        if(this.options.multiple){\r\n            this.selected.push(item);\r\n        }\r\n        else{\r\n            this.selected = [item];\r\n        }\r\n        this.rendSelected();\r\n        if(!this.options.multiple){\r\n            this.listHolder.style.display = 'none';\r\n        }\r\n        mw.$(this).trigger('change', [this.selected]);\r\n    };\r\n\r\n    this.rendSingle = function(){\r\n        var item = this.selected[0];\r\n        this.inputField.value = item ? item[this.map.title] : '';\r\n        this.valueHolder.innerHTML = '';\r\n        var img = this.dataImage(item);\r\n        if(img){\r\n            this.valueHolder.appendChild(img);\r\n        }\r\n\r\n    };\r\n\r\n    this.rendSelected = function(){\r\n        if(this.options.multiple){\r\n            this.uniqueValue();\r\n            this.chips.setData(this.selected);\r\n        }\r\n        else{\r\n            this.rendSingle();\r\n        }\r\n    };\r\n\r\n    this.rendResults = function(){\r\n        mw.$(this.listHolder).empty().show();\r\n        $.each(this.results, function(){\r\n            scope.listHolder.appendChild(scope.createListItem(this));\r\n        });\r\n    };\r\n\r\n    this.dataValue = function(data){\r\n        if(!data) return;\r\n        if(typeof data === 'string'){\r\n            return data;\r\n        }\r\n        else{\r\n            return data[this.map.value];\r\n        }\r\n    };\r\n    this.dataImage = function(data){\r\n        if(!data) return;\r\n        if(data.picture){\r\n            data.image = data.picture;\r\n        }\r\n        if(data.image){\r\n            var img = document.createElement('span');\r\n            img.className = 'mw-autocomplete-img';\r\n            img.style.backgroundImage = 'url(' + data.image + ')';\r\n            return img;\r\n        }\r\n    };\r\n    this.dataTitle = function(data){\r\n        if (!data) return;\r\n        var title;\r\n        if (typeof data === 'string') {\r\n            title = data;\r\n        }\r\n        else {\r\n            title = data[this.map.title];\r\n        }\r\n\r\n        return this.options.titleDecorator(title, data);\r\n    };\r\n\r\n    this.searchRemote = function(val){\r\n        var config = mw.tools.cloneObject(this.options.ajaxConfig);\r\n\r\n        if(config.data){\r\n            if(typeof config.data === 'string'){\r\n                config.data = config.data.replace('${val}',val);\r\n            }\r\n            else{\r\n               $.each(config.data, function(key,value){\r\n\r\n                    if(value.indexOf && value.indexOf('${val}') !==-1 ){\r\n                        config.data[key] = value.replace('${val}', val);\r\n                    }\r\n               });\r\n            }\r\n        }\r\n        if(config.url){\r\n            config.url = config.url.replace('${val}',val);\r\n        }\r\n        var xhr = $.ajax(config);\r\n        xhr.done(function(data){\r\n            if(data.data){\r\n                scope.data = data.data;\r\n            }\r\n            else{\r\n               scope.data = data;\r\n            }\r\n            scope.results = scope.data;\r\n            scope.rendResults();\r\n        })\r\n        .always(function(){\r\n            scope.searching = false;\r\n        });\r\n    };\r\n\r\n    this.searchLocal = function(val){\r\n\r\n        this.results = [];\r\n        var toSearch;\r\n        $.each(this.data, function(){\r\n           if(typeof this === 'string'){\r\n                toSearch = this.toLowerCase();\r\n           }\r\n           else{\r\n               toSearch = this[scope.map.title].toLowerCase();\r\n           }\r\n           if(toSearch.indexOf(val) !== -1){\r\n            scope.results.push(this);\r\n           }\r\n        });\r\n       this.rendResults();\r\n       scope.searching = false;\r\n    };\r\n\r\n    this.search = function(val){\r\n        if(scope.searching) return;\r\n        val = val || '';\r\n        val = val.trim().toLowerCase();\r\n\r\n        if(this.options.data){\r\n            this.searchLocal(val);\r\n        }\r\n        else{\r\n            clearTimeout(this.searchTime);\r\n            setTimeout(function(){\r\n                scope.searching = true;\r\n                scope.searchRemote(val);\r\n            }, this.searchTimeout);\r\n        }\r\n    };\r\n\r\n    this.init = function(){\r\n        this.prepare(options);\r\n        this.buildUI();\r\n        if(this.options.multiple){\r\n            this.chips = new mw.chips({\r\n                element:this.valueHolder,\r\n                data:[]\r\n            });\r\n        }\r\n        this.rendSelected();\r\n        this.handleEvents();\r\n    };\r\n\r\n    this.handleEvents = function(){\r\n        mw.$(document.body).on('click', function(e){\r\n            if(!mw.tools.hasParentsWithClass(e.target, 'mw-autocomplete')){\r\n                scope.listHolder.style.display = 'none';\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n    this.init();\r\n\r\n};\r\n","mw.blockEdit = function (options) {\r\n    options = options || {};\r\n    var defaults = {\r\n        element: document.body,\r\n        mode: 'wrap' // wrap | in\r\n    };\r\n\r\n    var scope = this;\r\n\r\n    var settings = $.extend({}, defaults, options);\r\n\r\n    settings.$element = mw.$(settings.element);\r\n    settings.element = settings.$element[0];\r\n    this.settings = settings;\r\n    if(!settings.element) {\r\n        return;\r\n    }\r\n\r\n    this.set = function(mode){\r\n        if(mode === 'edit'){\r\n            this.$slider.stop().animate({\r\n                left: '-100%',\r\n                height: this.$editSlide.outerHeight()\r\n            }, function(){\r\n                scope.$holder.addClass('mw-block-edit-editing');\r\n                scope.$slider.height('auto');\r\n            });\r\n        } else {\r\n            this.$slider.stop().animate({\r\n                left: '0',\r\n                height: this.$mainSlide.outerHeight()\r\n            }, function(){\r\n                scope.unEditByElement();\r\n                scope.$holder.removeClass('mw-block-edit-editing');\r\n                scope.$slider.height('auto');\r\n            });\r\n        }\r\n    };\r\n\r\n    this.close = function(content){\r\n        this.set();\r\n        $(this).trigger('CloseEdit');\r\n    };\r\n    this.edit = function(content){\r\n        if(content){\r\n            this.$editSlide.empty().append(content);\r\n        }\r\n        this.set('edit');\r\n        $(this).trigger('Edit');\r\n    };\r\n\r\n    this._editByElement = null;\r\n    this._editByElementTemp = null;\r\n\r\n    this.unEditByElement = function(){\r\n        if(this._editByElement){\r\n            $(this._editByElementTemp).replaceWith(this._editByElement);\r\n            $(this._editByElement).hide()\r\n        }\r\n        this._editByElement = null;\r\n        this._editByElementTemp = null;\r\n    };\r\n\r\n    this.editByElement = function(el){\r\n        if(!el){\r\n            return;\r\n        }\r\n        this.unEditByElement();\r\n        this._editByElementTemp = document.createElement('mw-temp');\r\n        this._editByElement = el;\r\n        $(el).before(this._editByElementTemp);\r\n        this.editSlide.appendChild(el);\r\n        $(el).show()\r\n    };\r\n    this.moduleEdit = function(module, params){\r\n        mw.tools.loading(this.holder, 90);\r\n        mw.load_module(module, this.editSlide, function(){\r\n            scope.edit();\r\n            mw.tools.loading(scope.holder, false);\r\n        }, params);\r\n    };\r\n\r\n    this.build = function(){\r\n        this.holder = document.createElement('div');\r\n        this.$holder = $(this.holder);\r\n        this.holder.className = 'mw-block-edit-holder';\r\n        this.holder._blockEdit = this;\r\n        this.slider = document.createElement('div');\r\n        this.$slider = $(this.slider);\r\n        this.slider.className = 'mw-block-edit-slider';\r\n        this.mainSlide = document.createElement('div');\r\n        this.$mainSlide = $(this.mainSlide);\r\n        this.editSlide = document.createElement('div');\r\n        this.$editSlide = $(this.editSlide);\r\n        this.mainSlide.className = 'mw-block-edit-main-slide';\r\n        this.editSlide.className = 'mw-block-edit-edit-slide';\r\n\r\n        this.slider.appendChild(this.mainSlide);\r\n        this.slider.appendChild(this.editSlide);\r\n        this.holder.appendChild(this.slider);\r\n        //this.settings.$element.before(this.holder);\r\n        // this.mainSlide.appendChild(settings.element);\r\n\r\n    };\r\n\r\n    this.initMode = function(){\r\n        if(this.settings.mode === 'wrap') {\r\n            this.settings.$element.after(this.holder);\r\n            this.$mainSlide.append(this.settings.$element);\r\n        } else if(this.settings.mode === 'in') {\r\n            this.settings.$element.wrapInner(this.holder);\r\n        }\r\n    };\r\n\r\n    this.init = function () {\r\n        this.build();\r\n        this.initMode();\r\n    };\r\n\r\n    this.init();\r\n\r\n};\r\n\r\nmw.blockEdit.get = function(target){\r\n    target = target || '.mw-block-edit-holder';\r\n    target = mw.$(target);\r\n    if(!target[0]) return;\r\n    if(target.hasClass('mw-block-edit-holder')){\r\n        return target[0]._blockEdit;\r\n    } else {\r\n        var node = mw.tools.firstParentWithClass(target[0], 'mw-block-edit-holder') || target[0].querySelector('.mw-block-edit-holder');\r\n        if(node){\r\n            return node._blockEdit;\r\n        }\r\n    }\r\n};\r\n\r\n$.fn.mwBlockEdit = function (options) {\r\n    options = options || {};\r\n    return this.each(function(){\r\n        this.mwBlockEdit =  new mw.blockEdit($.extend({}, options, {element: this }));\r\n    });\r\n};\r\n\r\nmw.registerComponent('block-edit', function(el){\r\n    var options = mw.components._options(el);\r\n    mw.$(el).mwBlockEdit(options);\r\n});\r\nmw.registerComponent('block-edit-closeButton', function(el){\r\n    mw.$(el).on('click', function(){\r\n        mw.blockEdit.get(this).close();\r\n    });\r\n});\r\nmw.registerComponent('block-edit-editButton', function(el){\r\n    mw.$(el).on('click', function(){\r\n        var options = mw.components._options(this);\r\n        if(options.module){\r\n            mw.blockEdit.get(options.for || this).moduleEdit(options.module);\r\n            return;\r\n        } else if(options.element){\r\n            var el = mw.$(options.element)[0];\r\n            if(el){\r\n                mw.blockEdit.get(options.for || this).editByElement(el);\r\n            }\r\n        }\r\n        mw.blockEdit.get(this).edit();\r\n    });\r\n});\r\n","mw.controlBox = function(options){\r\n    var scope = this;\r\n    this.options = options;\r\n    this.defaults = {\r\n        position:'bottom',\r\n        content:'',\r\n        skin:'default',\r\n        id:this.options.id || 'mw-control-box-'+mw.random(),\r\n        closeButton: true\r\n    };\r\n    this.id = this.options.id;\r\n    this.settings = $.extend({}, this.defaults, this.options);\r\n    this.active = false;\r\n\r\n    this.build = function(){\r\n        this.box = document.createElement('div');\r\n        this.box.className = 'mw-control-box mw-control-box-' + this.settings.position + ' mw-control-box-' + this.settings.skin;\r\n        this.box.id = this.id;\r\n        this.boxContent = document.createElement('div');\r\n        this.boxContent.className = 'mw-control-boxcontent';\r\n        this.box.appendChild(this.boxContent);\r\n        this.createCloseButton();\r\n        document.body.appendChild(this.box);\r\n    };\r\n\r\n    this.createCloseButton = function () {\r\n        if(!this.options.closeButton) return;\r\n        this.closeButton = document.createElement('span');\r\n        this.closeButton.className = 'mw-control-boxclose';\r\n        this.box.appendChild(this.closeButton);\r\n        this.closeButton.onclick = function(){\r\n            scope.hide();\r\n        };\r\n    };\r\n\r\n    this.setContentByUrl = function(){\r\n        var cont = this.settings.content.trim();\r\n        return $.get(cont, function(data){\r\n            scope.boxContent.innerHTML = data;\r\n            scope.settings.content = data;\r\n        });\r\n    };\r\n    this.setContent = function(c){\r\n        var cont = c||this.settings.content.trim();\r\n        this.settings.content = cont;\r\n        if(cont.indexOf('http://') === 0 || cont.indexOf('https://') === 0){\r\n            return this.setContentByUrl()\r\n        }\r\n        this.boxContent.innerHTML = cont;\r\n    };\r\n\r\n    this.show = function(){\r\n        this.active = true;\r\n        mw.$(this.box).addClass('active') ;\r\n        mw.$(this).trigger('ControlBoxShow')\r\n    };\r\n\r\n    this.init = function(){\r\n        this.build();\r\n        this.setContent();\r\n    };\r\n    this.hide = function(){\r\n        this.active = false;\r\n        mw.$(this.box).removeClass('active');\r\n        mw.$(this).trigger('ControlBoxHide');\r\n    };\r\n\r\n\r\n    this.toggle = function(){\r\n        this[this.active?'hide':'show']();\r\n    };\r\n    this.init();\r\n};\r\n","\r\n\r\n\r\nmw.IconClassResolver = function ($for) {\r\n    if (!$for) {\r\n        return '';\r\n    }\r\n    switch ($for) {\r\n        case 'shop': $for = 'mdi mdi-shopping'; break;\r\n        case 'website': $for = 'mdi mdi-earth'; break;\r\n        case 'module': $for = 'mdi mdi-view-grid-plus'; break;\r\n        case 'marketplace': $for = 'mdi mdi-fruit-cherries'; break;\r\n        case 'users': $for = 'mdi mdi-account-multiple'; break;\r\n        case 'post': $for = 'mdi mdi-text'; break;\r\n        case 'page': $for = 'mdi mdi-shopping'; break;\r\n        case 'static': $for = 'mdi mdi-shopping'; break;\r\n        case 'category': $for = 'mdi mdi-folder'; break;\r\n        case 'product': $for = 'mdi mdi-shopping'; break;\r\n\r\n        default: $for = '';\r\n    }\r\n    return $for;\r\n};\r\n\r\nmw.controlFields = {\r\n    __id: new Date().getTime(),\r\n    _id: function () {\r\n        this.__id++;\r\n        return 'le-' + this.__id;\r\n    },\r\n    _label: function (conf) {\r\n        var id = conf.id || this._id();\r\n        var label = document.createElement('label');\r\n        label.className = conf.className || 'mw-ui-label';\r\n        label.innerHTML = conf.label || conf.content || '';\r\n        label.htmlFor = id;\r\n        return label;\r\n    },\r\n    _button: function (conf){\r\n        var id = conf.id || this._id();\r\n        var button = document.createElement('button');\r\n        button.type = conf.type || 'button';\r\n        button.className = 'mw-ui-btn btn-' + conf.size + ' btn-' + conf.color;\r\n        button.innerHTML = (conf.label || conf.content);\r\n        return button;\r\n    },\r\n    _wrap: function () {\r\n        var el =  document.createElement('div');\r\n        el.className = 'mw-ui-field-holder';\r\n        [].forEach.call(arguments, function (content) {\r\n            if (typeof content === 'string') {\r\n                el.innerHTML += content;\r\n            } else {\r\n                el.append(content);\r\n            }\r\n        });\r\n        return el;\r\n        // return '<div class=\"form-group\">' + content + '</div>';\r\n    },\r\n    _description: function (conf) {\r\n        return conf.description ? ('<small class=\"text-muted d-block mb-2\">' + conf.description + '</small>') : '';\r\n    },\r\n    field: function (conf) {\r\n        conf = conf || {};\r\n        var placeholder = conf.placeholder ? ('placeholder=\"' + conf.placeholder + '\"') : '';\r\n        var id = (conf.id || this._id());\r\n        id =  (' id=\"' + id + '\" ');\r\n        var name = conf.name ? ('name=\"' + conf.name + '\"') : '';\r\n        conf.type = conf.type || 'text';\r\n        var required = conf.required ? ('required') : '';\r\n\r\n        return this._wrap(\r\n            this._label(conf),\r\n            this._description(conf),\r\n            '<input type=\"'+conf.type+'\" '+placeholder + '  ' + id + ' ' + name + ' ' + required + ' class=\"mw-ui-field w100\">'\r\n        );\r\n    },\r\n    checkbox: function (conf) {\r\n        conf = conf || {};\r\n        conf.className = conf.className || 'custom-control-label';\r\n        var id = (conf.id || this._id());\r\n        conf.id = id;\r\n        id =  (' id=\"' + id + '\" ');\r\n        var name = conf.name ? ('name=\"' + conf.name + '\"') : '';\r\n        var required = conf.required ? ('required') : '';\r\n        return  this._wrap(\r\n            '<label class=\"mw-ui-check\">' +\r\n            '<input type=\"checkbox\" ' + id + ' ' + name + ' ' + required + '>' +\r\n            '<span></span><span>' + (conf.label || conf.content || '') + '</span>' +\r\n            '</label>');\r\n    },\r\n    radio: function (conf) {\r\n        conf = conf || {};\r\n        var id = (conf.id || this._id());\r\n        id =  (' id=\"' + id + '\" ');\r\n        var value =  (' value=\"' + conf.value + '\" ');\r\n        var name = conf.name ? ('name=\"' + conf.name + '\"') : '';\r\n        var required = conf.required ? ('required') : '';\r\n        return  this._wrap(\r\n            '<label class=\"mw-ui-check\">' +\r\n            '<input type=\"radio\" ' + id + ' ' + name + ' ' + required + ' ' + value + '>' +\r\n                '<span></span><span>' + (conf.label || conf.content || '') + '</span>' +\r\n            '</label>');\r\n    },\r\n    select: function (conf) {\r\n        conf = conf || {};\r\n        var id = (conf.id || this._id());\r\n        id =  (' id=\"' + id + '\" ');\r\n        var name = conf.name ? ('name=\"' + conf.name + '\"') : '';\r\n        var required = conf.required ? ('required') : '';\r\n        var multiple = conf.multiple ? ('multiple') : '';\r\n\r\n        var options = (conf.options || []).map(function (item){\r\n            return '<option value=\"'+ item.value +'\">'+(item.title||item.name||item.label||item.value)+'</option>';\r\n        }).join('');\r\n\r\n        return  this._wrap(\r\n            this._label(conf) +\r\n            '<select class=\"selectpicker\" ' + multiple + '  ' + id + ' ' + name + ' ' + required + '>' +\r\n            options +\r\n            '</select>' );\r\n    }\r\n};\r\n\r\nmw.emitter = {\r\n    _events: {},\r\n    _onNative: function (node, type, callback) {\r\n        type.trim().split(' ').forEach(function (ev) {\r\n            node.addEventListener(ev, callback);\r\n        });\r\n    },\r\n    on: function (event, callback, c) {\r\n        if(!event) return;\r\n        if(Array.isArray(event)) {\r\n            for(var i = 0; i < event.length; i++) {\r\n                this.on(event[i], callback, c);\r\n            }\r\n            return;\r\n        }\r\n        if(event.nodeName) {\r\n            return this._onNative(event, callback, c);\r\n        }\r\n        if (!this._events[event]){\r\n            this._events[event] = [];\r\n        }\r\n        this._events[event].push(callback);\r\n    },\r\n    dispatch: function(event, data) {\r\n        if (this._events[event]) {\r\n            this._events[event].forEach(function(handler) {\r\n                handler(data);\r\n            });\r\n        }\r\n    }\r\n};\r\n\r\n(function(){\r\n    var UIFormControllers = {\r\n        _title: function (conf, root) {\r\n            var title = mw.element({\r\n                tag: 'h5',\r\n                props: {\r\n                    className: 'mw-ui-form-controller-title',\r\n                    innerHTML: '<strong>' + conf.title + '</strong>'\r\n                }\r\n            });\r\n            mw.element(root).append(title);\r\n        },\r\n        footer: function () {\r\n            var data = {};\r\n            data.ok =  mw.controlFields._button({content: mw.lang('OK'), color: 'primary'});\r\n            data.cancel =  mw.controlFields._button({content: mw.lang('Cancel')});\r\n            data.root = mw.controlFields._wrap(data.cancel, data.ok);\r\n            data.root.className = 'mw-ui-form-controllers-footer';\r\n            return data;\r\n        },\r\n        title: function (options) {\r\n            var scope = this;\r\n            var defaults = {\r\n                text: {\r\n                    label: mw.lang('Link text'),\r\n                    description: mw.lang('Selected text for the link.'),\r\n                },\r\n                icon: 'mdi mdi-view-compact-outline',\r\n                // icon: 'mdi mdi-format-page-break',\r\n                title: 'Page title'\r\n            };\r\n            options =  mw.object.extend(true, {}, defaults, (options || {}));\r\n            this.settings = options;\r\n            if (options.text === true) options.text = defaults.text;\r\n            if (options.link === true) options.link = defaults.link;\r\n            if (options.target === true) options.target = defaults.target;\r\n\r\n            var root = document.createElement('div');\r\n            root.className = 'mw-ui-form-controller-root';\r\n            var _linkText = '', _linkUrl = '', _target = '';\r\n\r\n            if (options.text) {\r\n                _linkText = mw.controlFields.field({\r\n                    label: options.text.label,\r\n                    description: options.text.description,\r\n                    name: 'text'\r\n                });\r\n            }\r\n\r\n            UIFormControllers._title(this.settings, root)\r\n\r\n\r\n            var count = 0;\r\n            var html = [];\r\n            this.url = '';\r\n            var available_elements = document.createElement('div');\r\n            available_elements.className = 'mw-ui-box mw-ui-box-content';\r\n            var rname = mw.controlFields._id();\r\n            mw.top().$(\"h1,h12,h3,h4,h5,h6\", mw.top().win.document.body).each(function () {\r\n                if(!!this.id || mw.tools.isEditable(this)){\r\n                    if(!this.id) {\r\n                        this.id = mw.id('mw-title-element-');\r\n                    }\r\n                    count++;\r\n                    html.push({id: this.id, text: this.textContent});\r\n                    var li = mw.controlFields.radio({\r\n                        label:  '<strong>' + this.nodeName + '</strong> - ' + this.textContent,\r\n                        name: rname,\r\n                        id: mw.controlFields._id(),\r\n                        value: '#' + this.id\r\n                    });\r\n                    mw.element(available_elements).append(li);\r\n                    li.querySelector('input').oninput = function () {\r\n                        scope.url = this.value;\r\n                        scope.valid();\r\n                    };\r\n                }\r\n\r\n            });\r\n\r\n            var holder = document.createElement('div');\r\n            holder.append(_linkText);\r\n            holder.append(available_elements);\r\n\r\n\r\n            var textField = holder.querySelector('[name=\"text\"]');\r\n\r\n            this.valid = function () {\r\n                var res = this.isValid();\r\n                footer.ok.disabled = !res;\r\n                return res;\r\n            };\r\n\r\n            this.isValid = function () {\r\n                if(textField && !textField.value) {\r\n                    return false;\r\n                }\r\n                if(!this.url) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            };\r\n\r\n            var footer = UIFormControllers.footer();\r\n\r\n            this.setValue = function (val) {\r\n                val = val || {};\r\n                if(textField) textField.value = val.text || '';\r\n            };\r\n\r\n            this.getValue = function () {\r\n                var val = {};\r\n                if(textField) val.text = textField.value;\r\n                val.url = this.url\r\n                return val;\r\n            };\r\n\r\n            this._onChange = [];\r\n            this.onChange = function (c) {\r\n                this._onChange.push(c);\r\n            };\r\n\r\n            this._confirm = [];\r\n            this.onConfirm = function (c) {\r\n                this._confirm.push(c);\r\n            };\r\n\r\n            this._cancel = [];\r\n            this.onCancel = function (c) {\r\n                this._cancel.push(c);\r\n            };\r\n\r\n\r\n            mw.emitter.on([textField], 'input', function (e){\r\n                if(scope.valid()) {\r\n                    scope._onChange.forEach(function (f){\r\n                        f(scope.getValue());\r\n                    });\r\n                }\r\n            });\r\n\r\n            mw.emitter.on(footer.ok, 'click', function (e){\r\n                scope._confirm.forEach(function (f){\r\n                    f(scope.getValue());\r\n                });\r\n            });\r\n\r\n            mw.emitter.on(footer.cancel, 'click', function (e){\r\n                scope._cancel.forEach(function (f){\r\n                    f();\r\n                });\r\n            });\r\n\r\n            root.append(holder);\r\n\r\n            root.append(footer.root);\r\n\r\n            this.valid();\r\n\r\n            this.root = root;\r\n        },\r\n        layout: function (options) {\r\n            var scope = this;\r\n            var defaults = {\r\n                text: {\r\n                    label: mw.lang('Link text'),\r\n                    description: mw.lang('Selected text for the link.'),\r\n                },\r\n                icon: 'mdi mdi-view-compact-outline',\r\n                // icon: 'mdi mdi-format-page-break',\r\n                title: 'Page block'\r\n            };\r\n            options =  mw.object.extend(true, {}, defaults, (options || {}));\r\n             this.settings = options;\r\n            if (options.text === true) options.text = defaults.text;\r\n            if (options.link === true) options.link = defaults.link;\r\n            if (options.target === true) options.target = defaults.target;\r\n\r\n            var root = document.createElement('div');\r\n            root.className = 'mw-ui-form-controller-root';\r\n            var _linkText = '', _linkUrl = '', _target = '';\r\n\r\n            if (options.text) {\r\n                _linkText = mw.controlFields.field({\r\n                    label: options.text.label,\r\n                    description: options.text.description,\r\n                    name: 'text'\r\n                });\r\n            }\r\n            UIFormControllers._title(this.settings, root)\r\n\r\n            var layoutsData = [];\r\n            var layouts = mw.top().$('.module[data-type=\"layouts\"]');\r\n            layouts.each(function () {\r\n                layoutsData.push({\r\n                    name: (this.getAttribute('template') || this.dataset.template || '').split('.')[0],\r\n                    element: this,\r\n                    id: this.id\r\n                });\r\n            });\r\n            var list = $('<div />');\r\n            this.link = '';\r\n            var radioName = mw.id();\r\n            $.each(layoutsData, function(){\r\n                var li = mw.controlFields.radio({\r\n                    label: this.name,\r\n                    name: radioName,\r\n                    id: mw.controlFields._id(),\r\n                    value: this.id\r\n                });\r\n                var el = this.element;\r\n                $(li).find('input').on('click', function(){\r\n                    mw.top().tools.scrollTo(el);\r\n                    scope.link = mw.top().win.location.href.split('#')[0] + '#mw@' + el.id;\r\n                    scope.url = mw.top().win.location.href.split('#')[0] + '#mw@' + el.id;\r\n                    scope.src = mw.top().win.location.href.split('#')[0] + '#mw@' + el.id;\r\n                    console.log(scope.link)\r\n                    scope.valid();\r\n                });\r\n                list.append(li);\r\n            });\r\n            if(layoutsData.length > 0){\r\n                $('.page-layout-btn').show();\r\n            }\r\n\r\n            var holder = document.createElement('div');\r\n            holder.append(_linkText);\r\n            holder.append(list[0]);\r\n\r\n\r\n            var textField = holder.querySelector('[name=\"text\"]');\r\n\r\n            this.valid = function () {\r\n                var res = this.isValid();\r\n                footer.ok.disabled = !res;\r\n                return res;\r\n            };\r\n\r\n            this.isValid = function () {\r\n                if(textField && !textField.value) {\r\n                    return false;\r\n                } else if(!this.link) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            };\r\n\r\n            var footer = UIFormControllers.footer();\r\n\r\n            this.setValue = function (val) {\r\n                val = val || {};\r\n                if(textField) textField.value = val.text || '';\r\n              };\r\n\r\n            this.getValue = function () {\r\n                var val = {};\r\n                if(textField) val.text = textField.value;\r\n                val.url = scope.link;\r\n                  return val;\r\n            };\r\n\r\n            this._onChange = [];\r\n            this.onChange = function (c) {\r\n                this._onChange.push(c);\r\n            };\r\n\r\n            this._confirm = [];\r\n            this.onConfirm = function (c) {\r\n                this._confirm.push(c);\r\n            };\r\n\r\n            this._cancel = [];\r\n            this.onCancel = function (c) {\r\n                this._cancel.push(c);\r\n            };\r\n\r\n\r\n            mw.emitter.on([textField], 'input', function (e){\r\n                if(scope.valid()) {\r\n                    scope._onChange.forEach(function (f){\r\n                        f(scope.getValue());\r\n                    });\r\n                }\r\n            });\r\n\r\n            mw.emitter.on(footer.ok, 'click', function (e){\r\n                 scope._confirm.forEach(function (f){\r\n                    f(scope.getValue());\r\n                });\r\n            });\r\n\r\n            mw.emitter.on(footer.cancel, 'click', function (e){\r\n                scope._cancel.forEach(function (f){\r\n                    f();\r\n                });\r\n            });\r\n\r\n            root.append(holder);\r\n\r\n            root.append(footer.root);\r\n\r\n            this.valid();\r\n\r\n            this.root = root;\r\n        },\r\n        email: function (options) {\r\n            var scope = this;\r\n            var defaults = {\r\n                text: {\r\n                    label: mw.lang('Link text'),\r\n                    description: mw.lang('Selected text for the link.'),\r\n                },\r\n                link: {\r\n                    label: mw.lang('Email'),\r\n                    description: mw.lang('Type email address in the field'),\r\n                    placeholder: \"hello@example.com\",\r\n                },\r\n                target: {\r\n                    label: mw.lang('Open the link in a new window')\r\n                },\r\n                icon: 'mdi mdi-email-outline',\r\n                title: 'Email'\r\n            };\r\n            options =  mw.object.extend(true, {}, defaults, (options || {}));\r\n            this.settings = options;\r\n            if (options.text === true) options.text = defaults.text;\r\n            if (options.link === true) options.link = defaults.link;\r\n            if (options.target === true) options.target = defaults.target;\r\n\r\n            var root = document.createElement('div');\r\n            root.className = 'mw-ui-form-controller-root';\r\n            var _linkText = '', _linkUrl = '', _target = '';\r\n            UIFormControllers._title(this.settings, root)\r\n            if (options.text) {\r\n                _linkText = mw.controlFields.field({\r\n                    label: options.text.label,\r\n                    description: options.text.description,\r\n                    name: 'text'\r\n                });\r\n            }\r\n            if (options.link) {\r\n                _linkUrl = mw.controlFields.field({\r\n                    label: options.link.label,\r\n                    description: options.link.description,\r\n                    placeholder: options.link.placeholder,\r\n                    name: 'url'\r\n                });\r\n            }\r\n\r\n            if (options.target) {\r\n                _target = mw.controlFields.checkbox({\r\n                    label: options.target.label,\r\n                    name: 'target'\r\n                });\r\n            }\r\n\r\n\r\n            var holder = document.createElement('div');\r\n            holder.append(_linkText);\r\n            holder.append(_linkUrl);\r\n            holder.append(_target);\r\n\r\n\r\n            var textField = holder.querySelector('[name=\"text\"]');\r\n            var urlField = holder.querySelector('[name=\"url\"]');\r\n            var targetField = holder.querySelector('[name=\"target\"]');\r\n\r\n            this.valid = function () {\r\n                var res = this.isValid();\r\n                footer.ok.disabled = !res;\r\n                return res;\r\n            };\r\n\r\n            this.isValid = function () {\r\n                if(textField && !textField.value) {\r\n                    return false;\r\n                }\r\n                if(urlField && !urlField.value) {\r\n                    return false;\r\n                }\r\n\r\n                return urlField.validity;\r\n            };\r\n\r\n            var footer = UIFormControllers.footer();\r\n\r\n            this.setValue = function (val) {\r\n                val = val || {};\r\n                if(textField) textField.value = val.text || '';\r\n                if(urlField) urlField.value = (val.url || '');\r\n                if(targetField)  targetField.checked = val.target;\r\n            };\r\n\r\n            this.getValue = function () {\r\n                var val = {};\r\n                if(textField) val.text = textField.value;\r\n                if(urlField) val.url = 'mailto:' + urlField.value;\r\n                if(targetField) val.target = targetField.checked;\r\n                return val;\r\n            };\r\n\r\n            this._onChange = [];\r\n            this.onChange = function (c) {\r\n                this._onChange.push(c);\r\n            };\r\n\r\n            this._confirm = [];\r\n            this.onConfirm = function (c) {\r\n                this._confirm.push(c);\r\n            };\r\n\r\n            this._cancel = [];\r\n            this.onCancel = function (c) {\r\n                this._cancel.push(c);\r\n            };\r\n\r\n\r\n            mw.emitter.on([textField, urlField, targetField], 'input', function (e){\r\n                if(scope.valid()) {\r\n                    scope._onChange.forEach(function (f){\r\n                        f(scope.getValue());\r\n                    });\r\n                }\r\n            });\r\n\r\n            mw.emitter.on(footer.ok, 'click', function (e){\r\n                scope._confirm.forEach(function (f){\r\n                    f(scope.getValue());\r\n                });\r\n            });\r\n\r\n            mw.emitter.on(footer.cancel, 'click', function (e){\r\n                scope._cancel.forEach(function (f){\r\n                    f();\r\n                });\r\n            });\r\n\r\n            root.append(holder);\r\n\r\n            root.append(footer.root);\r\n\r\n            this.valid();\r\n\r\n            this.root = root;\r\n        },\r\n\r\n        post: function (options) {\r\n            var scope = this;\r\n            var defaults = {\r\n                text: {\r\n                    label: mw.lang('Link text'),\r\n                    description: mw.lang('Selected text for the link.'),\r\n                },\r\n                target: {\r\n                    label: mw.lang('Open the link in a new window')\r\n                },\r\n                url: {\r\n                    label: mw.lang('Search for content')\r\n                },\r\n                icon: 'mdi mdi-format-list-bulleted-square',\r\n                title: 'Post/category',\r\n                dataUrl: function () {\r\n                    try {\r\n                        return mw.settings.site_url + \"api/get_content_admin\";\r\n                    } catch (e) {\r\n                        return null;\r\n                    }\r\n                }\r\n            };\r\n            options =  mw.object.extend(true, {}, defaults, (options || {}));\r\n            this.settings = options;\r\n            if (options.text === true) options.text = defaults.text;\r\n            if (options.target === true) options.target = defaults.target;\r\n\r\n            var root = document.createElement('div');\r\n            root.className = 'mw-ui-form-controller-root';\r\n            var _linkText = '', _linkUrl = '', _target = '';\r\n            UIFormControllers._title(this.settings, root);\r\n            var treeEl = document.createElement('div');\r\n            treeEl.className = 'form-group mw-link-editor-posts-search';\r\n\r\n            if (options.text) {\r\n                _linkText = mw.controlFields.field({\r\n                    label: options.text.label,\r\n                    description: options.text.description,\r\n                    name: 'text'\r\n                });\r\n            }\r\n            var url =  this.settings.dataUrl;\r\n            url = typeof url === 'function' ? url() : url;\r\n\r\n            this.autoComplete = new mw.autoComplete({\r\n                element: treeEl,\r\n                titleDecorator: function (title, data) {\r\n                    var type = data.subtype === 'static' ? 'page' : data.subtype;\r\n                    return '<span class=\" tip '+mw.IconClassResolver(data.subtype)+'\" data-tip=\"' + type + '\"></span>' + title;\r\n                },\r\n                ajaxConfig: {\r\n                    method: 'post',\r\n                    url: url,\r\n                    data: {\r\n                        limit: '5',\r\n                        keyword: '${val}',\r\n                        order_by: 'updated_at desc',\r\n                        search_in_fields: 'title',\r\n                    }\r\n                }\r\n            });\r\n\r\n\r\n            var label = mw.controlFields._label({\r\n                content: options.url.label\r\n            });\r\n\r\n            setTimeout(function (){\r\n                mw.element(treeEl).before(label);\r\n            }, 10)\r\n\r\n            if (options.target) {\r\n                _target = mw.controlFields.checkbox({\r\n                    label: options.target.label,\r\n                    name: 'target'\r\n                });\r\n            }\r\n\r\n\r\n            var holder = document.createElement('div');\r\n            holder.append(_linkText);\r\n            holder.append(treeEl);\r\n            holder.append(_target);\r\n\r\n\r\n            var textField = holder.querySelector('[name=\"text\"]');\r\n            var targetField = holder.querySelector('[name=\"target\"]');\r\n\r\n            this.valid = function () {\r\n                var res = this.isValid();\r\n                footer.ok.disabled = !res;\r\n                return res;\r\n            };\r\n\r\n            this.isValid = function () {\r\n                if(textField && !textField.value) {\r\n                    return false;\r\n                }\r\n                return true;\r\n            };\r\n\r\n            var footer = UIFormControllers.footer();\r\n\r\n            this.getValue = function () {\r\n                var val = {};\r\n                if(textField) val.text = textField.value;\r\n                var getSelected = this.autoComplete.selected[0];\r\n                val.url = getSelected ? getSelected.url : '';\r\n                val.data = getSelected;\r\n                if(targetField) val.target = targetField.checked;\r\n                return val;\r\n            };\r\n\r\n            this.setValue = function (val) {\r\n                val = val || {};\r\n                if(textField) textField.value = val.text || '';\r\n                if(targetField) targetField.checked = !!val.target;\r\n                return val;\r\n            };\r\n\r\n            this._onChange = [];\r\n            this.onChange = function (c) {\r\n                this._onChange.push(c);\r\n            };\r\n\r\n            this._confirm = [];\r\n            this.onConfirm = function (c) {\r\n                this._confirm.push(c);\r\n            };\r\n\r\n            this._cancel = [];\r\n            this.onCancel = function (c) {\r\n                this._cancel.push(c);\r\n            };\r\n\r\n            $(this.autoComplete).on(\"change\", function(e){\r\n                if(scope.valid()) {\r\n                    scope._onChange.forEach(function (f){\r\n                        f(scope.getValue());\r\n                    });\r\n                }\r\n            });\r\n            mw.emitter.on([textField, targetField], 'input', function (e){\r\n                if(scope.valid()) {\r\n                    scope._onChange.forEach(function (f){\r\n                        f(scope.getValue());\r\n                    });\r\n                }\r\n            });\r\n\r\n            mw.emitter.on(footer.ok, 'click', function (e){\r\n                scope._confirm.forEach(function (f){\r\n                    f(scope.getValue());\r\n                });\r\n            });\r\n\r\n            mw.emitter.on(footer.cancel, 'click', function (e){\r\n                scope._cancel.forEach(function (f){\r\n                    f();\r\n                });\r\n            });\r\n\r\n            root.append(holder);\r\n\r\n            root.append(footer.root);\r\n\r\n            this.valid();\r\n\r\n            this.root = root;\r\n        },\r\n        page: function (options) {\r\n            var scope = this;\r\n             var defaults = {\r\n                text: {\r\n                    label: mw.lang('Link text'),\r\n                    description: mw.lang('Selected text for the link.'),\r\n                },\r\n                target: {\r\n                    label: mw.lang('Open the link in a new window')\r\n                },\r\n                icon: 'mdi mdi-file-link-outline',\r\n                title: 'My website',\r\n                dataUrl: function () {\r\n                    try {\r\n                        return mw.top().settings.api_url + 'content/get_admin_js_tree_json';\r\n                    } catch (e) {\r\n                        return null;\r\n                    }\r\n                }\r\n            };\r\n            options =  mw.object.extend(true, {}, defaults, (options || {}));\r\n            this.settings = options;\r\n            if (options.text === true) options.text = defaults.text;\r\n            if (options.target === true) options.target = defaults.target;\r\n\r\n            var root = document.createElement('div');\r\n            root.className = 'mw-ui-form-controller-root';\r\n            var _linkText = '', _linkUrl = '', _target = '';\r\n            UIFormControllers._title(this.settings, root)\r\n            var treeEl = document.createElement('div');\r\n            treeEl.className = 'form-group';\r\n            if (options.text) {\r\n                _linkText = mw.controlFields.field({\r\n                    label: options.text.label,\r\n                    description: options.text.description,\r\n                    name: 'text'\r\n                });\r\n                setTimeout(function (){\r\n                     _linkText.querySelector('input').addEventListener('keyup', function (){\r\n                        scope.shouldChange = false;\r\n                    })\r\n                    _linkText.querySelector('input').addEventListener('paste', function (){\r\n                        scope.shouldChange = false;\r\n                    })\r\n                }, 78)\r\n            }\r\n            var url = typeof this.settings.dataUrl === 'function' ? this.settings.dataUrl() : this.settings.dataUrl;\r\n            mw.require('tree.js');\r\n            scope.shouldChange = !_linkText.querySelector('input').value.trim();\r\n            $.getJSON(url, function (res){\r\n\r\n                scope.tree = new mw.tree({\r\n                    data: res,\r\n                    element: treeEl,\r\n                    sortable: false,\r\n                    selectable: true,\r\n                    singleSelect: true\r\n                });\r\n                var dialog = mw.dialog.get(treeEl);\r\n                if(dialog) {\r\n                    dialog.center();\r\n                }\r\n                scope.tree.on(\"selectionChange\", function(selection){\r\n\r\n                    if (textField && selection && selection[0] && scope.shouldChange) {\r\n                        textField.value = selection[0].title;\r\n                    }\r\n                    if(scope.valid()) {\r\n                        scope._onChange.forEach(function (f){\r\n                            f(scope.getValue());\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n\r\n            if (options.target) {\r\n                _target = mw.controlFields.checkbox({\r\n                    label: options.target.label,\r\n                    name: 'target'\r\n                });\r\n            }\r\n\r\n\r\n            var holder = document.createElement('div');\r\n            holder.append(_linkText);\r\n            holder.append(treeEl);\r\n            holder.append(_target);\r\n\r\n\r\n            var textField = holder.querySelector('[name=\"text\"]');\r\n            var targetField = holder.querySelector('[name=\"target\"]');\r\n\r\n            this.valid = function () {\r\n                var res = this.isValid();\r\n                footer.ok.disabled = !res;\r\n                return res;\r\n            };\r\n\r\n            this.isValid = function () {\r\n                if(textField && !textField.value) {\r\n                    return false;\r\n                }\r\n                return true;\r\n            };\r\n\r\n            var footer = UIFormControllers.footer();\r\n\r\n            this.getValue = function () {\r\n                var val = {};\r\n                if(textField) val.text = textField.value;\r\n                var getSelected = this.tree.getSelected()[0];\r\n                val.url = getSelected ? getSelected.url : '';\r\n                val.data = getSelected;\r\n                if(targetField) val.target = targetField.checked;\r\n                return val;\r\n            };\r\n\r\n            this.setValue = function (val) {\r\n                val = val || {};\r\n                if(textField) textField.value = val.text || '';\r\n                if(targetField) targetField.checked = val.target;\r\n                return val;\r\n            };\r\n\r\n            this._onChange = [];\r\n            this.onChange = function (c) {\r\n                this._onChange.push(c);\r\n            };\r\n\r\n            this._confirm = [];\r\n            this.onConfirm = function (c) {\r\n                this._confirm.push(c);\r\n            };\r\n\r\n            this._cancel = [];\r\n            this.onCancel = function (c) {\r\n                this._cancel.push(c);\r\n            };\r\n\r\n            mw.emitter.on([textField, targetField], 'input', function (e){\r\n                if(scope.valid()) {\r\n                    scope._onChange.forEach(function (f){\r\n                        f(scope.getValue());\r\n                    });\r\n                }\r\n            });\r\n\r\n            mw.emitter.on(footer.ok, 'click', function (e){\r\n                scope._confirm.forEach(function (f){\r\n                    f(scope.getValue());\r\n                });\r\n            });\r\n\r\n            mw.emitter.on(footer.cancel, 'click', function (e){\r\n                scope._cancel.forEach(function (f){\r\n                    f();\r\n                });\r\n            });\r\n\r\n            root.append(holder);\r\n\r\n            root.append(footer.root);\r\n\r\n            this.valid();\r\n\r\n            this.root = root;\r\n        },\r\n        file: function (options) {\r\n            var scope = this;\r\n            var defaults = {\r\n                text: {\r\n                    label: mw.lang('Link text'),\r\n                    description: mw.lang('Selected text for the link.'),\r\n                },\r\n\r\n                target: {\r\n                    label: mw.lang('Open the link in a new window')\r\n                },\r\n                icon: 'mdi mdi-paperclip',\r\n                title: 'File',\r\n                dataUrl: function () {\r\n                    try {\r\n                        return mw.settings.api_url + 'content/get_admin_js_tree_json';\r\n                    } catch (e) {\r\n                        return null;\r\n                    }\r\n                }\r\n            };\r\n            options =  mw.object.extend(true, {}, defaults, (options || {}));\r\n             this.settings = options;\r\n            if (options.text === true) options.text = defaults.text;\r\n            if (options.target === true) options.target = defaults.target;\r\n\r\n            var root = document.createElement('div');\r\n            root.className = 'mw-ui-form-controller-root';\r\n            var _linkText = '', _linkUrl = '', _target = '';\r\n            UIFormControllers._title(this.settings, root)\r\n            var treeEl = document.createElement('div');\r\n            treeEl.className = 'form-group';\r\n            if (options.text) {\r\n                _linkText = mw.controlFields.field({\r\n                    label: options.text.label,\r\n                    description: options.text.description,\r\n                    name: 'text'\r\n                });\r\n            }\r\n             var url =  this.settings.dataUrl;\r\n            url = typeof url === 'function' ? url() : url;\r\n             scope.filepicker = new mw.filePicker({\r\n\r\n                element: treeEl,\r\n                nav: 'tabs',\r\n                label: false\r\n            });\r\n            treeEl.append(mw.controlFields._label({content: 'Select file'}))\r\n            if (options.target) {\r\n                _target = mw.controlFields.checkbox({\r\n                    label: options.target.label,\r\n                    name: 'target'\r\n                });\r\n            }\r\n\r\n\r\n            var holder = document.createElement('div');\r\n            holder.append(_linkText);\r\n            holder.append(treeEl);\r\n            holder.append(_target);\r\n\r\n\r\n            var textField = holder.querySelector('[name=\"text\"]');\r\n            var targetField = holder.querySelector('[name=\"target\"]');\r\n\r\n            this.valid = function () {\r\n                var res = this.isValid();\r\n                footer.ok.disabled = !res;\r\n                return res;\r\n            };\r\n\r\n            this.isValid = function () {\r\n                if(textField && !textField.value) {\r\n                    return false;\r\n                }\r\n                return !!this.filepicker.getValue();\r\n            };\r\n\r\n            var footer = UIFormControllers.footer();\r\n\r\n            this.getValue = function () {\r\n                var val = {};\r\n                if(textField) val.text = textField.value;\r\n                var url = this.filepicker.getValue();\r\n                val.url = typeof url === 'object' ? (url.src || url.url) : url;\r\n                val.data = (url.src || url.url || null);\r\n                if(targetField) val.target = targetField.checked;\r\n                return val;\r\n            };\r\n\r\n            this.setValue = function (val) {\r\n                val = val || {};\r\n                if(textField) textField.value = val.text || '';\r\n                if(targetField) targetField.checked = !!val.target;\r\n                return val;\r\n            };\r\n\r\n            this._onChange = [];\r\n            this.onChange = function (c) {\r\n                this._onChange.push(c);\r\n            };\r\n\r\n            this._confirm = [];\r\n            this.onConfirm = function (c) {\r\n                this._confirm.push(c);\r\n            };\r\n\r\n            this._cancel = [];\r\n            this.onCancel = function (c) {\r\n                this._cancel.push(c);\r\n            };\r\n\r\n\r\n\r\n            $(this.filepicker).on('Result', function (e, res) {\r\n                if(scope.valid()) {\r\n                    scope._onChange.forEach(function (f){\r\n                        f(scope.getValue());\r\n                    });\r\n                }\r\n            });\r\n            mw.emitter.on([textField, targetField], 'input', function (e){\r\n                if(scope.valid()) {\r\n                    scope._onChange.forEach(function (f){\r\n                        f(scope.getValue());\r\n                    });\r\n                }\r\n            });\r\n\r\n            mw.emitter.on(footer.ok, 'click', function (e){\r\n                scope._confirm.forEach(function (f){\r\n                    f(scope.getValue());\r\n                });\r\n            });\r\n\r\n            mw.emitter.on(footer.cancel, 'click', function (e){\r\n                scope._cancel.forEach(function (f){\r\n                    f();\r\n                });\r\n            });\r\n\r\n            root.append(holder);\r\n\r\n            root.append(footer.root);\r\n\r\n            this.valid();\r\n\r\n            this.root = root;\r\n        },\r\n\r\n        url: function (options) {\r\n            var scope = this;\r\n            var defaults = {\r\n                text: {\r\n                    label: mw.lang('Link text'),\r\n                    description: mw.lang('Selected text for the link.'),\r\n                },\r\n                link: {\r\n                    label: mw.lang('Website URL'),\r\n                    description: mw.lang('Type the website URL to link it'),\r\n                    placeholder: \"http://\",\r\n                },\r\n                target: {\r\n                    label: mw.lang('Open the link in a new window')\r\n                },\r\n                icon: 'mdi mdi-web',\r\n                title: 'URL'\r\n            };\r\n            options =  mw.object.extend(true, {}, defaults, (options || {}));\r\n            this.settings = options;\r\n            if (options.text === true) options.text = defaults.text;\r\n            if (options.link === true) options.link = defaults.link;\r\n            if (options.target === true) options.target = defaults.target;\r\n\r\n            var root = document.createElement('div');\r\n            root.className = 'mw-ui-form-controller-root';\r\n            var _linkText = '', _linkUrl = '', _target = '';\r\n            UIFormControllers._title(this.settings, root)\r\n            if (options.text) {\r\n                _linkText = mw.controlFields.field({\r\n                    label: options.text.label,\r\n                    description: options.text.description,\r\n                    name: 'text'\r\n                });\r\n            }\r\n            if (options.link) {\r\n                _linkUrl = mw.controlFields.field({\r\n                    label: options.link.label,\r\n                    description: options.link.description,\r\n                    placeholder: options.link.placeholder,\r\n                    name: 'url'\r\n                });\r\n            }\r\n\r\n            if (options.target) {\r\n                _target = mw.controlFields.checkbox({\r\n                    label: options.target.label,\r\n                    name: 'target'\r\n                });\r\n            }\r\n\r\n\r\n            var holder = document.createElement('div');\r\n            holder.append(_linkText);\r\n            holder.append(_linkUrl);\r\n            holder.append(_target);\r\n\r\n\r\n            var textField = holder.querySelector('[name=\"text\"]');\r\n            var urlField = holder.querySelector('[name=\"url\"]');\r\n            var targetField = holder.querySelector('[name=\"target\"]');\r\n\r\n            this.valid = function () {\r\n                var res = this.isValid();\r\n                footer.ok.disabled = !res;\r\n                return res;\r\n            };\r\n\r\n            this.isValid = function () {\r\n                if(textField && !textField.value) {\r\n                    return false;\r\n                }\r\n                if(urlField && !urlField.value) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            };\r\n\r\n            var footer = UIFormControllers.footer();\r\n\r\n            this.setValue = function (val) {\r\n                val = val || {};\r\n                if(textField) textField.value = val.text || '';\r\n                if(urlField) urlField.value = val.url  || '';\r\n                if(targetField) targetField.checked = val.target  ;\r\n            }\r\n            this.getValue = function () {\r\n                var val = {};\r\n                if(textField) val.text = textField.value;\r\n                if(urlField) val.url = urlField.value;\r\n                if(targetField) val.target = targetField.checked;\r\n                return val;\r\n            };\r\n\r\n            this._onChange = [];\r\n            this.onChange = function (c) {\r\n                this._onChange.push(c);\r\n            };\r\n\r\n            this._confirm = [];\r\n            this.onConfirm = function (c) {\r\n                this._confirm.push(c);\r\n            };\r\n\r\n            this._cancel = [];\r\n            this.onCancel = function (c) {\r\n                this._cancel.push(c);\r\n            };\r\n\r\n\r\n            mw.emitter.on([textField, urlField, targetField], 'input', function (e){\r\n                if(scope.valid()) {\r\n                    scope._onChange.forEach(function (f){\r\n                        f(scope.getValue());\r\n                    });\r\n                }\r\n            });\r\n\r\n            mw.emitter.on(footer.ok, 'click', function (e){\r\n                scope._confirm.forEach(function (f){\r\n                    f(scope.getValue());\r\n                });\r\n            });\r\n\r\n            mw.emitter.on(footer.cancel, 'click', function (e){\r\n                scope._cancel.forEach(function (f){\r\n                    f();\r\n                });\r\n            });\r\n\r\n            root.append(holder);\r\n\r\n            root.append(footer.root);\r\n\r\n            this.valid();\r\n\r\n            this.root = root;\r\n        }\r\n    };\r\n\r\n    mw.UIFormControllers = UIFormControllers;\r\n})();\r\n","\r\nmw.require('widgets.css');\r\n \r\n\r\n    mw.LinkEditor = function(options) {\r\n\r\n        var scope = this;\r\n        var defaults = {\r\n            mode: 'dialog',\r\n            controllers: [\r\n                { type: 'url'},\r\n                { type: 'page' },\r\n                { type: 'post' },\r\n                { type: 'file' },\r\n                { type: 'email' },\r\n                { type: 'layout' },\r\n                /*{ type: 'title' },*/\r\n            ],\r\n            title: '<i class=\"mdi mdi-link mw-link-editor-icon\"></i> ' + mw.lang('Link Settings'),\r\n            nav: 'tabs'\r\n        };\r\n\r\n        this._confirm = [];\r\n        this.onConfirm = function (c) {\r\n            this._confirm.push(c);\r\n        };\r\n\r\n        this._cancel = [];\r\n        this.onCancel = function (c) {\r\n            this._cancel.push(c);\r\n        };\r\n\r\n        this.setValue = function (data, controller) {\r\n            controller = controller || 'auto';\r\n\r\n            if(controller === 'auto') {\r\n                this.controllers.forEach(function (item){\r\n                    item.controller.setValue(data);\r\n                });\r\n            } else {\r\n                this.controllers.find(function (item){\r\n                    return item.type === controller;\r\n                }).controller.setValue(data);\r\n            }\r\n\r\n            return this;\r\n        };\r\n\r\n        this.settings =  mw.object.extend({}, defaults, options || {});\r\n\r\n\r\n        this.buildNavigation = function (){\r\n            if(this.settings.nav === 'tabs') {\r\n                this.nav = document.createElement('nav');\r\n                 this.nav.className = 'mw-ac-editor-nav';\r\n\r\n                var nav = scope.controllers.slice(0, 4);\r\n                var dropdown = scope.controllers.slice(4);\r\n\r\n                var handleSelect = function (__for, target) {\r\n                    [].forEach.call(scope.nav.children, function (item){item.classList.remove('active');});\r\n                    scope.controllers.forEach(function (item){item.controller.root.classList.remove('active');});\r\n                    if(target && target.classList) {\r\n                        target.classList.add('active');\r\n                    }\r\n                    __for.controller.root.classList.add('active');\r\n                    if(scope.dialog) {\r\n                        scope.dialog.center();\r\n                    }\r\n                };\r\n\r\n                var createA = function (ctrl, index) {\r\n                    var a =  document.createElement('a');\r\n                    a.className = 'mw-ui-btn-tab' + (index === 0 ? ' active' : '');\r\n                    a.innerHTML = ('<i class=\"'+ctrl.controller.settings.icon+'\"></i> '+ctrl.controller.settings.title);\r\n                    a.__for = ctrl;\r\n                    a.onclick = function (){\r\n                        handleSelect(this.__for, this);\r\n                    };\r\n                    return a;\r\n                };\r\n\r\n\r\n                nav.forEach(function (ctrl, index){\r\n                    scope.nav.appendChild(createA(ctrl, index));\r\n                });\r\n                this.nav.children[0].click();\r\n                this.root.prepend(this.nav);\r\n\r\n                if(dropdown.length) {\r\n                    var dropdownElBtn =  document.createElement('div');\r\n                    var dropdownEl =  document.createElement('div');\r\n                      dropdownElBtn.className = 'mw-ui-btn-tab mw-link-editor-more-button';\r\n                      dropdownEl.className = 'mw-link-editor-nav-drop-box';\r\n                      dropdownEl.style.display = 'none';\r\n\r\n                    dropdownElBtn.innerHTML = mw.lang('More') + '<i class=\"mdi mdi-chevron-down\"></i>';\r\n                    dropdown.forEach(function (ctrl, index){\r\n\r\n                        mw.element(dropdownEl)\r\n                            .append(mw.element({\r\n                                tag: 'span',\r\n                                props: {\r\n                                    className: '',\r\n                                    __for: ctrl,\r\n                                    innerHTML: ('<i class=\"'+ctrl.controller.settings.icon+'\"></i> '+ctrl.controller.settings.title),\r\n                                    onclick: function () {\r\n                                         handleSelect(this.__for);\r\n                                        mw.element(dropdownEl).hide();\r\n                                    }\r\n                                }\r\n                            }));\r\n                    });\r\n                    this.nav.append(dropdownEl);\r\n                    this.nav.append(dropdownElBtn);\r\n                    dropdownElBtn.onclick = function (){\r\n                        mw.element(dropdownEl).toggle();\r\n                    };\r\n\r\n                    dropdownEl.onchange = function () {\r\n                        handleSelect(this.options[this.selectedIndex].__for);\r\n                    };\r\n                    /*setTimeout(function (){\r\n                        if($.fn.selectpicker) {\r\n                            $('.selectpicker').selectpicker();\r\n                        }\r\n                    }, 100)*/\r\n                }\r\n            }\r\n\r\n        };\r\n\r\n        this.buildControllers = function (){\r\n            this.controllers = [];\r\n            this.settings.controllers.forEach(function (item) {\r\n                if(mw.UIFormControllers[item.type]) {\r\n                    var ctrl = new mw.UIFormControllers[item.type](item.config);\r\n                    scope.root.appendChild(ctrl.root);\r\n                    scope.controllers.push({\r\n                        type: item.type,\r\n                        controller: ctrl\r\n                    });\r\n                    ctrl.onConfirm(function (data){\r\n                        scope._confirm.forEach(function (f){\r\n                            f(data);\r\n                        });\r\n                    });\r\n                    ctrl.onCancel(function (){\r\n                        scope._cancel.forEach(function (f){\r\n                            f();\r\n                        });\r\n                    });\r\n                }\r\n\r\n            });\r\n        };\r\n        this.build = function (){\r\n            this.root = document.createElement('div');\r\n            this.root.onclick = function (e) {\r\n                var le2 = mw.tools.firstParentOrCurrentWithAnyOfClasses(e.target, ['mw-link-editor-nav-drop-box', 'mw-link-editor-more-button']);\r\n                if(!le2) {\r\n                    mw.element('.mw-link-editor-nav-drop-box').hide();\r\n                }\r\n            };\r\n\r\n            this.root.className = 'mw-link-editor-root mw-link-editor-root-inIframe-' + (window.self !== window.top )\r\n            this.buildControllers ();\r\n            if(this.settings.mode === 'dialog') {\r\n                this.dialog = mw.top().dialog({\r\n                    content: this.root,\r\n                    height: 'auto',\r\n                    title: this.settings.title,\r\n                    overflowMode: 'visible',\r\n                    shadow: false\r\n                });\r\n                this.dialog.center();\r\n                this.onConfirm(function (){\r\n                    scope.dialog.remove();\r\n                });\r\n                this.onCancel(function (){\r\n                    scope.dialog.remove();\r\n                });\r\n            } else if(this.settings.mode === 'element') {\r\n                this.settings.element.append(this.root);\r\n            }\r\n        };\r\n        this.init = function(options) {\r\n            this.build();\r\n            this.buildNavigation();\r\n        };\r\n        this.init();\r\n        this.promise = function () {\r\n            return new Promise(function (resolve){\r\n                scope.onConfirm(function (data){\r\n                    resolve(data);\r\n                });\r\n                scope.onCancel(function (){\r\n                    resolve();\r\n                });\r\n            });\r\n        };\r\n    };\r\n\r\n\r\n","\r\n\r\nmw.coreIcons = {\r\n    category:'mw-icon-category',\r\n    page:'mw-icon-page',\r\n    home:'mw-icon-home',\r\n    shop:'mai-market2',\r\n    post:'mai-post'\r\n};\r\n\r\n\r\nmw.tags = mw.chips = function(options){\r\n\r\n    \"use strict\";\r\n\r\n    options.element = mw.$(options.element)[0];\r\n    options.size = options.size || 'sm';\r\n\r\n    this.options = options;\r\n    this.options.map = this.options.map || {\r\n        title: 'title',\r\n        value: 'id',\r\n        image: 'image',\r\n        icon: 'icon'\r\n    };\r\n    this.map = this.options.map;\r\n    var scope = this;\r\n    /*\r\n        data: [\r\n            {title:'Some tag', icon:'<i class=\"icon\"></i>'},\r\n            {title:'Some tag', icon:'icon', image:'http://some-image/jpg.png'},\r\n            {title:'Some tag', color:'warn'},\r\n        ]\r\n    */\r\n\r\n\r\n    this.refresh = function(){\r\n        mw.$(scope.options.element).empty();\r\n        this.rend();\r\n    };\r\n\r\n    this.setData = function(data){\r\n        this.options.data = data;\r\n        this.refresh();\r\n    };\r\n    this.rend = function(){\r\n        $.each(this.options.data, function(i){\r\n            var data = $.extend({index:i}, this);\r\n            scope.options.element.appendChild(scope.tag(data));\r\n        });\r\n        if(this.options.inputField) {\r\n            scope.options.element.appendChild(this.addInputField());\r\n        }\r\n    };\r\n\r\n    this.addInputField = function () {\r\n        this._field = document.createElement('input');\r\n        this._field.className = 'mw-ui-invisible-field mw-ui-field-' + this.options.size;\r\n\r\n        this._field.onkeydown = function (e) {\r\n            var val = scope._field.value.trim();\r\n            if(mw.event.is.enter(e) || mw.event.is.comma(e)) {\r\n                e.preventDefault();\r\n\r\n                if(val) {\r\n                    scope.addTag({\r\n                        title: val\r\n                    });\r\n                }\r\n            } else if (mw.event.is.backSpace(e)) {\r\n                if(!val) {\r\n                    var last = scope.options.data[scope.options.data.length - 1];\r\n                    scope.removeTag(scope.options.data.length - 1);\r\n                    scope._field.value = scope.dataTitle(last) + ' ';\r\n                    scope._field.focus();\r\n\r\n                }\r\n            }\r\n            scope.handleAutocomplete(val, e)\r\n\r\n\r\n        };\r\n        return this._field;\r\n    };\r\n    this.handleAutocomplete = function (val, e) {\r\n        if(this.options.autocomplete){\r\n\r\n\r\n\r\n        }\r\n    };\r\n\r\n\r\n\r\n    this.dataValue = function(data){\r\n        if(typeof data === 'string'){\r\n            return data;\r\n        }\r\n        else{\r\n            return data[this.map.value]\r\n        }\r\n    };\r\n\r\n    this.dataImage = function(data){\r\n        if(data[this.map.image]){\r\n            var img = document.createElement('span');\r\n            img.className = 'mw-ui-btn-img';\r\n            img.style.backgroundImage = 'url('+data.image+')';\r\n            return img;\r\n        }\r\n    };\r\n\r\n    this.dataTitle = function(data){\r\n        if(typeof data === 'string'){\r\n            return data;\r\n        }\r\n        else{\r\n            return data[this.map.title];\r\n        }\r\n    };\r\n\r\n    this.dataIcon = function(data){\r\n        if(typeof data === 'string'){\r\n            return;\r\n        }\r\n        else{\r\n            return data[this.map.icon]\r\n        }\r\n    };\r\n\r\n\r\n     this.createImage = function (config) {\r\n         var img = this.dataImage(config);\r\n        if(img){\r\n            return img;\r\n        }\r\n     };\r\n     this.createIcon = function (config) {\r\n        var ic = this.dataIcon(config);\r\n\r\n        if(!ic && config.type){\r\n            ic = mw.coreIcons[config.type];\r\n\r\n        }\r\n        var icon;\r\n        if(typeof ic === 'string' && ic.indexOf('<') === -1){\r\n            icon = document.createElement('i');\r\n            icon.className = ic;\r\n        }\r\n        else{\r\n            icon = ic;\r\n        }\r\n\r\n        return mw.$(icon)[0];\r\n     };\r\n\r\n     this.removeTag = function (index) {\r\n        var item = this.options.data[index];\r\n        this.options.data.splice(index,1);\r\n        this.refresh();\r\n        mw.$(scope).trigger('tagRemoved', [item, this.options.data]);\r\n        mw.$(scope).trigger('change', [item, this.options.data]);\r\n     };\r\n\r\n\r\n\r\n\r\n\r\n\r\n     this.unique = function () {\r\n        var first = this.options.data[0];\r\n        if(!first) return;\r\n        var id = this.options.map.value;\r\n        if(!first[id]) {\r\n            id = this.options.map.title;\r\n        }\r\n        var i = 0, curr = first;\r\n        var _findIndex = function (tag) {\r\n            var tagId = isNaN(tag[id]) ? tag[id].toLowerCase() : tag[id];\r\n            var currId = isNaN(curr[id]) ? curr[id].toLowerCase() : curr[id];\r\n            return tagId == currId;\r\n        };\r\n        while (curr) {\r\n            if (this.options.data.findIndex(_findIndex) === i) {\r\n                i++;\r\n            } else {\r\n                this.options.data.splice(i, 1);\r\n            }\r\n            curr = this.options.data[i];\r\n        }\r\n     };\r\n\r\n    this.addTag = function(data, index){\r\n        index = typeof index === 'number' ? index : this.options.data.length;\r\n        this.options.data.splice( index, 0, data );\r\n        this.unique();\r\n        this.refresh();\r\n        if (this._field) {\r\n            this._field.focus();\r\n        }\r\n\r\n        mw.$(scope).trigger('tagAdded', [data, this.options.data]);\r\n        mw.$(scope).trigger('change', [data, this.options.data]);\r\n    };\r\n\r\n     this.tag = function (options) {\r\n            var config = {\r\n                close:true,\r\n                tagBtnClass:'btn btn-' + this.options.size\r\n            };\r\n\r\n            $.extend(config, options);\r\n\r\n         config.tagBtnClass +=  ' mb-2 mr-2 btn';\r\n\r\n         if (this.options.outline){\r\n             config.tagBtnClass +=  '-outline';\r\n         }\r\n\r\n         if (this.options.color){\r\n             config.tagBtnClass +=  '-' + this.options.color;\r\n         }\r\n\r\n\r\n\r\n         if(this.options.rounded){\r\n             config.tagBtnClass +=  ' btn-rounded';\r\n         }\r\n\r\n\r\n            var tag_holder = document.createElement('span');\r\n            var tag_close = document.createElement('span');\r\n\r\n            tag_close._index = config.index;\r\n            tag_holder._index = config.index;\r\n            tag_holder._config = config;\r\n            tag_holder.dataset.index = config.index;\r\n\r\n            tag_holder.className = config.tagBtnClass;\r\n\r\n             if(options.image){\r\n\r\n             }\r\n\r\n            tag_holder.innerHTML = '<span class=\"tag-label-content\">' + this.dataTitle(config) + '</span>';\r\n\r\n             if(typeof this.options.disableItem === 'function') {\r\n                 if(this.options.disableItem(config)){\r\n                     tag_holder.className += ' disabled';\r\n                 }\r\n             }\r\n             if(typeof this.options.hideItem === 'function') {\r\n                 if(this.options.hideItem(config)){\r\n                     tag_holder.className += ' hidden';\r\n                 }\r\n             }\r\n\r\n            var icon = this.createIcon(config);\r\n\r\n            var image = this.createImage(config);\r\n\r\n             if(image){\r\n                 mw.$(tag_holder).prepend(image);\r\n             }\r\n             if(icon){\r\n                 mw.$(tag_holder).prepend(icon);\r\n             }\r\n\r\n\r\n            tag_holder.onclick = function (e) {\r\n                if(e.target !== tag_close){\r\n                    mw.$(scope).trigger('tagClick', [this._config, this._index, this])\r\n                }\r\n            };\r\n\r\n            tag_close.className = 'mw-icon-close ml-1';\r\n            if(config.close){\r\n                tag_close.onclick = function () {\r\n                    scope.removeTag(this._index);\r\n                };\r\n            }\r\n            tag_holder.appendChild(tag_close);\r\n            return tag_holder;\r\n        };\r\n\r\n     this.init = function () {\r\n         this.rend();\r\n         $(this.options.element).on('click', function (e) {\r\n             if(e.target === scope.options.element){\r\n                 $('input', this).focus();\r\n             }\r\n         })\r\n     };\r\n    this.init();\r\n};\r\n\r\nmw.treeTags = mw.treeChips = function(options){\r\n    this.options = options;\r\n    this.options.on = this.options.on || {};\r\n    var scope = this;\r\n\r\n    var tagsHolder = options.tagsHolder || mw.$('<div class=\"mw-tree-tag-tags-holder\"></div>');\r\n    var treeHolder = options.treeHolder || mw.$('<div class=\"mw-tree-tag-tree-holder\"></div>');\r\n\r\n    var treeSettings = $.extend({}, this.options, {element:treeHolder});\r\n    var tagsSettings = $.extend({}, this.options, {element:tagsHolder, data:this.options.selectedData || []});\r\n\r\n    this.tree = new mw.tree(treeSettings);\r\n\r\n    this.tags = new mw.tags(tagsSettings);\r\n\r\n    mw.$( this.options.element ).append(tagsHolder);\r\n    mw.$( this.options.element ).append(treeHolder);\r\n\r\n     mw.$(this.tags).on('tagRemoved', function(event, item){\r\n         scope.tree.unselect(item);\r\n     });\r\n     mw.$(this.tree).on('selectionChange', function(event, selectedData){\r\n        scope.tags.setData(selectedData);\r\n        if (scope.options.on.selectionChange) {\r\n            scope.options.on.selectionChange(selectedData)\r\n        }\r\n    });\r\n\r\n};\r\n","\r\n/********************************************************\r\n\r\n\r\n var myTree = new mw.tree({\r\n\r\n});\r\n\r\n\r\n ********************************************************/\r\n\r\n\r\n\r\n\r\n(function(){\r\n\r\n\r\n\r\n\r\n    var mwtree = function(config){\r\n\r\n        var scope = this;\r\n\r\n        this.config = function(config){\r\n\r\n            window.mwtree = (typeof window.mwtree === 'undefined' ? 0 : window.mwtree)+1;\r\n\r\n            if(!config.id && typeof config.saveState === undefined){\r\n                config.saveState = false;\r\n            }\r\n\r\n            var defaults = {\r\n                data:[],\r\n                openedClass:'opened',\r\n                selectedClass:'selected',\r\n                skin:'default',\r\n                multiPageSelect:true,\r\n                saveState:true,\r\n                stateStorage: {\r\n                    get: function (id) {\r\n                        return mw.storage.get( id);\r\n                    },\r\n                    set: function (id, dataToSave) {\r\n                        mw.storage.set(id, dataToSave);\r\n                    }\r\n                },\r\n                sortable:false,\r\n                nestedSortable:false,\r\n                singleSelect:false,\r\n                selectedData:[],\r\n                skip:[],\r\n                contextMenu:false,\r\n                append:false,\r\n                prepend:false,\r\n                selectable:false,\r\n                filter:false,\r\n                cantSelectTypes: [],\r\n                document: document,\r\n                _tempRender: true,\r\n                filterRemoteURL: null,\r\n                filterRemoteKey: 'keyword',\r\n                toggleSelect: true\r\n            };\r\n\r\n\r\n            var options = $.extend({}, defaults, config);\r\n\r\n\r\n\r\n            options.element = mw.$(options.element)[0];\r\n            options.data = options.data || [];\r\n\r\n            this.options = options;\r\n            this.document = options.document;\r\n            this._selectionChangeDisable = false;\r\n\r\n            this.stateStorage = this.options.stateStorage;\r\n\r\n            if(this.options.selectedData){\r\n                this.selectedData = this.options.selectedData;\r\n            }\r\n            else{\r\n                this.selectedData = [];\r\n            }\r\n        };\r\n        this.filterLocal = function(val, key){\r\n            key = key || 'title';\r\n            val = (val || '').toLowerCase().trim();\r\n            if(!val){\r\n                scope.showAll();\r\n            }\r\n            else{\r\n                scope.options.data.forEach(function(item){\r\n                    if(item[key].toLowerCase().indexOf(val) === -1){\r\n                        scope.hide(item);\r\n                    }\r\n                    else{\r\n                        scope.show(item);\r\n                    }\r\n                });\r\n            }\r\n        };\r\n\r\n        this._filterRemoteTime = null;\r\n        this.filterRemote = function(val, key){\r\n            clearTimeout(this._filterRemoteTime);\r\n            this._filterRemoteTime = setTimeout(function () {\r\n                key = key || 'title';\r\n                val = (val || '').toLowerCase().trim();\r\n                var ts = {};\r\n                ts[scope.options.filterRemoteKey] = val;\r\n                $.get(scope.options.filterRemoteURL, ts, function (data) {\r\n                    scope.setData(data);\r\n                });\r\n            }, 777);\r\n        };\r\n\r\n        this.filter = function(val, key){\r\n            if (!!this.options.filterRemoteURL && !!this.options.filterRemoteKey) {\r\n                this.filterRemote(val, key);\r\n            } else {\r\n                this.filterLocal(val, key);\r\n            }\r\n        };\r\n\r\n        var _e = {};\r\n\r\n        this.on = function (e, f) { _e[e] ? _e[e].push(f) : (_e[e] = [f]) };\r\n        this.dispatch = function (e, f) { _e[e] ? _e[e].forEach(function (c){ c.call(this, f); }) : ''; };\r\n\r\n        this.search = function(){\r\n            this._seachInput = mw.$(this.options.searchInput);\r\n            if(!this._seachInput[0] || this._seachInput[0]._tree) return;\r\n            this._seachInput[0]._tree = this;\r\n            var scope = this;\r\n            this._seachInput.on('input', function(){\r\n                scope.filter(this.value);\r\n            });\r\n        };\r\n        this.skip = function(itemData){\r\n            if(this.options.skip && this.options.skip.length>0){\r\n                for( var n=0; n<scope.options.skip.length; n++ ){\r\n                    var item = scope.options.skip[n];\r\n                    var case1 = (item.id == itemData.id && item.type == itemData.type);\r\n                    var case2 = (itemData.parent_id == item.id && item.type == itemData.type);\r\n                    if(case1 ||case2){\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            }\r\n        };\r\n        this.prepareData = function(){\r\n            if(typeof this.options.filter === 'object'){\r\n                var final = [], scope = this;\r\n                for( var i in this.options.filter){\r\n                    $.each(this.options.data, function(){\r\n                        if(this[i] && this[i] == scope.options.filter[i]){\r\n                            final.push(this);\r\n                        }\r\n                    });\r\n                }\r\n                this.options.data = final;\r\n            }\r\n        };\r\n\r\n\r\n        this._postCreated = [];\r\n\r\n        this.json2ul = function(){\r\n            this.list = scope.document.createElement( 'ul' );\r\n            this.list._tree = this;\r\n            this.options.id = this.options.id || ( 'mw-tree-' + window.mwtree );\r\n            this.list.id = this.options.id;\r\n            this.list.className = 'mw-defaults mw-tree-nav mw-tree-nav-skin-' + this.options.skin;\r\n            this.list._id = 0;\r\n            this.options.data.forEach(function(item){\r\n                var list = scope.getParent(item);\r\n                if(list){\r\n                    var li = scope.createItem(item);\r\n                    if(li){\r\n                        list.appendChild(li);\r\n                    }\r\n                }\r\n                else if(typeof list === 'undefined'){\r\n                    scope._postCreated.push(item);\r\n                }\r\n            });\r\n            if(this.options._tempRender) {\r\n                this.tempRend();\r\n            }\r\n        };\r\n\r\n\r\n\r\n        this._tempPrepare = function () {\r\n            for (var i=0; i<this._postCreated.length; i++) {\r\n                var it = this._postCreated[i];\r\n                if(it.parent_id !== 0) {\r\n                    var has = this.options.data.find(function (a) {\r\n                        return a.id ==  it.parent_id; // 1 == '1'\r\n                    });\r\n                    if(!has) {\r\n                        it.parent_id = 0;\r\n                        it.parent_type = \"page\";\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        this.tempRend = function () {\r\n            this._tempPrepare()\r\n            var curr = scope._postCreated[0];\r\n            var max = 10000, itr = 0;\r\n\r\n            while(scope._postCreated.length && itr<max){\r\n                itr++;\r\n                var index = scope._postCreated.indexOf(curr);\r\n                var selector = '#' + scope.options.id + '-' + curr.type + '-'  + curr.id;\r\n                var lastc = selector.charAt(selector.length - 1);\r\n                if( lastc === '.' || lastc === '#') {\r\n                    selector = selector.substring(0, selector.length - 1);\r\n                }\r\n                var it = mw.$(selector)[0];\r\n                if(it){\r\n                    scope._postCreated.splice(index, 1);\r\n                    curr = scope._postCreated[0];\r\n                    continue;\r\n                }\r\n                var list = scope.getParent(curr);\r\n\r\n                if(list && !$(selector)[0]){\r\n                    var li = scope.createItem(curr);\r\n                    if(li){\r\n                        list.appendChild(li);\r\n                    }\r\n                    scope._postCreated.splice(index, 1);\r\n                    curr = scope._postCreated[0];\r\n                }\r\n                else if(typeof list === 'undefined'){\r\n                    curr = scope._postCreated[index+1] || scope._postCreated[0];\r\n                }\r\n            }\r\n\r\n        };\r\n\r\n        function triggerChange() {\r\n            if(!this._selectionChangeDisable) {\r\n                mw.$(scope).trigger('selectionChange', [scope.selectedData]);\r\n                scope.dispatch('selectionChange', scope.selectedData)\r\n            }\r\n        }\r\n\r\n        this.setData = function(newData){\r\n            this.options.data = newData;\r\n            this._postCreated = [];\r\n            this._ids = [];\r\n            this.init();\r\n        };\r\n\r\n        this.saveState = function(){\r\n            if(!this.options.saveState) return;\r\n            var data = [];\r\n            mw.$( 'li.' + this.options.openedClass, this.list  ).each(function(){\r\n                if(this._data) {\r\n                    data.push({type:this._data.type, id:this._data.id});\r\n                }\r\n            });\r\n\r\n            this.stateStorage.set(this.options.id, data);\r\n        };\r\n\r\n        this.restoreState = function(){\r\n            if(!this.options.saveState) return;\r\n            var data = this.stateStorage.get(this.options.id);\r\n            if(!data) return;\r\n            try{\r\n                $.each(data, function(){\r\n                    if(typeof this.id === 'string'){\r\n                        this.id = parseInt(this.id, 10);\r\n                    }\r\n                    scope.open(this.id, this.type);\r\n                });\r\n            }\r\n            catch(e){ }\r\n        };\r\n\r\n        this.manageUnselected = function(){\r\n            mw.$('input:not(:checked)', this.list).each(function(){\r\n                var li = scope.parentLi(this);\r\n                mw.$(li).removeClass(scope.options.selectedClass)\r\n            });\r\n        };\r\n\r\n        this.analizeLi = function(li){\r\n            if(typeof li === 'string'){\r\n                li = decodeURIComponent(li).trim();\r\n                if(/^\\d+$/.test(li)){\r\n                    li = parseInt(li, 10);\r\n                }\r\n                else{\r\n                    return mw.$(li)[0];\r\n                }\r\n            }\r\n            return li;\r\n        };\r\n\r\n        this.select = function(li, type){\r\n            if(Array.isArray(li)){\r\n                $.each(li, function(){\r\n                    scope.select(this);\r\n                });\r\n                return;\r\n            }\r\n            li = this.get(li, type);\r\n            if(li && this.options.cantSelectTypes.indexOf(li.dataset.type) === -1){\r\n                li.classList.add(this.options.selectedClass);\r\n                var input = li.querySelector('input');\r\n                if(input) input.checked = true;\r\n            }\r\n\r\n            this.manageUnselected();\r\n            this.getSelected();\r\n            triggerChange();\r\n        };\r\n\r\n\r\n\r\n        this.unselect = function(li, type){\r\n            if(Array.isArray(li)){\r\n                $.each(li, function(){\r\n                    scope.unselect(this);\r\n                });\r\n                return;\r\n            }\r\n            li = this.get(li, type);\r\n            if(li){\r\n                li.classList.remove(this.options.selectedClass);\r\n                var input = li.querySelector('input');\r\n                if(input) input.checked = false;\r\n            }\r\n            this.manageUnselected();\r\n            this.getSelected();\r\n            triggerChange();\r\n        };\r\n\r\n        this.get = function(li, type){\r\n            if(typeof li === 'undefined') return false;\r\n            if(li === null) return false;\r\n            if(li.nodeType) return li;\r\n            li = this.analizeLi(li);\r\n            if(typeof li === 'object' && typeof li.id !== 'undefined'){\r\n                return this.get(li.id, li.type);\r\n            }\r\n            if(typeof li === 'object' && li.constructor === Number){\r\n                li = parseInt(li);\r\n            }\r\n            if(typeof li === 'number'){\r\n                if(!type) return;\r\n                return this.list.querySelector('li[data-type=\"'+type+'\"][data-id=\"'+li+'\"]');\r\n            }\r\n            if(typeof li === 'string' && /^\\d+$/.test(li)){\r\n                if(!type) return;\r\n                return this.list.querySelector('li[data-type=\"'+type+'\"][data-id=\"'+li+'\"]');\r\n            }\r\n            return li;\r\n        };\r\n\r\n        this.isSelected = function(li, type){\r\n            li = this.get(li, type);\r\n            if(!li) return;\r\n            var input = li.querySelector('input');\r\n            if(!input) return false;\r\n            return input.checked === true;\r\n        };\r\n        this.toggleSelect = function(li, type){\r\n            if(this.isSelected(li, type)){\r\n                this.unselect(li, type)\r\n            }\r\n            else{\r\n                this.select(li, type)\r\n            }\r\n        };\r\n\r\n        this.selectAll = function(){\r\n            this._selectionChangeDisable = true;\r\n            this.select(this.options.data);\r\n            this._selectionChangeDisable = false;\r\n            triggerChange();\r\n        };\r\n\r\n        this.unselectAll = function(){\r\n            this._selectionChangeDisable = true;\r\n            this.unselect(this.selectedData);\r\n            this._selectionChangeDisable = false;\r\n            triggerChange();\r\n        };\r\n\r\n        this.open = function(li, type, _skipsave){\r\n            if(Array.isArray(li)){\r\n                $.each(li, function(){\r\n                    scope.open(this);\r\n                });\r\n                return;\r\n            }\r\n            li = this.get(li, type);\r\n            if(!li) return;\r\n            li.classList.add(this.options.openedClass);\r\n            if(!_skipsave) this.saveState();\r\n        };\r\n        this.show = function(li, type){\r\n            if(Array.isArray(li)){\r\n                $.each(li, function(){\r\n                    scope.show(this);\r\n                });\r\n                return;\r\n            }\r\n            li = this.get(li, type);\r\n            if(!li) return;\r\n            li.classList.remove('mw-tree-item-hidden');\r\n            mw.$(li).parents(\".mw-tree-item-hidden\").removeClass('mw-tree-item-hidden').each(function(){\r\n                scope.open(this);\r\n            });\r\n        };\r\n\r\n        this.showAll = function(){\r\n            mw.$(this.list.querySelectorAll('li')).removeClass('mw-tree-item-hidden');\r\n        };\r\n\r\n        this.hide = function(li, type){\r\n            if(Array.isArray(li)){\r\n                $.each(li, function(){\r\n                    scope.hide(this);\r\n                });\r\n                return;\r\n            }\r\n            li = this.get(li, type);\r\n            if(!li) return;\r\n            li.classList.add('mw-tree-item-hidden');\r\n        };\r\n\r\n        this.hideAll = function(){\r\n            mw.$(this.list.querySelectorAll('li')).addClass('mw-tree-item-hidden');\r\n        };\r\n\r\n        this.close = function(li,type, _skipsave){\r\n            if(Array.isArray(li)){\r\n                $.each(li, function(){\r\n                    scope.close(this);\r\n                });\r\n                return;\r\n            }\r\n            li = this.get(li, type);\r\n            if(!li) return;\r\n            li.classList.remove(this.options.openedClass);\r\n            if(!_skipsave) this.saveState();\r\n        };\r\n\r\n        this.toggle = function(li, type){\r\n            li = this.get(li, type);\r\n            if(!li) return;\r\n            li.classList.toggle(this.options.openedClass);\r\n            this.saveState();\r\n        };\r\n\r\n        this.openAll = function(){\r\n            var all = this.list.querySelectorAll('li');\r\n            mw.$(all).each(function(){\r\n                scope.open(this, undefined, true);\r\n            });\r\n            this.saveState();\r\n        };\r\n\r\n        this.closeAll = function(){\r\n            var all = this.list.querySelectorAll('li.'+this.options.openedClass);\r\n            mw.$(all).each(function(){\r\n                scope.close(this, undefined, true);\r\n            });\r\n            this.saveState();\r\n        };\r\n\r\n        this.button = function(){\r\n            var btn = scope.document.createElement('mwbutton');\r\n            btn.className = 'mw-tree-toggler';\r\n            btn.onclick = function(){\r\n                scope.toggle(mw.tools.firstParentWithTag(this, 'li'));\r\n            };\r\n            return btn;\r\n        };\r\n\r\n        this.addButtons = function(){\r\n            var all = this.list.querySelectorAll('li ul.pre-init'), i=0;\r\n            for( ; i<all.length; i++ ){\r\n                var ul = all[i];\r\n                ul.classList.remove('pre-init');\r\n                mw.$(ul).parent().children('.mw-tree-item-content-root').prepend(this.button());\r\n            }\r\n        };\r\n\r\n        this.checkBox = function(element){\r\n            if(this.options.cantSelectTypes.indexOf(element.dataset.type) !== -1){\r\n                return scope.document.createTextNode('');\r\n            }\r\n            var itype = 'radio';\r\n            if(this.options.singleSelect){\r\n\r\n            }\r\n            else if(this.options.multiPageSelect || element._data.type !== 'page'){\r\n                itype = 'checkbox';\r\n            }\r\n            var label = scope.document.createElement('tree-label');\r\n            var input = scope.document.createElement('input');\r\n            var span = scope.document.createElement('span');\r\n            input.type = itype;\r\n            input._data = element._data;\r\n            input.value = element._data.id;\r\n            input.name = this.list.id;\r\n            label.className = 'mw-ui-check';\r\n\r\n            label.appendChild(input);\r\n\r\n\r\n            label.appendChild(span);\r\n\r\n            /*input.onchange = function(){\r\n                var li = scope.parentLi(this);\r\n                mw.$(li)[this.checked?'addClass':'removeClass'](scope.options.selectedClass)\r\n                var data = scope.getSelected();\r\n                scope.manageUnselected()\r\n                mw.$(scope).trigger('change', [data]);\r\n            }*/\r\n            return label;\r\n        };\r\n\r\n        this.parentLi = function(scope){\r\n            if(!scope) return;\r\n            if(scope.nodeName === 'LI'){\r\n                return scope;\r\n            }\r\n            while(scope.parentNode){\r\n                scope = scope.parentNode;\r\n                if(scope.nodeName === 'LI'){\r\n                    return scope;\r\n                }\r\n            }\r\n        };\r\n\r\n        this.getSelected = function(){\r\n            var selected = [];\r\n            var all = this.list.querySelectorAll('li.selected');\r\n            mw.$(all).each(function(){\r\n                if(this._data) selected.push(this._data);\r\n            });\r\n            this.selectedData = selected;\r\n            this.options.selectedData = selected;\r\n            return selected;\r\n        };\r\n\r\n        this.decorate = function(element){\r\n            if(this.options.selectable){\r\n                mw.$(element.querySelector('.mw-tree-item-content')).prepend(this.checkBox(element))\r\n            }\r\n\r\n            element.querySelector('.mw-tree-item-content').appendChild(this.contextMenu(element));\r\n\r\n            if(this.options.sortable){\r\n                this.sortable();\r\n            }\r\n            if(this.options.nestedSortable){\r\n                this.nestedSortable();\r\n            }\r\n\r\n        };\r\n\r\n        this.sortable = function(element){\r\n            var items = mw.$(this.list);\r\n            mw.$('ul', this.list).each(function () {\r\n                items.push(this);\r\n            });\r\n            items.sortable({\r\n                items: \".type-category, .type-page\",\r\n                axis:'y',\r\n                listType:'ul',\r\n                handle:'.mw-tree-item-title',\r\n                update:function(e, ui){\r\n                    setTimeout(function(){\r\n                        var old = $.extend({},ui.item[0]._data);\r\n                        var obj = ui.item[0]._data;\r\n                        var objParent = ui.item[0].parentNode.parentNode._data;\r\n                        ui.item[0].dataset.parent_id = objParent ? objParent.id : 0;\r\n\r\n                        obj.parent_id = objParent ? objParent.id : 0;\r\n                        obj.parent_type = objParent ? objParent.id : 'page';\r\n                        var newdata = [];\r\n                        mw.$('li', scope.list).each(function(){\r\n                            if(this._data) newdata.push(this._data)\r\n                        });\r\n                        scope.options.data = newdata;\r\n                        var local = [];\r\n                        mw.$(ui.item[0].parentNode).children('li').each(function(){\r\n                            if(this._data) {\r\n                                local.push(this._data.id);\r\n                            }\r\n                        });\r\n                        //$(scope.list).remove();\r\n                        //scope.init();\r\n                        mw.$(scope).trigger('orderChange', [obj, scope.options.data, old, local])\r\n                    }, 110);\r\n\r\n                }\r\n            });\r\n        };\r\n        this.nestedSortable = function(element){\r\n            mw.$('ul', this.list).nestedSortable({\r\n                items: \".type-category\",\r\n                listType:'ul',\r\n                handle:'.mw-tree-item-title',\r\n                update:function(e, ui){\r\n\r\n                }\r\n            })\r\n        };\r\n\r\n        this.contextMenu = function(element){\r\n            var menu = scope.document.createElement('span');\r\n            menu.className = 'mw-tree-context-menu';\r\n            if(this.options.contextMenu){\r\n                $.each(this.options.contextMenu, function(){\r\n                    var menuitem = scope.document.createElement('span');\r\n                    var icon = scope.document.createElement('span');\r\n                    menuitem.title = this.title;\r\n                    menuitem.className = 'mw-tree-context-menu-item';\r\n                    icon.className = this.icon;\r\n                    menuitem.appendChild(icon);\r\n                    menu.appendChild(menuitem);\r\n                    (function(menuitem, element, obj){\r\n                        menuitem.onclick = function(){\r\n                            if(obj.action){\r\n                                obj.action.call(element, element, element._data, menuitem)\r\n                            }\r\n                        }\r\n                    })(menuitem, element, this);\r\n                });\r\n            }\r\n            return menu\r\n\r\n        };\r\n\r\n        this.rend = function(){\r\n            if(this.options.element){\r\n                var el = mw.$(this.options.element);\r\n                if(el.length!==0){\r\n                    el.empty().append(this.list);\r\n                }\r\n            }\r\n        };\r\n\r\n        this._ids = [];\r\n\r\n        this._createSingle = function (item) {\r\n\r\n        }\r\n\r\n        this.createItem = function(item){\r\n            var selector = '#'+scope.options.id + '-' + item.type+'-'+item.id;\r\n            if(this._ids.indexOf(selector) !== -1) return false;\r\n            this._ids.push(selector);\r\n            var li = scope.document.createElement('li');\r\n            li.dataset.type = item.type;\r\n            li.dataset.id = item.id;\r\n            li.dataset.parent_id = item.parent_id;\r\n            var skip = this.skip(item);\r\n            li.className = 'type-' + item.type + ' subtype-'+ item.subtype + ' skip-' + (skip || 'none');\r\n            var container = scope.document.createElement('span');\r\n            container.className = \"mw-tree-item-content\";\r\n            container.innerHTML = '<span class=\"mw-tree-item-title\">'+item.title+'</span>';\r\n\r\n            li._data = item;\r\n            li.id = scope.options.id + '-' + item.type+'-'+item.id;\r\n            li.appendChild(container);\r\n            $(container).wrap('<span class=\"mw-tree-item-content-root\"></span>')\r\n            if(!skip){\r\n                container.onclick = function(){\r\n                    if(scope.options.selectable) {\r\n                        if(scope.options.toggleSelect) {\r\n                            scope.toggleSelect(li);\r\n                        } else {\r\n                            scope.select(li);\r\n                        }\r\n                    }\r\n                };\r\n                this.decorate(li);\r\n            }\r\n\r\n\r\n            return li;\r\n        };\r\n\r\n\r\n\r\n        this.additional = function (obj) {\r\n            var li = scope.document.createElement('li');\r\n            li.className = 'mw-tree-additional-item';\r\n            var container = scope.document.createElement('span');\r\n            var containerTitle = scope.document.createElement('span');\r\n            container.className = \"mw-tree-item-content\";\r\n            containerTitle.className = \"mw-tree-item-title\";\r\n            container.appendChild(containerTitle);\r\n\r\n            li.appendChild(container);\r\n            $(container).wrap('<span class=\"mw-tree-item-content-root\"></span>')\r\n            if(obj.icon){\r\n                if(obj.icon.indexOf('</') === -1){\r\n                    var icon = scope.document.createElement('span');\r\n                    icon.className = 'mw-tree-aditional-item-icon ' + obj.icon;\r\n                    containerTitle.appendChild(icon);\r\n                }\r\n                else{\r\n                    mw.$(containerTitle).append(obj.icon)\r\n                }\r\n\r\n            }\r\n            var title = scope.document.createElement('span');\r\n            title.innerHTML = obj.title;\r\n            containerTitle.appendChild(title);\r\n            li.onclick = function (ev) {\r\n                if(obj.action){\r\n                    obj.action.call(this, obj)\r\n                }\r\n            };\r\n            return li;\r\n        }\r\n\r\n        this.createList = function(item){\r\n            var nlist = scope.document.createElement('ul');\r\n            nlist.dataset.type = item.parent_type;\r\n            nlist.dataset.id = item.parent_id;\r\n            nlist.className = 'pre-init';\r\n            return nlist;\r\n        };\r\n\r\n        this.getParent = function(item, isTemp){\r\n            if(!item.parent_id) return this.list;\r\n            var findul = this.list.querySelector('ul[data-type=\"'+item.parent_type+'\"][data-id=\"'+item.parent_id+'\"]');\r\n            var findli = this.list.querySelector('li[data-type=\"'+item.parent_type+'\"][data-id=\"'+item.parent_id+'\"]');\r\n            if(findul){\r\n                return findul;\r\n            }\r\n            else if(findli){\r\n                var nlistwrap = this.createItem(item);\r\n                if(!nlistwrap) return false;\r\n                var nlist = this.createList(item);\r\n                nlist.appendChild(nlistwrap);\r\n                findli.appendChild(nlist);\r\n                return false;\r\n            }\r\n        };\r\n\r\n        this.append = function(){\r\n            if(this.options.append){\r\n                $.each(this.options.append, function(){\r\n                    scope.list.appendChild(scope.additional(this))\r\n                })\r\n            }\r\n        };\r\n\r\n        this.prepend = function(){\r\n            if(this.options.prepend){\r\n                $.each(this.options.append, function(){\r\n                    mw.$(scope.list).prepend(scope.additional(this))\r\n                })\r\n            }\r\n        };\r\n\r\n        this.addHelperClasses = function(root, level){\r\n            level = (level || 0) + 1;\r\n            root = root || this.list;\r\n            mw.$( root.children ).addClass('level-'+level).each(function(){\r\n                var ch = this.querySelector('ul');\r\n                if(ch){\r\n                    mw.$(this).addClass('has-children')\r\n                    scope.addHelperClasses(ch, level);\r\n                }\r\n            })\r\n        };\r\n\r\n        this.loadSelected = function(){\r\n            if(this.selectedData){\r\n                scope.select(this.selectedData);\r\n            }\r\n        };\r\n        this.init = function(){\r\n\r\n            this.prepareData();\r\n            this.json2ul();\r\n            this.addButtons();\r\n            this.rend();\r\n            this.append();\r\n            this.prepend();\r\n            this.addHelperClasses();\r\n            this.restoreState();\r\n            this.loadSelected();\r\n            this.search();\r\n            setTimeout(function(){\r\n                mw.$(scope).trigger('ready');\r\n            }, 78)\r\n        };\r\n\r\n        this.config(config);\r\n        this.init();\r\n    };\r\n    mw.tree = mwtree;\r\n    mw.tree.get = function (a) {\r\n        a = mw.$(a)[0];\r\n        if(!a) return;\r\n        if(mw.tools.hasClass(a, 'mw-tree-nav')){\r\n            return a._tree;\r\n        }\r\n        var child = a.querySelector('.mw-tree-nav');\r\n        if(child) return child._tree;\r\n        var parent = mw.tools.firstParentWithClass(a, 'mw-tree-nav');\r\n\r\n        if(parent) {\r\n            return parent._tree;\r\n        }\r\n    }\r\n\r\n\r\n})();\r\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC7SA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACvGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AChTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC3OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACzLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACzoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACpIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC/cA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACtFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACtMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACzQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACvKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACltCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC3MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACpUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}