(()=>{"use strict";if(window.self!==window.top){mw.require("liveedit.css"),mw.require("moveable.js"),mw.lib.require("tinymce"),mw.liveEditSaveService={grammarlyFix:function(e){return mw.$("grammarly-btn",e).remove(),mw.$("grammarly-card",e).remove(),mw.$("g.gr_",e).each((function(){mw.$(this).replaceWith(this.innerHTML)})),mw.$("[data-gramm_id]",e).removeAttr("data-gramm_id"),mw.$("[data-gramm]",e).removeAttr("data-gramm"),mw.$("[data-gramm_id]",e).removeAttr("data-gramm_id"),mw.$("grammarly-card",e).remove(),mw.$("grammarly-inline-cards",e).remove(),mw.$("grammarly-popups",e).remove(),mw.$("grammarly-extension",e).remove(),e},saving:!1,coreSave:function(e){if(!e)return!1;$.each(e,(function(){var e=mw.tools.parseHtml(this.html).body;mw.liveEditSaveService.grammarlyFix(e),mw.liveEditSaveService.animationsClearFix(e),this.html=e.innerHTML})),mw.liveEditSaveService.saving=!0,e.from_url=window.location.href,void 0!==mw.liveEditIframeData&&(void 0!==mw.liveEditIframeData.content_link&&(e.from_url=mw.liveEditIframeData.content_link),void 0!==mw.liveEditIframeData.multiLanguageCurrentLanguage&&(e.lang=mw.liveEditIframeData.multiLanguageCurrentLanguage)),e=JSON.stringify(e),e={data_base64:e=btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))};var t=$.ajax({type:"POST",url:mw.settings.api_url+"save_edit",data:e,dataType:"json",success:function(e){e&&e.new_page_url&&!mw.liveEditSaveService.DraftSaving&&(window.mw.parent().askusertostay=!1,window.mw.askusertostay=!1,window.location.href=e.new_page_url)}});return t.always((function(){mw.liveEditSaveService.saving=!1})),t},parseContent:function(e){e=e||document.body;var t,a=mw.tools.parseHtml(e.innerHTML);mw.$(".element-current",a).removeClass("element-current"),mw.$(".mce-content-body",a).removeClass("mce-content-body"),mw.$(".mce-content-focus",a).removeClass("mce-content-focus"),mw.$(".element-active",a).removeClass("element-active"),mw.$(".disable-resize",a).removeClass("disable-resize"),mw.$(".mw-module-drag-clone",a).removeClass("mw-module-drag-clone"),mw.$(".ui-draggable",a).removeClass("ui-draggable"),mw.$(".ui-draggable-handle",a).removeClass("ui-draggable-handle"),mw.$(".mt-ready",a).removeClass("mt-ready"),mw.$(".mw-webkit-drag-hover-binded",a).removeClass("mw-webkit-drag-hover-binded"),mw.$(".module-cat-toggle-Modules",a).removeClass("module-cat-toggle-Modules"),mw.$(".mw-module-drag-clone",a).removeClass("mw-module-drag-clone"),mw.$(".mce-edit-focus",a).removeClass("mce-edit-focus"),mw.$(".mce-edit-body",a).removeClass("mce-edit-body"),mw.$("[data-mce-style]",a).removeAttr("data-mce-style"),mw.$("[mce-content-body]",a).removeAttr("mce-content-body"),mw.$("[data-mce-style]",a).removeAttr("data-mce-style"),mw.$("[data-mce-selected]",a).removeAttr("data-mce-selected"),mw.$("[data-mce-href]",a).removeAttr("data-mce-href"),mw.$("-module",a).removeClass("-module"),mw.$(".empty-element",a).remove(),mw.$(".empty-element",a).remove(),mw.$("[data-mce-bogus]",a).remove(),mw.$(".edit .ui-resizable-handle",a).remove(),mw.$("script",a).remove(),mw.$(".moveable-control-box",a).remove(),mw.tools.classNamespaceDelete("all","ui-",a,"starts"),mw.$("[contenteditable]",a).removeAttr("contenteditable");for(var n=(t=a.querySelectorAll("[contenteditable]")).length,o=0;o<n;o++)t[o].removeAttribute("contenteditable");for(n=(t=a.querySelectorAll(".module")).length,o=0;o<n;o++)null===t[o].querySelector(".edit")&&(t[o].innerHTML="");return a},htmlAttrValidate:function(e){var t=[];return $.each(e,(function(){var e=this.outerHTML;e=(e=(e=(e=(e=e.replace(/url\(&quot;/g,"url('")).replace(/jpg&quot;/g,"jpg'")).replace(/jpeg&quot;/g,"jpeg'")).replace(/png&quot;/g,"png'")).replace(/gif&quot;/g,"gif'"),t.push($(e)[0])})),t},cleanUnwantedTags:function(e){return mw.$(".mw-skip-and-remove,script",e).remove(),e},animationsClearFix:function(e){return mw.$('[class*="animate__"]').each((function(){mw.tools.classNamespaceDelete(this,"animate__")})),e},collectData:function(e){mw.$(e).each((function(){mw.$("meta",this).remove(),$(".mw-le-spacer",this).empty().removeAttr("data-resizable").removeAttr("style")}));var t=(e=this.htmlAttrValidate(e)).length,a=0,n={},o={};if(t>0)for(;a<t;a++)if(n.item=e[a],mw.tools.mwattr(n.item,"rel")||(mw.$(n.item).removeClass("changed"),mw.tools.foreachParents(n.item,(function(e){var t=this.className,a=mw.tools.mwattr(this,"rel");mw.tools.hasClass(t,"edit")&&mw.tools.hasClass(t,"changed")&&a&&(n.item=this,mw.tools.stopLoop(e))}))),mw.tools.mwattr(n.item,"rel")){mw.$(n.item).removeClass("changed orig_changed"),mw.$(n.item).removeClass("module-over"),mw.$(".mw-le-ghost-layout",n.item).remove(),mw.$("#mw-non-existing-temp-element-holder",n.item).remove(),mw.$(".module-over",n.item).each((function(){mw.$(this).removeClass("module-over")})),mw.$(".element[data-mwplaceholder]",n.item).each((function(){!this.innerHTML.trim()||mw.$(this).removeAttr("data-mwplaceholder")})),mw.$(".element.lipsum",n.item).each((function(){mw.$(this).removeClass("lipsum")})),mw.$("[data-mw-live-edithover]",n.item).each((function(){mw.$(this).removeAttr("data-mw-live-edithover")})),mw.$("[data-mw-temp-option-save]",n.item).each((function(){mw.$(this).removeAttr("data-mw-temp-option-save")})),mw.$("[class]",n.item).each((function(){var e=this.getAttribute("class");"string"==typeof e&&(e=e.trim()),e||this.removeAttribute("class")}));var r=mw.liveEditSaveService.cleanUnwantedTags(n.item).innerHTML,i={},m=n.item.attributes;if(m.length>0)for(var l=0,s=m.length;l<s;l++)i[m[l].nodeName]=m[l].nodeValue;var d={attributes:i,html:r};o["field_data_"+a]=d}else{var c=n.item.id?"#"+n.item.id:"";console.warn("Skipped save: .edit"+c+" element does not have rel attribute.")}return o},getData:function(e){var t=mw.liveEditSaveService.parseContent(e).body.querySelectorAll(".edit.changed");return mw.liveEditSaveService.collectData(t)},saveDisabled:!1,draftDisabled:!1,save:function(e,t,a){if(mw.trigger("beforeSaveStart",e),mw.top().app&&mw.top().app&&mw.top().app.cssEditor&&mw.top().app.cssEditor.publishIfChanged(),mw.top().app&&mw.top().app&&mw.top().options&&mw.top().options.publishTempOptions(document),mw.liveEditSaveService.saveDisabled)return!1;if(!e){var n=mw.liveEditSaveService.parseContent().body.querySelectorAll(".edit.changed");e=mw.liveEditSaveService.collectData(n)}var o=(mw.__pageAnimations||[]).filter((function(e){return"none"!==e.animation}));if(o&&o.length>0){var r={group:"template",key:"animations-global",value:JSON.stringify(o)};mw.top().options.saveOption(r)}if(mw.tools.isEmptyObject(e))return t&&t.call({}),!1;mw.trigger("saveStart",e);var i=mw.liveEditSaveService.coreSave(e);return console.log(i,i.fail),!!i&&(i.fail((function(e){403==i.status&&(mw.dialog({id:"save_content_error_iframe_modal",html:"<iframe id='save_content_error_iframe' style='overflow-x:hidden;overflow-y:auto;' class='mw-modal-frame' ></iframe>",width:$(window).width()-90,height:$(window).height()-90}),mw.askusertostay=!1,mw.$("#save_content_error_iframe").ready((function(){var e=document.getElementById("save_content_error_iframe").contentWindow.document;e.open(),e.write(i.responseText),e.close();var t=0;e=document.getElementById("save_content_error_iframe").contentWindow.document,mw.$("#save_content_error_iframe").load((function(){var a=mw.$(".challenge-form",e).length;t++,a&&2==t&&setTimeout((function(){mw.askusertostay=!1,mw.$("#save_content_error_iframe_modal").remove()}),150)}))}))),a&&a.call(e)})),i.done((function(e){mw.$(".edit.changed").removeClass("changed"),mw.$(".orig_changed").removeClass("orig_changed"),null!==document.querySelector(".edit.changed")?mw.liveEditSaveService.save():(mw.askusertostay=!1,mw.trigger("saveEnd",e)),t&&t.call(e)})),i.fail((function(e,t,n){mw.trigger("saveFailed",t,n),a&&a.call(sdata)})),i)}},mw.saveLiveEdit=async()=>new Promise((e=>{mw.liveEditSaveService.save(void 0,(()=>e(!0)),(()=>e(!1)))})),mw.top().app.save=async()=>await mw.saveLiveEdit(),addEventListener("load",(()=>{window.addEventListener("keydown",(function(e){mw.top().app.canvas.dispatch("iframeKeyDown",{event:e})})),mw.$("span.mw-powered-by").on("click",(function(e){return mw.top().tools.open_global_module_settings_modal("white_label/admin","mw-powered-by"),!1})),function(){function e(e){const t=!e.innerHTML.trim();t&&e.innerHTML.trim()===e.textContent.trim()||e.classList[t?"add":"remove"]("mw-le-empty-element")}document.querySelectorAll(".edit").forEach((function(t){t.__$$_handleEmptyEditFields||(t.__$$_handleEmptyEditFields=!0,e(t),t.addEventListener("input",(function(){e(this)})))})),mw.top().app.on("editChanged",(t=>{setTimeout((()=>e(t)))}))}()}));let e=null;mw.top().app.isNavigating=()=>!!e&&e.returnValue&&!0===e.defaultPrevented,self.onbeforeunload=function(t){e=t;var a=self;if(a.mw.isNavigating=!0,"function"==typeof mw.top&&mw.top().app.canvas&&mw.top().app.canvas.dispatch("liveEditCanvasBeforeUnload"),setTimeout((function(e){e&&e&&e.mw&&(e.mw.isNavigating=!1)}),1,a),a&&a.mw&&a.mw.askusertostay)return!0;if("function"==typeof mw.top&&mw.top().app.canvas){var n=mw.top().app.canvas.getFrame();n&&n.parentElement&&mw.top().spinner({element:n.parentElement,decorate:!0,size:52}).show()}},mw.drag=mw.drag||{},mw.drag.save=function(){return mw.liveEditSaveService.save()},mw.drag.fix_placeholders=function(e,t){t=t||".edit .row";var a,n="div.col-md",o=mw.top().app.templateSettings.helperClasses.external_grids_col_classes;for(a=o.length-1;a>=0;--a)n+=",div."+o[a];mw.$(t).each((function(){mw.$(this).children(n).each((function(){0==mw.$(this).children("*").length&&(mw.$(this).append('<div class="element" id="mw-element-'+mw.random()+'"></div>'),mw.$(this).children("div.element"))}))}))},mw.drag.module_settings=function(){var e=mw.top().app.liveEdit.moduleHandle.getTarget();return mw.top().app.editor.dispatch("onModuleSettingsRequest",e)},document.documentElement.addEventListener("click",(function(e){var t=e.target,a=mw.tools.firstParentOrCurrentWithTag(t,"a");if(a&&0!==a.href.indexOf("javascript:")&&!a.isContentEditable){const t=document.createElement("a");t.href=a.href,t.host===location.host||a.target&&"_self"!==a.target||(e.preventDefault(),open(a.href))}})),document.addEventListener("keydown",(function(e){if(e.ctrlKey&&83===e.keyCode)return mw.top().app.editor.dispatch("Ctrl+S",e)})),document.body.addEventListener("mouseenter",(function(e){$("body").removeClass("mw-live-body-mouse-moved-outside")})),document.body.addEventListener("mouseleave",(function(e){$("body").addClass("mw-live-body-mouse-moved-outside")}))}self===top&&window.addEventListener("load",(e=>{if(window.mwLiveEditIframeBackUrl){var t=document.createElement("a");t.id="back-to-live-sticky-button",t.textContent="Go Live Edit",t.href=window.mwLiveEditIframeBackUrl,t.classList.add("sticky"),document.body.appendChild(t),t.classList.add("sticky");var a=document.createElement("style");a.textContent="\n                    #back-to-live-sticky-button {\n                        position: fixed;\n                        left: 50%;\n                        transform: translateX(-50%);\n                        z-index: 1001;\n                        transition: top 0.3s;\n                        background: #3498db;\n                        color: #fff !important;\n                        padding: 10px 20px;\n                        border-radius: 5px;\n                        border-top-left-radius: 0;\n                        border-top-right-radius: 0;\n                        font-family: Arial, sans-serif;\n                        border: none;\n                        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n                        cursor: pointer;\n                    }\n\n                    #back-to-live-sticky-button:hover {\n                        background: #2980b9;\n                    }\n\n\n                    #back-to-live-sticky-button.sticky {\n                        top: 0;\n                    }\n\n\n\n\n            ",document.head.appendChild(a)}document.querySelectorAll('.no-select [class*="col"]').forEach((function(e){Array.from(e.children).filter((e=>e.classList.contains("element"))).length&&e.classList.add("allow-select")}))}))})();