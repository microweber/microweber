!function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){var o="object",r="function",n="undefined",c=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],d=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],M=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],k=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function f(e,t){var n=typeof e[t];return n==r||!(n!=o||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=o||!e[t])}function e(e,t){return typeof e[t]!=n}function i(o){return function(e,t){for(var n=t.length;n--;)if(!o(e,t[n]))return!1;return!0}}var u=i(f),a=i(t),l=i(e);function h(e){return e&&u(e,k)&&l(e,M)}function g(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}var s,p,m,R={},C=typeof window!=n&&typeof document!=n,v={isHostMethod:f,isHostObject:t,isHostProperty:e,areHostMethods:u,areHostObjects:a,areHostProperties:l,isTextRange:h,getBody:g,forEach:[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,o=e.length;n<o;++n)t(e[n],n)}},N={version:"1.3.1",initialized:!1,isBrowser:C,supported:!0,util:v,features:{},modules:R,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==n||rangyAutoInitialize}};function E(e){typeof console!=n&&f(console,"log")&&console.log(e)}function S(e,t){(C&&t?alert:E)(e)}function y(e){N.initialized=!0,N.supported=!1,S("Rangy is not supported in this environment. Reason: "+e,N.config.alertOnFail)}if(N.fail=y,N.warn=function(e){S("Rangy warning: "+e,N.config.alertOnWarn)},!{}.hasOwnProperty?y("hasOwnProperty not supported"):(v.extend=s=function(e,t,n){var o,r,i;for(i in t)t.hasOwnProperty(i)&&(o=e[i],r=t[i],n&&null!==o&&"object"==typeof o&&null!==r&&"object"==typeof r&&s(o,r,!0),e[i]=r);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},v.createOptions=function(e,t){var n={};return s(n,t),e&&s(n,e),n}),C||y("Rangy can only run in a browser"),C){var a=document.createElement("div"),w=(a.appendChild(document.createElement("span")),[].slice);try{1==w.call(a.childNodes,0)[0].nodeType&&(p=function(e){return w.call(e,0)})}catch(e){}}v.toArray=p=p||function(e){for(var t=[],n=0,o=e.length;n<o;++n)t[n]=e[n];return t},C&&(f(document,"addEventListener")?m=function(e,t,n){e.addEventListener(t,n,!1)}:f(document,"attachEvent")?m=function(e,t,n){e.attachEvent("on"+t,n)}:y("Document does not have required addEventListener or attachEvent method"),v.addListener=m);var T=[];function O(e){return e.message||e.description||String(e)}function _(){if(C&&!N.initialized){var e,t,n,o=!1,r=!1,i=(f(document,"createRange")&&(e=document.createRange(),u(e,d)&&l(e,c)&&(o=!0)),g(document));if(i&&"body"==i.nodeName.toLowerCase())if(i&&f(i,"createTextRange")&&h(e=i.createTextRange())&&(r=!0),o||r){for(n in N.initialized=!0,N.features={implementsDomRange:o,implementsTextRange:r},R)(t=R[n])instanceof P&&t.init(t,N);for(var a=0,s=T.length;a<s;++a)try{T[a](N)}catch(e){E("Rangy init listener threw an exception. Continuing. Detail: "+O(e))}}else y("Neither Range nor TextRange are available");else y("No body element found")}}function D(e,t,n){n&&(e+=" in module "+n.name),N.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function A(e,t,n,o){e[t]=function(){return D(t,n,o),e[n].apply(e,v.toArray(arguments))}}v.deprecationNotice=D,v.createAliasForDeprecatedMethod=A,N.init=_,N.addInitListener=function(e){N.initialized?e(N):T.push(e)};var x=[];function P(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function b(t,e,n){e=new P(t,e,function(e){if(!e.initialized){e.initialized=!0;try{n(N,e),e.supported=!0}catch(e){E("Module '"+t+"' failed to load: "+O(e)),e.stack&&E(e.stack)}}});return R[t]=e}function I(){}N.addShimListener=function(e){x.push(e)},C&&(N.shim=N.createMissingNativeApi=function(e){e=e||window,_();for(var t=0,n=x.length;t<n;++t)x[t](e)},A(N,"createMissingNativeApi","shim")),P.prototype={init:function(){for(var e,t,n=this.dependencies||[],o=0,r=n.length;o<r;++o){if(t=n[o],!((e=R[t])&&e instanceof P))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){N.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){N.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},N.createModule=function(e){var t,n=2==arguments.length?(t=arguments[1],[]):(t=arguments[2],arguments[1]),n=b(e,n,t);N.initialized&&N.supported&&n.init()},N.createCoreModule=function(e,t,n){b(e,t,n)},N.RangePrototype=I,N.rangePrototype=new I,N.selectionPrototype=new function(){},N.createCoreModule("DomUtil",[],function(e,c){function r(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1}var t="undefined",i=e.util,a=i.getBody,n=(i.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||c.fail("document missing a Node creation method"),i.isHostMethod(document,"getElementsByTagName")||c.fail("document missing getElementsByTagName method"),document.createElement("div")),n=(i.areHostMethods(n,["insertBefore","appendChild","cloneNode"])||c.fail("Incomplete Element implementation"),i.isHostProperty(n,"innerHTML")||c.fail("Element is missing innerHTML property"),document.createTextNode("test"));i.areHostMethods(n,["splitText","deleteData","insertData","appendData","cloneNode"])||c.fail("Incomplete Text Node implementation");function d(e){for(var t=0;e=e.previousSibling;)++t;return t}function f(e,t){for(var n=[],o=e;o;o=o.parentNode)n.push(o);for(o=t;o;o=o.parentNode)if(r(n,o))return o;return null}function o(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function u(e,t,n){for(var o,r=n?e:e.parentNode;r;){if((o=r.parentNode)===t)return r;r=o}return null}function s(e){e=e.nodeType;return 3==e||4==e||8==e}function l(e,t){var n=t.nextSibling,t=t.parentNode;return n?t.insertBefore(e,n):t.appendChild(e),e}function h(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=t)return e.ownerDocument;if(typeof e.document!=t)return e.document;if(e.parentNode)return h(e.parentNode);throw c.createError("getDocument: no document found for node")}function g(e){e=h(e);if(typeof e.defaultView!=t)return e.defaultView;if(typeof e.parentWindow!=t)return e.parentWindow;throw c.createError("Cannot get a window object for node")}function p(e){if(typeof e.contentDocument!=t)return e.contentDocument;if(typeof e.contentWindow!=t)return e.contentWindow.document;throw c.createError("getIframeDocument: No Document object found for iframe element")}function m(e){return e&&i.isHostMethod(e,"setTimeout")&&i.isHostObject(e,"document")}var R,C,v;function N(e){try{return e.parentNode,!1}catch(e){return!0}}function E(e){return e?R&&N(e)?"[Broken node]":s(e)?'"'+e.data+'"':1==e.nodeType?(t=e.id?' id="'+e.id+'"':"","<"+e.nodeName+t+">[index:"+d(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"):e.nodeName:"[No node]";var t}function S(e){this.root=e,this._next=e}function y(e,t){this.node=e,this.offset=t}function w(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}(n=document.createElement("b")).innerHTML="1",C=n.firstChild,n.innerHTML="<br />",R=N(C),e.features.crashyTextNodes=R,typeof window.getComputedStyle!=t?v=function(e,t){return g(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=t?v=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:c.fail("No means of obtaining computed style properties found"),S.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},y.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+E(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},(w.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24}).toString=function(){return this.message},e.dom={arrayContains:r,isHtmlNamespace:function(e){return typeof e.namespaceURI==t||null===(e=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==e},parentElement:function(e){return 1==(e=e.parentNode).nodeType?e:null},getNodeIndex:d,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:f,isAncestorOf:o,isOrIsAncestorOf:function(e,t){return o(e,t,!0)},getClosestAncestorIn:u,isCharacterDataNode:s,isTextOrCommentNode:function(e){return!!e&&(3==(e=e.nodeType)||8==e)},insertAfter:l,splitDataNode:function(e,t,n){var o=e.cloneNode(!1);if(o.deleteData(0,t),e.deleteData(t,e.length-t),l(o,e),n)for(var r,i=0;r=n[i++];)r.node==e&&r.offset>t?(r.node=o,r.offset-=t):r.node==e.parentNode&&r.offset>d(e)&&++r.offset;return o},getDocument:h,getWindow:g,getIframeWindow:function(e){if(typeof e.contentWindow!=t)return e.contentWindow;if(typeof e.contentDocument!=t)return e.contentDocument.defaultView;throw c.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:p,getBody:a,isWindow:m,getContentDocument:function(e,t,n){var o;if(e?i.isHostProperty(e,"nodeType")?o=(1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?p:h)(e):m(e)&&(o=e.document):o=document,o)return o;throw t.createError(n+"(): Parameter must be a Window object or DOM node")},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,t,n,o){var r,i,a,s;if(e==n)return t===o?0:t<o?-1:1;if(r=u(n,e,!0))return t<=d(r)?-1:1;if(r=u(e,n,!0))return d(r)<o?-1:1;if(!(t=f(e,n)))throw new Error("comparePoints error: nodes have no common ancestor");if((i=e===t?t:u(e,t,!0))===(a=n===t?t:u(n,t,!0)))throw c.createError("comparePoints got to case 4 and childA and childB are the same!");for(s=t.firstChild;s;){if(s===i)return-1;if(s===a)return 1;s=s.nextSibling}},isBrokenNode:N,inspectNode:E,getComputedStyleProperty:v,createTestElement:function(e,t,n){var o=a(e);return(e=e.createElement("div")).contentEditable=""+!!n,t&&(e.innerHTML=t),(n=o.firstChild)?o.insertBefore(e,n):o.appendChild(e),e},removeNode:function(e){return e.parentNode.removeChild(e)},fragmentFromNodeChildren:function(e){for(var t,n=h(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new S(e)},DomPosition:y},e.DOMException=w}),N.createCoreModule("DomRange",["DomUtil"],function(i,M){var s=i.dom,a=i.util,t=s.DomPosition,c=i.DOMException,f=s.isCharacterDataNode,u=s.getNodeIndex,d=s.isOrIsAncestorOf,r=s.getDocument,l=s.comparePoints,h=s.splitDataNode,g=s.getClosestAncestorIn,p=s.getNodeLength,m=s.arrayContains,R=s.getRootContainer,k=i.features.crashyTextNodes,C=s.removeNode;function v(e,t){return 3!=e.nodeType&&(d(e,t.startContainer)||d(e,t.endContainer))}function N(e){return e.document||r(e.startContainer)}function E(e){return new t(e.parentNode,u(e))}function S(e){return new t(e.parentNode,u(e)+1)}function n(e,t,n){var o=11==e.nodeType?e.firstChild:e;return f(t)?n==t.length?s.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:h(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),o}function L(e,t,n){if(x(e),x(t),N(t)!=N(e))throw new c("WRONG_DOCUMENT_ERR");var o=l(e.startContainer,e.startOffset,t.endContainer,t.endOffset),e=l(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?o<=0&&0<=e:o<0&&0<e}function y(e,t,n){var o,r,i,a;for(n=n||{stop:!1};i=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(i))return void(n.stop=!0);if(y(a=e.getSubtreeIterator(),t,n),a.detach(),n.stop)return}else for(o=s.createIterator(i);r=o.next();)if(!1===t(r))return void(n.stop=!0)}function W(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(W(t=e.getSubtreeIterator()),t.detach()):e.remove()}function F(e){for(var t,n,o=N(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(F(n)),n.detach()):e.remove(),10==t.nodeType)throw new c("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function z(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+s.inspectNode(e.startContainer)+":"+e.startOffset+", "+s.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function w(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t,e.collapsed||(this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset,t=e.commonAncestorContainer,this.sc===this.ec&&f(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==t||f(this.sc)?g(this.sc,t,!0):this.sc.childNodes[this.so],this._last=this.ec!==t||f(this.ec)?g(this.ec,t,!0):this.ec.childNodes[this.eo-1]))}w.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,f(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!f(n)||n!==this.sc&&n!==this.ec?n.parentNode&&C(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return v(this._current,this.range)},getSubtreeIterator:function(){var e,t,n,o,r,i;return this.isSingleCharacterDataNode?(e=this.range.cloneRange()).collapse(!1):(e=new H(N(this.range)),t=this._current,o=0,i=p(r=n=t),d(t,this.sc)&&(n=this.sc,o=this.so),d(t,this.ec)&&(r=this.ec,i=this.eo),B(e,n,o,r,i)),new w(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var j=[1,3,4,5,7,8,10],U=[2,9,11],V=[1,3,4,5,7,8,10,11],q=[1,3,4,5,7,8];function e(r){return function(e,t){for(var n,o=t?e:e.parentNode;o;){if(n=o.nodeType,m(r,n))return o;o=o.parentNode}return null}}var Y=e([9,11]),Q=e([5,6,10,12]),G=e([6,10,12]),X=e([1]);function T(e,t){if(G(e,t))throw new c("INVALID_NODE_TYPE_ERR")}function O(e,t){if(!m(t,e.nodeType))throw new c("INVALID_NODE_TYPE_ERR")}function _(e,t){if(t<0||t>(f(e)?e:e.childNodes).length)throw new c("INDEX_SIZE_ERR")}function D(e,t){if(Y(e,!0)!==Y(t,!0))throw new c("WRONG_DOCUMENT_ERR")}function A(e){if(Q(e,!0))throw new c("NO_MODIFICATION_ALLOWED_ERR")}function Z(e,t){if(!e)throw new c(t)}function $(e,t){return t<=(f(e)?e:e.childNodes).length}function J(e){return!!e.startContainer&&!!e.endContainer&&!(k&&(s.isBrokenNode(e.startContainer)||s.isBrokenNode(e.endContainer)))&&R(e.startContainer)==R(e.endContainer)&&$(e.startContainer,e.startOffset)&&$(e.endContainer,e.endOffset)}function x(e){if(!J(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var K=document.createElement("style"),o=!1;try{K.innerHTML="<b>x</b>",o=3==K.firstChild.nodeType}catch(e){}function ee(e,t){x(e);var n=e.startContainer,o=e.startOffset,r=e.endContainer,i=e.endOffset,a=n===r;f(r)&&0<i&&i<r.length&&h(r,i,t),f(n)&&0<o&&o<n.length&&(n=h(n,o,t),a?(i-=o,r=n):r==n.parentNode&&i>=u(n)&&i++,o=0),e.setStartAndEnd(n,o,r,i)}function te(e){x(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}i.features.htmlParsingConforms=o;var P=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],b=0,ne=1,oe=2,re=3,ie=0,ae=1,se=2,I=3;function ce(e){e.START_TO_START=b,e.START_TO_END=ne,e.END_TO_END=oe,e.END_TO_START=re,e.NODE_BEFORE=ie,e.NODE_AFTER=ae,e.NODE_BEFORE_AND_AFTER=se,e.NODE_INSIDE=I}function de(e){ce(e),ce(e.prototype)}function fe(r,i){return function(){x(this);var e=this.startContainer,t=this.startOffset,n=this.commonAncestorContainer,o=new w(this,!0),n=(e!==n&&(e=(n=S(g(e,n,!0))).node,t=n.offset),y(o,A),o.reset(),r(o));return o.detach(),i(this,e,t,e,t),n}}function ue(e,d){function t(t,n){return function(e){O(e,j),O(R(e),U);e=(t?E:S)(e);(n?o:r)(this,e.node,e.offset)}}function o(e,t,n){var o=e.endContainer,r=e.endOffset;t===e.startContainer&&n===e.startOffset||(R(t)==R(o)&&1!=l(t,n,o,r)||(o=t,r=n),d(e,t,n,o,r))}function r(e,t,n){var o=e.startContainer,r=e.startOffset;t===e.endContainer&&n===e.endOffset||(R(t)==R(o)&&-1!=l(t,n,o,r)||(o=t,r=n),d(e,o,r,t,n))}function n(){}n.prototype=i.rangePrototype,e.prototype=new n,a.extend(e.prototype,{setStart:function(e,t){T(e,!0),_(e,t),o(this,e,t)},setEnd:function(e,t){T(e,!0),_(e,t),r(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],o=t,r=n;switch(e.length){case 3:r=e[2];break;case 4:o=e[2],r=e[3]}T(t,!0),_(t,n),T(o,!0),_(o,r),d(this,t,n,o,r)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:t(!0,!0),setStartAfter:t(!1,!0),setEndBefore:t(!0,!1),setEndAfter:t(!1,!1),collapse:function(e){x(this),e?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){T(e,!0),d(this,e,0,e,p(e))},selectNode:function(e){T(e,!1),O(e,j);var t=E(e),e=S(e);d(this,t.node,t.offset,e.node,e.offset)},extractContents:fe(F,d),deleteContents:fe(W,d),canSurroundContents:function(){x(this),A(this.startContainer),A(this.endContainer);var e=new w(this,!0),t=e._first&&v(e._first,this)||e._last&&v(e._last,this);return e.detach(),!t},splitBoundaries:function(){ee(this)},splitBoundariesPreservingPositions:function(e){ee(this,e)},normalizeBoundaries:function(){x(this);function e(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(s=(a=e).length,e.appendData(t.data),C(t))}function t(e){var t,n=e.previousSibling;n&&n.nodeType==e.nodeType&&(t=(r=e).length,i=n.length,e.insertData(0,n.data),C(n),r==a?(s+=i,a=r):a==e.parentNode&&(n=u(e),s==n?(a=e,s=t):n<s&&s--))}var n,o,r=this.startContainer,i=this.startOffset,a=this.endContainer,s=this.endOffset,c=!0;f(a)?s==a.length?e(a):0==s&&(n=a.previousSibling)&&n.nodeType==a.nodeType&&(s=n.length,r==a&&(c=!1),n.appendData(a.data),C(a),a=n):(0<s&&((o=a.childNodes[s-1])&&f(o)&&e(o)),c=!this.collapsed),c?f(r)?0==i?t(r):i==r.length&&(n=r.nextSibling)&&n.nodeType==r.nodeType&&(a==n&&(s+=(a=r).length),r.appendData(n.data),C(n)):i<r.childNodes.length&&((o=r.childNodes[i])&&f(o)&&t(o)):(r=a,i=s),d(this,r,i,a,s)},collapseToPoint:function(e,t){T(e,!0),_(e,t),this.setStartAndEnd(e,t)},parentElement:function(){return x(this),this.commonAncestorContainer?X(this.commonAncestorContainer,!0):null}}),de(e)}function B(e,t,n,o,r){e.startContainer=t,e.startOffset=n,e.endContainer=o,e.endOffset=r,e.document=s.getDocument(t),(n=e).collapsed=n.startContainer===n.endContainer&&n.startOffset===n.endOffset,n.commonAncestorContainer=n.collapsed?n.startContainer:s.getCommonAncestor(n.startContainer,n.endContainer)}function H(e){B(this,e,0,e,0)}a.extend(i.rangePrototype,{compareBoundaryPoints:function(e,t){x(this),D(this.startContainer,t.startContainer);var n=e==re||e==b?"start":"end",e=e==ne||e==b?"start":"end",o=this[n+"Container"],n=this[n+"Offset"],r=t[e+"Container"],t=t[e+"Offset"];return l(o,n,r,t)},insertNode:function(e){if(x(this),O(e,V),A(this.startContainer),d(e,this.startContainer))throw new c("HIERARCHY_REQUEST_ERR");e=n(e,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){if(x(this),this.collapsed)return N(this).createDocumentFragment();if(this.startContainer===this.endContainer&&f(this.startContainer))return(t=this.startContainer.cloneNode(!0)).data=t.data.slice(this.startOffset,this.endOffset),(e=N(this).createDocumentFragment()).appendChild(t),e;var e=new w(this,!0),t=function e(t){for(var n,o,r=N(t.range).createDocumentFragment();n=t.next();){if(o=t.isPartiallySelectedSubtree(),n=n.cloneNode(!o),o&&(o=t.getSubtreeIterator(),n.appendChild(e(o)),o.detach()),10==n.nodeType)throw new c("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}(e);return e.detach(),t},canSurroundContents:function(){x(this),A(this.startContainer),A(this.endContainer);var e=new w(this,!0),t=e._first&&v(e._first,this)||e._last&&v(e._last,this);return e.detach(),!t},surroundContents:function(e){if(O(e,q),!this.canSurroundContents())throw new c("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);n(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){x(this);for(var e,t=new H(N(this)),n=P.length;n--;)t[e=P[n]]=this[e];return t},toString:function(){x(this);var t,e=this.startContainer;return e===this.endContainer&&f(e)?3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"":(t=[],y(e=new w(this,!0),function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),e.detach(),t.join(""))},compareNode:function(e){x(this);var t=e.parentNode,e=u(e);if(!t)throw new c("NOT_FOUND_ERR");var n=this.comparePoint(t,e),t=this.comparePoint(t,e+1);return n<0?0<t?se:ie:0<t?ae:I},comparePoint:function(e,t){return x(this),Z(e,"HIERARCHY_REQUEST_ERR"),D(e,this.startContainer),l(e,t,this.startContainer,this.startOffset)<0?-1:0<l(e,t,this.endContainer,this.endOffset)?1:0},createContextualFragment:o?function(e){var t=this.startContainer,n=r(t);if(!t)throw new c("INVALID_STATE_ERR");var o=null;return 1==t.nodeType?o=t:f(t)&&(o=s.parentElement(t)),(o=null===o||"HTML"==o.nodeName&&s.isHtmlNamespace(r(o).documentElement)&&s.isHtmlNamespace(o)?n.createElement("body"):o.cloneNode(!1)).innerHTML=e,s.fragmentFromNodeChildren(o)}:function(e){var t=N(this).createElement("body");return t.innerHTML=e,s.fragmentFromNodeChildren(t)},toHtml:function(){return te(this)},intersectsNode:function(e,t){if(x(this),R(e)!=R(this.startContainer))return!1;var n=e.parentNode,e=u(e);if(!n)return!0;var o=l(n,e,this.endContainer,this.endOffset),n=l(n,e+1,this.startContainer,this.startOffset);return t?o<=0&&0<=n:o<0&&0<n},isPointInRange:function(e,t){return x(this),Z(e,"HIERARCHY_REQUEST_ERR"),D(e,this.startContainer),0<=l(e,t,this.startContainer,this.startOffset)&&l(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return L(this,e,!1)},intersectsOrTouchesRange:function(e){return L(this,e,!0)},intersection:function(e){var t,n,o;return this.intersectsRange(e)?(t=l(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=l(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange(),-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o):null},union:function(e){var t;if(this.intersectsOrTouchesRange(e))return t=this.cloneRange(),-1==l(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==l(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t;throw new c("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==I},containsNodeContents:function(e){return 0<=this.comparePoint(e,0)&&this.comparePoint(e,p(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange(),n=(t.selectNode(e),t.getNodes([3]));return 0<n.length?(t.setStart(n[0],0),n=n.pop(),t.setEnd(n,n.length),this.containsRange(t)):this.containsNodeContents(e)},getNodes:function(e,t){return x(this),n=this,o=t,i=!(!(t=e)||!t.length),a=!!o,i&&(r=new RegExp("^("+t.join("|")+")$")),y(new w(n,!(s=[])),function(e){var t;i&&!r.test(e.nodeType)||a&&!o(e)||(e==(t=n.startContainer)&&f(t)&&n.startOffset==t.length||(e==(t=n.endContainer)&&f(t)&&0==n.endOffset||s.push(e)))}),s;var n,o,r,i,a,s},getDocument:function(){return N(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(e){var t=N(this),n=i.createRange(t),t=(e=e||s.getBody(t),n.selectNodeContents(e),this.intersection(n)),o=0,r=0;return t&&(n.setEnd(t.startContainer,t.startOffset),r=(o=n.toString().length)+t.toString().length),{start:o,end:r,containerNode:e}},moveToBookmark:function(e){for(var t,n,o,r,i=e.containerNode,a=0,s=(this.setStart(i,0),this.collapse(!0),[i]),c=!1,d=!1;!d&&(t=s.pop());)if(3==t.nodeType)n=a+t.length,!c&&e.start>=a&&e.start<=n&&(this.setStart(t,e.start-a),c=!0),c&&e.end>=a&&e.end<=n&&(this.setEnd(t,e.end-a),d=!0),a=n;else for(o=(r=t.childNodes).length;o--;)s.push(r[o])},getName:function(){return"DomRange"},equals:function(e){return H.rangesEqual(this,e)},isValid:function(){return J(this)},inspect:function(){return z(this)},detach:function(){}}),ue(H,B),a.extend(H,{rangeProperties:P,RangeIterator:w,copyComparisonConstants:de,createPrototypeRange:ue,inspect:z,toHtml:te,getRangeDocument:N,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),i.DomRange=H}),N.createCoreModule("WrappedRange",["DomRange"],function(n,t){var e,i,o,r,R=n.dom,a=n.util,C=R.DomPosition,s=n.DomRange,c=R.getBody,d=R.getContentDocument,v=R.isCharacterDataNode;if(n.features.implementsDomRange){var f,u=s.rangeProperties;function l(e){for(var t,n=u.length;n--;)e[t=u[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}s.createPrototypeRange(e=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,l(this)},function(e,t,n,o,r){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==o||e.endOffset!=r,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(o,r),e.setStart(t,n))}),(f=e.prototype).selectNode=function(e){this.nativeRange.selectNode(e),l(this)},f.cloneContents=function(){return this.nativeRange.cloneContents()},f.surroundContents=function(e){this.nativeRange.surroundContents(e),l(this)},f.collapse=function(e){this.nativeRange.collapse(e),l(this)},f.cloneRange=function(){return new e(this.nativeRange.cloneRange())},f.refresh=function(){l(this)},f.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test"),g=(c(document).appendChild(h),document.createRange());g.setStart(h,0),g.setEnd(h,0);try{g.setStart(h,1),f.setStart=function(e,t){this.nativeRange.setStart(e,t),l(this)},f.setEnd=function(e,t){this.nativeRange.setEnd(e,t),l(this)},p=function(t){return function(e){this.nativeRange[t](e),l(this)}}}catch(e){f.setStart=function(t,n){try{this.nativeRange.setStart(t,n)}catch(e){this.nativeRange.setEnd(t,n),this.nativeRange.setStart(t,n)}l(this)},f.setEnd=function(t,n){try{this.nativeRange.setEnd(t,n)}catch(e){this.nativeRange.setStart(t,n),this.nativeRange.setEnd(t,n)}l(this)},p=function(n,o){return function(t){try{this.nativeRange[n](t)}catch(e){this.nativeRange[o](t),this.nativeRange[n](t)}l(this)}}}f.setStartBefore=p("setStartBefore","setEndBefore"),f.setStartAfter=p("setStartAfter","setEndAfter"),f.setEndBefore=p("setEndBefore","setStartBefore"),f.setEndAfter=p("setEndAfter","setStartAfter"),f.selectNodeContents=function(e){this.setStartAndEnd(e,0,R.getNodeLength(e))},g.selectNodeContents(h),g.setEnd(h,3);var p=document.createRange();p.selectNodeContents(h),p.setEnd(h,4),p.setStart(h,2),-1==g.compareBoundaryPoints(g.START_TO_END,p)&&1==g.compareBoundaryPoints(g.END_TO_START,p)?f.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:f.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};(p=document.createElement("div")).innerHTML="123";var m=p.firstChild,N=c(document);N.appendChild(p),g.setStart(m,1),g.setEnd(m,2),g.deleteContents(),"13"==m.data&&(f.deleteContents=function(){this.nativeRange.deleteContents(),l(this)},f.extractContents=function(){var e=this.nativeRange.extractContents();return l(this),e}),N.removeChild(p),N=null,a.isHostMethod(g,"createContextualFragment")&&(f.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(h),f.getName=function(){return"WrappedRange"},n.WrappedRange=e,n.createNativeRange=function(e){return(e=d(e,t,"createNativeRange")).createRange()}}n.features.implementsTextRange&&(i=function(e,t,n,o,r){var i=e.duplicate(),a=(i.collapse(n),i.parentElement());if(!(a=R.isOrIsAncestorOf(t,a)?a:t).canHaveHTML)return{boundaryPosition:t=new C(a.parentNode,R.getNodeIndex(a)),nodeInfo:{nodeIndex:t.offset,containerElement:t.node}};var s=R.getDocument(a).createElement("span");s.parentNode&&R.removeNode(s);for(var c,d,f=n?"StartToStart":"StartToEnd",u=r&&r.containerElement==a?r.nodeIndex:0,l=a.childNodes.length,h=l,g=h;g==l?a.appendChild(s):a.insertBefore(s,a.childNodes[g]),i.moveToElementText(s),0!=(c=i.compareEndPoints(f,e))&&u!=h;){if(-1==c){if(h==u+1)break;u=g}else h=h==u+1?u:g;g=Math.floor((u+h)/2),a.removeChild(s)}if(t=s.nextSibling,-1==c&&t&&v(t)){if(i.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(t.data))for(var p=i.duplicate(),r=p.text.replace(/\r\n/g,"\r").length,m=p.moveStart("character",r);-1==(c=p.compareEndPoints("StartToEnd",p));)m++,p.moveStart("character",1);else m=i.text.length;d=new C(t,m)}else r=(o||!n)&&s.previousSibling,d=(t=(o||n)&&s.nextSibling)&&v(t)?new C(t,0):r&&v(r)?new C(r,r.data.length):new C(a,R.getNodeIndex(s));return R.removeNode(s),{boundaryPosition:d,nodeInfo:{nodeIndex:g,containerElement:a}}},o=function(e,t){var n,o=e.offset,r=R.getDocument(e.node),i=c(r).createTextRange(),a=v(e.node),s=a?(n=e.node).parentNode:(n=o<(s=e.node.childNodes).length?s[o]:null,e.node),e=r.createElement("span");return e.innerHTML="&#feff;",n?s.insertBefore(e,n):s.appendChild(e),i.moveToElementText(e),i.collapse(!t),s.removeChild(e),a&&i[t?"moveStart":"moveEnd"]("character",o),i},((m=function(e){this.textRange=e,this.refresh()}).prototype=new s(document)).refresh=function(){n=this.textRange,t=n.parentElement(),(r=n.duplicate()).collapse(!0),o=r.parentElement(),(r=n.duplicate()).collapse(!1),n=r.parentElement();var e,t,n,o=(r=o==n?o:R.getCommonAncestor(o,n))==t?r:R.getCommonAncestor(t,r),r=0==(n=this.textRange).compareEndPoints("StartToEnd",n)?e=i(this.textRange,o,!0,!0).boundaryPosition:(e=(t=i(this.textRange,o,!0,!1)).boundaryPosition,i(this.textRange,o,!1,!1,t.nodeInfo).boundaryPosition);this.setStart(e.node,e.offset),this.setEnd(r.node,r.offset)},m.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(m),m.rangeToTextRange=r=function(e){var t,n;return e.collapsed?o(new C(e.startContainer,e.startOffset),!0):(t=o(new C(e.startContainer,e.startOffset),!0),n=o(new C(e.endContainer,e.endOffset),!1),(e=c(s.getRangeDocument(e)).createTextRange()).setEndPoint("StartToStart",t),e.setEndPoint("EndToEnd",n),e)},m.prototype.toTextRange=function(){return r(this)},n.WrappedTextRange=m,n.features.implementsDomRange&&!n.config.preferTextRange||(void 0===(p=Function("return this;")()).Range&&(p.Range=m),n.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),c(e).createTextRange()},n.WrappedRange=m)),n.createRange=function(e){return e=d(e,t,"createRange"),new n.WrappedRange(n.createNativeRange(e))},n.createRangyRange=function(e){return e=d(e,t,"createRangyRange"),new s(e)},a.createAliasForDeprecatedMethod(n,"createIframeRange","createRange"),a.createAliasForDeprecatedMethod(n,"createIframeRangyRange","createRangyRange"),n.addShimListener(function(e){var t=e.document;void 0===t.createRange&&(t.createRange=function(){return n.createRange(t)}),t=null})}),N.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,s){a.config.checkSelectionRanges=!0;var r,o,M="boolean",k="number",c=a.dom,e=a.util,t=e.isHostMethod,d=a.DomRange,L=a.WrappedRange,n=a.DOMException,W=c.DomPosition,i=a.features,f="Control",u=c.getDocument,l=c.getBody,F=d.rangesEqual;function z(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function h(e,t){return e?c.isWindow(e)?e:e instanceof P?e.win:(e=c.getContentDocument(e,s,t),c.getWindow(e)):window}function j(e){return h(e,"getDocSelection").document.selection}function U(e){var t=!1;return t=e.anchorNode?1==c.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset):t}var g=t(window,"getSelection"),p=e.isHostObject(document,"selection"),m=(i.implementsWinGetSelection=g,(i.implementsDocSelection=p)&&(!g||a.config.preferTextRange));if(m)r=j,a.isSelectionValid=function(e){var e=h(e,"isSelectionValid").document,t=e.selection;return"None"!=t.type||u(t.createRange().parentElement())==e};else{if(!g)return s.fail("Neither document.selection or window.getSelection() detected."),!1;r=function(e){return h(e,"getWinSelection").getSelection()},a.isSelectionValid=function(){return!0}}g=(a.getNativeSelection=r)();if(!g)return s.fail("Native selection was null (possibly issue 138?)"),!1;var V=a.createNativeRange(document),q=l(document),R=e.areHostProperties(g,["anchorNode","focusNode","anchorOffset","focusOffset"]),C=(i.selectionHasAnchorAndFocus=R,t(g,"extend")),Y=(i.selectionHasExtend=C,t(g,"setBaseAndExtent")),Q=(i.selectionHasSetBaseAndExtent=Y,typeof g.rangeCount==k),G=(i.selectionHasRangeCount=Q,!1),X=!0,Z=C?function(e,t){var n=d.getRangeDocument(t),n=a.createRange(n);n.collapseToPoint(t.endContainer,t.endOffset),e.addRange(ee(n)),e.extend(t.startContainer,t.startOffset)}:null;if(e.areHostMethods(g,["addRange","getRangeAt","removeAllRanges"])&&typeof g.rangeCount==k&&i.implementsDomRange){var v=window.getSelection();if(v){for(var $=v.rangeCount,N=1<$,E=[],J=U(v),S=0;S<$;++S)E[S]=v.getRangeAt(S);var K=c.createTestElement(document,"",!1),y=K.appendChild(document.createTextNode("   ")),w=document.createRange();for(w.setStart(y,1),w.collapse(!0),v.removeAllRanges(),v.addRange(w),X=1==v.rangeCount,v.removeAllRanges(),N||(N=window.navigator.appVersion.match(/Chrome\/(.*?) /),G=!(N&&36<=parseInt(N[1]))&&(N=w.cloneRange(),w.setStart(y,0),N.setEnd(y,3),N.setStart(y,2),v.addRange(w),v.addRange(N),2==v.rangeCount)),c.removeNode(K),v.removeAllRanges(),S=0;S<$;++S)0==S&&J?Z?Z(v,E[S]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),v.addRange(E[S])):v.addRange(E[S])}}i.selectionSupportsMultipleRanges=G,i.collapsedNonEditableSelectionsSupported=X;var T,O=!1;function _(e,t,n){var o=n?"end":"start",n=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[n+"Container"],e.focusOffset=t[n+"Offset"]}function D(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0,A(e)}function A(e){e.type=0==e.rangeCount?"None":o(e)?"Caret":"Range"}function ee(e){var t;return e instanceof d?((t=a.createNativeRange(e.getDocument())).setEnd(e.endContainer,e.endOffset),t.setStart(e.startContainer,e.startOffset)):e instanceof L?t=e.nativeRange:i.implementsDomRange&&e instanceof c.getWindow(e.startContainer).Range&&(t=e),t}function te(e){var t=e.getNodes();if(function(e){if(e.length&&1==e[0].nodeType){for(var t=1,n=e.length;t<n;++t)if(!c.isAncestorOf(e[0],e[t]))return;return 1}}(t))return t[0];throw s.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element")}function ne(e){return e&&void 0!==e.text}function oe(e,t){t=new L(t);e._ranges=[t],_(e,t,!1),e.rangeCount=1,e.isCollapsed=t.collapsed,A(e)}function x(e){if(e._ranges.length=0,"None"==e.docSelection.type)D(e);else{var t=e.docSelection.createRange();if(ne(t))oe(e,t);else{e.rangeCount=t.length;for(var n,o=u(t.item(0)),r=0;r<e.rangeCount;++r)(n=a.createRange(o)).selectNode(t.item(r)),e._ranges.push(n);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,_(e,e._ranges[e.rangeCount-1],!1),A(e)}}}function re(e,t){for(var n=e.docSelection.createRange(),t=te(t),o=u(n.item(0)),r=l(o).createControlRange(),i=0,a=n.length;i<a;++i)r.add(n.item(i));try{r.add(t)}catch(e){throw s.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),x(e)}function P(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function ie(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0,A(e)}q&&t(q,"createControlRange")&&(y=q.createControlRange(),e.areHostProperties(y,["item","add"])&&(O=!0)),i.implementsControlRange=O,o=R?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},t(g,"getRangeAt")?T=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:R&&(T=function(e){var t=u(e.anchorNode),t=a.createRange(t);return t.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),t.collapsed!==this.isCollapsed&&t.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset),t}),P.prototype=a.selectionPrototype;var b=[];function ae(e,t){for(var n,o,r=b.length;r--;)if(o=(n=b[r]).selection,"deleteAll"==t)ie(o);else if(n.win==e)return"delete"==t?(b.splice(r,1),!0):o;return"deleteAll"==t&&(b.length=0),null}function se(e){if(e&&e instanceof P)return e.refresh(),e;var t=ae(e=h(e,"getNativeSelection")),n=r(e),o=p?j(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new P(n,o,e),b.push({win:e,selection:t})),t}a.getSelection=se,e.createAliasForDeprecatedMethod(a,"getIframeSelection","getSelection");var I,w=P.prototype;function ce(e,t){for(var n,o=u(t[0].startContainer),r=l(o).createControlRange(),i=0,a=t.length;i<a;++i){n=te(t[i]);try{r.add(n)}catch(e){throw s.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),x(e)}if(!m&&R&&e.areHostMethods(g,["removeAllRanges","addRange"])){w.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),D(this)};function de(e,t){Z(e.nativeSelection,t),e.refresh()}w.addRange=Q?function(e,t){if(O&&p&&this.docSelection.type==f)re(this,e);else if(z(t)&&C)de(this,e);else{var t=G?this.rangeCount:(this.removeAllRanges(),0),n=ee(e).cloneRange();try{this.nativeSelection.addRange(n)}catch(e){}this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==t+1?(a.config.checkSelectionRanges&&(n=T(this.nativeSelection,this.rangeCount-1))&&!F(n,e)&&(e=new L(n)),this._ranges[this.rangeCount-1]=e,_(this,e,B(this.nativeSelection)),this.isCollapsed=o(this),A(this)):this.refresh()}}:function(e,t){z(t)&&C?de(this,e):(this.nativeSelection.addRange(ee(e)),this.refresh())},w.setRanges=function(e){if(O&&p&&1<e.length)ce(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(t(g,"empty")&&t(V,"select")&&O&&m))return s.fail("No means of selecting a Range or TextRange was found"),!1;w.removeAllRanges=function(){try{var e,t;this.docSelection.empty(),"None"!=this.docSelection.type&&(this.anchorNode?e=u(this.anchorNode):this.docSelection.type==f&&(t=this.docSelection.createRange()).length&&(e=u(t.item(0))),e&&(l(e).createTextRange().select(),this.docSelection.empty()))}catch(e){}D(this)},w.addRange=function(e){this.docSelection.type==f?re(this,e):(a.WrappedTextRange.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,_(this,e,!1),A(this))},w.setRanges=function(e){this.removeAllRanges();var t=e.length;1<t?ce(this,e):t&&this.addRange(e[0])}}if(w.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new n("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},m)I=function(e){var t;a.isSelectionValid(e.win)?t=e.docSelection.createRange():(t=l(e.win.document).createTextRange()).collapse(!0),e.docSelection.type==f?x(e):ne(t)?oe(e,t):D(e)};else if(t(g,"getRangeAt")&&typeof g.rangeCount==k)I=function(e){if(O&&p&&e.docSelection.type==f)x(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var t=0,n=e.rangeCount;t<n;++t)e._ranges[t]=new a.WrappedRange(e.nativeSelection.getRangeAt(t));_(e,e._ranges[e.rangeCount-1],B(e.nativeSelection)),e.isCollapsed=o(e),A(e)}else D(e)};else{if(!R||typeof g.isCollapsed!=M||typeof V.collapsed!=M||!i.implementsDomRange)return s.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;I=function(e){var t,n=e.nativeSelection;n.anchorNode?(n=T(n,0),e._ranges=[n],e.rangeCount=1,t=(n=e).nativeSelection,n.anchorNode=t.anchorNode,n.anchorOffset=t.anchorOffset,n.focusNode=t.focusNode,n.focusOffset=t.focusOffset,e.isCollapsed=o(e),A(e)):D(e)}}w.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,o=this.anchorOffset;if(I(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=o)return!0;for(;r--;)if(!F(t[r],this._ranges[r]))return!0;return!1}};function fe(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var o=0,r=n.length;o<r;++o)F(t,n[o])||e.addRange(n[o]);e.rangeCount||D(e)}var B;function H(e,t){if(e.win.document!=u(t))throw new n("WRONG_DOCUMENT_ERR")}function ue(e,t){if(t<0||t>(c.isCharacterDataNode(e)?e:e.childNodes).length)throw new n("INDEX_SIZE_ERR")}function le(o){return function(e,t){var n;this.rangeCount?(n=this.getRangeAt(0))["set"+(o?"Start":"End")](e,t):(n=a.createRange(this.win.document)).setStartAndEnd(e,t),this.setSingleRange(n,this.isBackward())}}function he(e){var t=[],n=new W(e.anchorNode,e.anchorOffset),o=new W(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var i=0,a=e.rangeCount;i<a;++i)t[i]=d.inspect(e.getRangeAt(i));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}w.removeRange=O&&p?function(e){if(this.docSelection.type==f){for(var t=this.docSelection.createRange(),n=te(e),o=u(t.item(0)),r=l(o).createControlRange(),i=!1,a=0,s=t.length;a<s;++a)t.item(a)!==n||i?r.add(t.item(a)):i=!0;r.select(),x(this)}else fe(this,e)}:function(e){fe(this,e)},!m&&R&&i.implementsDomRange?(B=U,w.isBackward=function(){return B(this)}):B=w.isBackward=function(){return!1},w.isBackwards=w.isBackward,w.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},w.collapse=function(e,t){H(this,e);var n=a.createRange(e);n.collapseToPoint(e,t),this.setSingleRange(n),this.isCollapsed=!0},w.collapseToStart=function(){if(!this.rangeCount)throw new n("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},w.collapseToEnd=function(){if(!this.rangeCount)throw new n("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},w.selectAllChildren=function(e){H(this,e);var t=a.createRange(e);t.selectNodeContents(e),this.setSingleRange(t)},Y?w.setBaseAndExtent=function(e,t,n,o){this.nativeSelection.setBaseAndExtent(e,t,n,o),this.refresh()}:C&&(w.setBaseAndExtent=function(e,t,n,o){ue(e,t),ue(n,o),H(this,e),H(this,n);var r=a.createRange(node),i=-1==c.comparePoints(e,t,n,o);i?r.setStartAndEnd(n,o,e,t):r.setStartAndEnd(e,t,n,o),this.setSingleRange(r,i)}),w.deleteFromDocument=function(){if(O&&p&&this.docSelection.type==f){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),c.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var o=0,r=n.length;o<r;++o)n[o].deleteContents();this.addRange(n[r-1])}}},w.eachRange=function(e,t){for(var n=0,o=this._ranges.length;n<o;++n)if(e(this.getRangeAt(n)))return t},w.getAllRanges=function(){var t=[];return this.eachRange(function(e){t.push(e)}),t},w.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},w.callMethodOnEachRange=function(t,n){var o=[];return this.eachRange(function(e){o.push(e[t].apply(e,n||[]))}),o},w.setStart=le(!0),w.setEnd=le(!1),a.rangePrototype.select=function(e){se(this.getDocument()).setSingleRange(this,e)},w.changeEachRange=function(t){var n=[],e=this.isBackward();this.eachRange(function(e){t(e),n.push(e)}),this.removeAllRanges(),e&&1==n.length?this.addRange(n[0],"backward"):this.setRanges(n)},w.containsNode=function(t,n){return this.eachRange(function(e){return e.containsNode(t,n)},!0)||!1},w.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},w.moveToBookmark=function(e){for(var t,n,o=[],r=0;t=e.rangeBookmarks[r++];)(n=a.createRange(this.win)).moveToBookmark(t),o.push(n);e.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},w.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},w.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},w.toHtml=function(){var t=[];return this.eachRange(function(e){t.push(d.toHtml(e))}),t.join("")},i.implementsTextRange&&(w.getNativeTextRange=function(){if(e=this.docSelection){var e=e.createRange();if(ne(e))return e;throw s.createError("getNativeTextRange: selection is a control selection")}if(0<this.rangeCount)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw s.createError("getNativeTextRange: selection contains no range")}),w.getName=function(){return"WrappedSelection"},w.inspect=function(){return he(this)},w.detach=function(){ae(this.win,"delete"),ie(this)},P.detachAll=function(){ae(null,"deleteAll")},P.inspect=he,P.isDirectionBackward=z,a.Selection=P,a.selectionPrototype=w,a.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return se(e)}),e=null})});function B(e){H||(H=!0,!N.initialized&&N.config.autoInitialize&&_())}var H=!1;return C&&("complete"==document.readyState?B():(f(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",B,!1),m(window,"load",B))),N},this);